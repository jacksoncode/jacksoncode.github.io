<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <style type="text/css">

#watermark {

  position: relative;
  overflow: hidden;
}

#watermark .x {
  position: absolute;
  top: 800;
  left: 400;
  color: #3300ff;
  font-size: 50px;
  pointer-events: none;
  opacity:0.3;
  filter:Alpha(opacity=50);
  -webkit-transform: rotate(45deg);
  -moz-transform: rotate(45deg);
}
    </style>


    <style type="text/css">
 html{color:#333;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-rendering:optimizelegibility;font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif}html.borderbox *,html.borderbox :after,html.borderbox :before{box-sizing:border-box}article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul{margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}audio,canvas,video{display:inline-block}body,button,input,select,textarea{font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}blockquote{position:relative;color:#999;font-weight:400;border-left:1px solid #1abc9c;padding-left:1em;margin:1em 3em 1em 2em}@media only screen and (max-width:640px){blockquote{margin:1em 0}}abbr,acronym{border-bottom:1px dotted;font-variant:normal}abbr{cursor:help}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:400}ol,ul{list-style:none}caption,th{text-align:left}q:after,q:before{content:""}sub,sup{font-size:75%;line-height:0;position:relative}:root sub,:root sup{vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a{color:#1abc9c}a:hover{text-decoration:underline}.typo a{border-bottom:1px solid #1abc9c}.typo a:hover{border-bottom-color:#555;color:#555}.typo a:hover,a,ins{text-decoration:none}.typo-u,u{text-decoration:underline}mark{background:#fffdd1;border-bottom:1px solid #ffedce;padding:2px;margin:0 5px}code,pre,pre tt{font-family:Courier,Courier New,monospace}pre{background:hsla(0,0%,97%,.7);border:1px solid #ddd;padding:1em 1.5em;display:block;-webkit-overflow-scrolling:touch}hr{border:none;border-bottom:1px solid #cfcfcf;margin-bottom:.8em;height:10px}.typo-small,figcaption,small{font-size:.9em;color:#888}b,strong{font-weight:700;color:#000}[draggable]{cursor:move}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.textwrap,.textwrap td,.textwrap th{word-wrap:break-word;word-break:break-all}.textwrap-table{table-layout:fixed}.serif{font-family:Palatino,Optima,Georgia,serif}.typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote{margin-bottom:1rem}h1,h2,h3,h4,h5,h6{font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;line-height:1.35}.typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}.typo-h1,.typo h1{font-size:2em}.typo-h2,.typo h2{font-size:1.8em}.typo-h3,.typo h3{font-size:1.6em}.typo-h4,.typo h4{font-size:1.4em}.typo-h5,.typo-h6,.typo h5,.typo h6{font-size:1.2em}.typo-ul,.typo ul{margin-left:1.3em;list-style:disc}.typo-ol,.typo ol{list-style:decimal;margin-left:1.9em}.typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul{margin-bottom:.8em;margin-left:2em}.typo-ol ul,.typo-ul ul,.typo li ul{list-style:circle}.typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th{border:1px solid #ddd;padding:.5em 1em;color:#666}.typo-table th,.typo table th{background:#fbfbfb}.typo-table thead th,.typo table thead th{background:hsla(0,0%,95%,.7)}.typo table caption{border-bottom:none}.typo-input,.typo-textarea{-webkit-appearance:none;border-radius:0}.typo-em,.typo em,caption,legend{color:#000;font-weight:inherit}.typo-em{position:relative}.typo-em:after{position:absolute;top:.65em;left:0;width:100%;overflow:hidden;white-space:nowrap;content:"\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"}.typo img{max-width:100%}.common-content{font-weight:400;color:#353535;line-height:1.75rem;white-space:normal;word-break:normal;font-size:1rem}.common-content img{display:block;max-width:100%;background-color:#eee}.common-content audio,.common-content video{width:100%;background-color:#eee}.common-content center,.common-content font{margin-top:1rem;display:inline-block}.common-content center{width:100%}.common-content pre{margin-top:1rem;padding-left:0;padding-right:0;position:relative;overflow:hidden}.common-content pre code{font-size:.8rem;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;width:100%;box-sizing:border-box;padding-left:1rem;padding-right:1rem;overflow-x:auto}.common-content hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}.common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong{font-weight:700}.common-content h1,.common-content h2{font-size:1.125rem;margin-bottom:.45rem}.common-content h3,.common-content h4,.common-content h5{font-size:1rem;margin-bottom:.45rem}.common-content p{font-weight:400;color:#353535;margin-top:.15rem}.common-content .orange{color:#ff5a05}.common-content .reference{font-size:1rem;color:#888}.custom-rich-content h1{margin-top:0;font-weight:400;font-size:15.25px;border-bottom:1px solid #eee;line-height:2.8}.custom-rich-content li,.custom-rich-content p{font-size:14px;color:#888;line-height:1.6}table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr{box-sizing:border-box}table.hljs-ln td{padding:0;border:0}table.hljs-ln td.hljs-ln-numbers{min-width:15px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;user-select:none}table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;line-height:20px;vertical-align:top}table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;color:#24292e;word-wrap:normal;white-space:pre}video::-webkit-media-controls{overflow:hidden!important}video::-webkit-media-controls-enclosure{width:calc(100% + 32px);margin-left:auto}.button-cancel{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel,.button-primary{-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary{color:#fff;background-color:#ff5a05;border-radius:3px}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot);src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.woff) format("woff"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.ttf) format("truetype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.svg#iconfont) format("svg")}@font-face{font-family:player-font;src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot);src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.woff) format("woff"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.ttf) format("truetype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.svg#player-font) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}html{background:#fff;min-height:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{width:100%}body.fixed{overflow:hidden;position:fixed;width:100vw;height:100vh}i{font-style:normal}a{word-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0)}a:hover{text-decoration:none}.fade-enter-active,.fade-leave-active{transition:opacity .3s}.fade-enter,.fade-leave-to{opacity:0}.MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG{outline:0}.ios-app-switch .js-audit{display:none}._loading_wrap_{position:fixed;width:100vw;height:100vh;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999}._loading_div_class_,._loading_wrap_{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}._loading_div_class_{word-wrap:break-word;padding:.5rem .75rem;text-align:center;z-index:9999;font-size:.6rem;max-width:60%;color:#fff;border-radius:.25rem;-ms-flex-direction:column;flex-direction:column}._loading_div_class_ .message{color:#353535;font-size:16px;line-height:3}.spinner{animation:circle-rotator 1.4s linear infinite}.spinner *{line-height:0;box-sizing:border-box}@keyframes circle-rotator{0%{transform:rotate(0deg)}to{transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;transform-origin:center;animation:circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite}@keyframes circle-colors{0%{stroke:#ff5a05}to{stroke:#ff5a05}}@keyframes circle-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;transform:rotate(135deg)}to{stroke-dashoffset:187;transform:rotate(450deg)}}.confirm-box-wrapper,.confirm-box-wrapper .mask{position:absolute;top:0;left:0;right:0;bottom:0}.confirm-box-wrapper .mask{background:rgba(0,0,0,.6)}.confirm-box-wrapper .confirm-box{position:fixed;top:50%;left:50%;width:267px;background:#fff;transform:translate(-50%,-50%);border-radius:7px}.confirm-box-wrapper .confirm-box .head{margin:0 18px;font-size:18px;text-align:center;line-height:65px;border-bottom:1px solid #d9d9d9}.confirm-box-wrapper .confirm-box .body{padding:18px;padding-bottom:0;color:#353535;font-size:12.5px;max-height:150px;overflow:auto}.confirm-box-wrapper .confirm-box .foot{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:18px}.confirm-box-wrapper .confirm-box .foot .button-cancel{border:1px solid #d9d9d9}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}




    </style>
    <style type="text/css">
        .button-cancel[data-v-87ffcada]{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel[data-v-87ffcada],.button-primary[data-v-87ffcada]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary[data-v-87ffcada]{color:#fff;background-color:#ff5a05;border-radius:3px}.pd[data-v-87ffcada]{padding-left:1.375rem;padding-right:1.375rem}.article[data-v-87ffcada]{max-width:70rem;margin:0 auto}.article .article-unavailable[data-v-87ffcada]{color:#fa8919;font-size:15px;font-weight:600;line-height:24px;border-radius:5px;padding:12px;background-color:#f6f7fb;margin-top:20px}.article .article-unavailable .iconfont[data-v-87ffcada]{font-size:12px}.article .main[data-v-87ffcada]{padding:1.25rem 0;margin-bottom:52px}.article-title[data-v-87ffcada]{color:#353535;font-weight:400;line-height:1.65rem;font-size:1.34375rem}.article-info[data-v-87ffcada]{color:#888;font-size:.9375rem;margin-top:1.0625rem}.article-content[data-v-87ffcada]{margin-top:1.0625rem}.article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button{display:none}.copyright[data-v-87ffcada]{color:#b2b2b2;padding-bottom:20px;margin-top:20px;font-size:13px}.audio-player[data-v-87ffcada]{width:100%;margin:20px 0}.to-comment[data-v-87ffcada]{overflow:hidden;padding-top:10px;margin-bottom:-30px}.to-comment a.button-primary[data-v-87ffcada]{float:right;height:20px;font-size:12px;line-height:20px;padding:4px 8px;cursor:pointer}.article-comments[data-v-87ffcada]{margin-top:2rem}.article-comments h2[data-v-87ffcada]{text-align:center;color:#888;position:relative;z-index:1;margin-bottom:1rem}.article-comments h2[data-v-87ffcada]:before{border-top:1px dotted #888;content:"";position:absolute;top:56%;left:0;width:100%;z-index:-1}.article-comments h2 span[data-v-87ffcada]{font-size:15.25px;font-weight:400;padding:0 1rem;background:#fff;display:inline-block}.article-sub-bottom[data-v-87ffcada]{z-index:10;cursor:pointer}.switch-btns[data-v-87ffcada]{height:76px;cursor:pointer;padding-top:24px;padding-bottom:24px;border-bottom:10px solid #f6f7fb;position:relative}.switch-btns[data-v-87ffcada]:before{content:" ";height:1px;background:#e8e8e8;position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;left:1.375rem;right:1.375rem}.switch-btns .btn[data-v-87ffcada]{height:38px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.switch-btns .btn .tag[data-v-87ffcada]{-webkit-box-flex:0;-ms-flex:0 0 62px;flex:0 0 62px;text-align:center;color:#888;font-size:14px;border-radius:10px;height:22px;line-height:22px;background:#f6f7fb;font-weight:400}.switch-btns .btn .txt[data-v-87ffcada]{margin-left:10px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:#888;font-size:15px;height:22px;line-height:22px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:400}@media (max-width:769px){.article .breadcrumb[data-v-87ffcada]{padding-top:10px;padding-bottom:10px}}





    </style>

    <style type="text/css">
        .comment-item{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:1rem}.comment-item a{border-bottom:none}.comment-item .avatar{width:2.625rem;height:2.625rem;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}.comment-item .info{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.comment-item .info .hd{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .username{color:#888;font-size:15.25px;font-weight:400;line-height:1.2}.comment-item .info .hd .control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .control .btn-share{color:#888;font-size:.75rem;margin-right:1rem}.comment-item .info .hd .control .btn-praise{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:15.25px;text-decoration:none}.comment-item .info .hd .control .btn-praise i{color:#888;display:inline-block;font-size:.75rem;margin-right:.3rem;margin-top:-.01rem}.comment-item .info .hd .control .btn-praise i.on,.comment-item .info .hd .control .btn-praise span{color:#ff5a05}.comment-item .info .bd{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6}.comment-item .info .time{color:#888;font-size:9px;line-height:1}.comment-item .info .reply .reply-hd{font-size:15.25px}.comment-item .info .reply .reply-hd span{margin-left:-12px;color:#888;font-weight:400}.comment-item .info .reply .reply-hd i{color:#ff5a05;font-size:15.25px}.comment-item .info .reply .reply-content{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all}.comment-item .info .reply .reply-time{color:#888;font-size:9px}




    </style>
</head>
<body>
<div id="app">


    <div data-v-87ffcada="" class="article" id="watermark">
        <p class="x">æ›´å¤šè¯¾ç¨‹è¯·åŠ QQç¾¤170701297</p>
        <div data-v-87ffcada="" class="main main-app">
            <h1 data-v-87ffcada="" class="article-title pd">
                05è®²åŸºç¡€ç¯‡ï¼šæŸä¸ªåº”ç”¨çš„CPUä½¿ç”¨ç‡å±…ç„¶è¾¾åˆ°100%ï¼Œæˆ‘è¯¥æ€ä¹ˆåŠ
            </h1>
            <div data-v-87ffcada="" class="article-content typo common-content pd"><img data-v-87ffcada=""
                                                                                        src="https://static001.geekbang.org/resource/image/69/b5/69ad9216d18b2c937a210a4fa604f4b5.jpg">


                <div data-v-87ffcada="" id="article-content" class="">
                    <div class="text">
                        <p>ä½ å¥½ï¼Œæˆ‘æ˜¯å€ªæœ‹é£ã€‚</p><p>é€šè¿‡å‰ä¸¤èŠ‚å¯¹å¹³å‡è´Ÿè½½å’Œ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å­¦ä¹ ï¼Œæˆ‘ç›¸ä¿¡ä½ å¯¹ CPU çš„æ€§èƒ½å·²ç»æœ‰äº†åˆæ­¥äº†è§£ã€‚ä¸è¿‡æˆ‘è¿˜æ˜¯æƒ³é—®ä¸€ä¸‹ï¼Œåœ¨å­¦è¿™ä¸ªä¸“æ å‰ï¼Œä½ æœ€å¸¸ç”¨ä»€ä¹ˆæŒ‡æ ‡æ¥æè¿°ç³»ç»Ÿçš„ CPU æ€§èƒ½å‘¢ï¼Ÿæˆ‘æƒ³ä½ çš„ç­”æ¡ˆï¼Œå¯èƒ½ä¸æ˜¯å¹³å‡è´Ÿè½½ï¼Œä¹Ÿä¸æ˜¯ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè€Œæ˜¯å¦ä¸€ä¸ªæ›´ç›´è§‚çš„æŒ‡æ ‡â€”â€” CPU ä½¿ç”¨ç‡ã€‚</p><p>æˆ‘ä»¬å‰é¢è¯´è¿‡ï¼ŒCPU ä½¿ç”¨ç‡æ˜¯å•ä½æ—¶é—´å†… CPU ä½¿ç”¨æƒ…å†µçš„ç»Ÿè®¡ï¼Œä»¥ç™¾åˆ†æ¯”çš„æ–¹å¼å±•ç¤ºã€‚é‚£ä¹ˆï¼Œä½œä¸ºæœ€å¸¸ç”¨ä¹Ÿæ˜¯æœ€ç†Ÿæ‚‰çš„ CPU æŒ‡æ ‡ï¼Œä½ èƒ½è¯´å‡º CPU ä½¿ç”¨ç‡åˆ°åº•æ˜¯æ€ä¹ˆç®—å‡ºæ¥çš„å—ï¼Ÿå†æœ‰ï¼Œè¯¸å¦‚ topã€ps ä¹‹ç±»çš„æ€§èƒ½å·¥å…·å±•ç¤ºçš„ %userã€%niceã€ %systemã€%iowait ã€%steal ç­‰ç­‰ï¼Œä½ åˆèƒ½å¼„æ¸…æ¥šå®ƒä»¬ä¹‹é—´çš„ä¸åŒå—ï¼Ÿ</p><p>ä»Šå¤©æˆ‘å°±å¸¦ä½ äº†è§£ CPU ä½¿ç”¨ç‡çš„å†…å®¹ï¼ŒåŒæ—¶ï¼Œæˆ‘ä¹Ÿä¼šä»¥æˆ‘ä»¬æœ€å¸¸ç”¨çš„åå‘ä»£ç†æœåŠ¡å™¨ Nginx ä¸ºä¾‹ï¼Œå¸¦ä½ åœ¨ä¸€æ­¥æ­¥æ“ä½œå’Œåˆ†æä¸­æ·±å…¥ç†è§£ã€‚</p><h2>CPU ä½¿ç”¨ç‡</h2><p>åœ¨ä¸Šä¸€æœŸæˆ‘æ›¾æåˆ°ï¼ŒLinux ä½œä¸ºä¸€ä¸ªå¤šä»»åŠ¡æ“ä½œç³»ç»Ÿï¼Œå°†æ¯ä¸ª CPU çš„æ—¶é—´åˆ’åˆ†ä¸ºå¾ˆçŸ­çš„æ—¶é—´ç‰‡ï¼Œå†é€šè¿‡è°ƒåº¦å™¨è½®æµåˆ†é…ç»™å„ä¸ªä»»åŠ¡ä½¿ç”¨ï¼Œå› æ­¤é€ æˆå¤šä»»åŠ¡åŒæ—¶è¿è¡Œçš„é”™è§‰ã€‚</p><p>ä¸ºäº†ç»´æŠ¤ CPU æ—¶é—´ï¼ŒLinux é€šè¿‡äº‹å…ˆå®šä¹‰çš„èŠ‚æ‹ç‡ï¼ˆå†…æ ¸ä¸­è¡¨ç¤ºä¸º HZï¼‰ï¼Œè§¦å‘æ—¶é—´ä¸­æ–­ï¼Œå¹¶ä½¿ç”¨å…¨å±€å˜é‡ Jiffies è®°å½•äº†å¼€æœºä»¥æ¥çš„èŠ‚æ‹æ•°ã€‚æ¯å‘ç”Ÿä¸€æ¬¡æ—¶é—´ä¸­æ–­ï¼ŒJiffies çš„å€¼å°±åŠ  1ã€‚</p><!-- [[[read_end]]] --><p>èŠ‚æ‹ç‡ HZ æ˜¯å†…æ ¸çš„å¯é…é€‰é¡¹ï¼Œå¯ä»¥è®¾ç½®ä¸º 100ã€250ã€1000 ç­‰ã€‚ä¸åŒçš„ç³»ç»Ÿå¯èƒ½è®¾ç½®ä¸åŒæ•°å€¼ï¼Œä½ å¯ä»¥é€šè¿‡æŸ¥è¯¢ /boot/config å†…æ ¸é€‰é¡¹æ¥æŸ¥çœ‹å®ƒçš„é…ç½®å€¼ã€‚æ¯”å¦‚åœ¨æˆ‘çš„ç³»ç»Ÿä¸­ï¼ŒèŠ‚æ‹ç‡è®¾ç½®æˆäº† 250ï¼Œä¹Ÿå°±æ˜¯æ¯ç§’é’Ÿè§¦å‘ 250 æ¬¡æ—¶é—´ä¸­æ–­ã€‚</p><pre><code>$ grep 'CONFIG_HZ=' /boot/config-$(uname -r)
CONFIG_HZ=250
</code></pre><p>åŒæ—¶ï¼Œæ­£å› ä¸ºèŠ‚æ‹ç‡ HZ æ˜¯å†…æ ¸é€‰é¡¹ï¼Œæ‰€ä»¥ç”¨æˆ·ç©ºé—´ç¨‹åºå¹¶ä¸èƒ½ç›´æ¥è®¿é—®ã€‚ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ç©ºé—´ç¨‹åºï¼Œå†…æ ¸è¿˜æä¾›äº†ä¸€ä¸ªç”¨æˆ·ç©ºé—´èŠ‚æ‹ç‡ USER_HZï¼Œå®ƒæ€»æ˜¯å›ºå®šä¸º 100ï¼Œä¹Ÿå°±æ˜¯1/100ç§’ã€‚è¿™æ ·ï¼Œç”¨æˆ·ç©ºé—´ç¨‹åºå¹¶ä¸éœ€è¦å…³å¿ƒå†…æ ¸ä¸­ HZ è¢«è®¾ç½®æˆäº†å¤šå°‘ï¼Œå› ä¸ºå®ƒçœ‹åˆ°çš„æ€»æ˜¯å›ºå®šå€¼ USER_HZã€‚</p><p>Linux é€šè¿‡ /proc è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œå‘ç”¨æˆ·ç©ºé—´æä¾›äº†ç³»ç»Ÿå†…éƒ¨çŠ¶æ€çš„ä¿¡æ¯ï¼Œè€Œ /proc/stat æä¾›çš„å°±æ˜¯ç³»ç»Ÿçš„ CPU å’Œä»»åŠ¡ç»Ÿè®¡ä¿¡æ¯ã€‚æ¯”æ–¹è¯´ï¼Œå¦‚æœä½ åªå…³æ³¨ CPU çš„è¯ï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p><pre><code># åªä¿ç•™å„ä¸ªCPUçš„æ•°æ®
$ cat /proc/stat | grep ^cpu
cpu  280580 7407 286084 172900810 83602 0 583 0 0 0
cpu0 144745 4181 176701 86423902 52076 0 301 0 0 0
cpu1 135834 3226 109383 86476907 31525 0 282 0 0 0
</code></pre><p>è¿™é‡Œçš„è¾“å‡ºç»“æœæ˜¯ä¸€ä¸ªè¡¨æ ¼ã€‚å…¶ä¸­ï¼Œç¬¬ä¸€åˆ—è¡¨ç¤ºçš„æ˜¯ CPU ç¼–å·ï¼Œå¦‚cpu0ã€cpu1 ï¼Œè€Œç¬¬ä¸€è¡Œæ²¡æœ‰ç¼–å·çš„ cpu  ï¼Œè¡¨ç¤ºçš„æ˜¯æ‰€æœ‰ CPU çš„ç´¯åŠ ã€‚å…¶ä»–åˆ—åˆ™è¡¨ç¤ºä¸åŒåœºæ™¯ä¸‹ CPU çš„ç´¯åŠ èŠ‚æ‹æ•°ï¼Œå®ƒçš„å•ä½æ˜¯ USER_HZï¼Œä¹Ÿå°±æ˜¯ 10 msï¼ˆ1/100ç§’ï¼‰ï¼Œæ‰€ä»¥è¿™å…¶å®å°±æ˜¯ä¸åŒåœºæ™¯ä¸‹çš„ CPU æ—¶é—´ã€‚</p><p>å½“ç„¶ï¼Œè¿™é‡Œæ¯ä¸€åˆ—çš„é¡ºåºå¹¶ä¸éœ€è¦ä½ èƒŒä¸‹æ¥ã€‚ä½ åªè¦è®°ä½ï¼Œæœ‰éœ€è¦çš„æ—¶å€™ï¼ŒæŸ¥è¯¢  man proc  å°±å¯ä»¥ã€‚ä¸è¿‡ï¼Œä½ è¦æ¸…æ¥šman procæ–‡æ¡£é‡Œæ¯ä¸€åˆ—çš„æ¶µä¹‰ï¼Œå®ƒä»¬éƒ½æ˜¯CPUä½¿ç”¨ç‡ç›¸å…³çš„é‡è¦æŒ‡æ ‡ï¼Œä½ è¿˜ä¼šåœ¨å¾ˆå¤šå…¶ä»–çš„æ€§èƒ½å·¥å…·ä¸­çœ‹åˆ°å®ƒä»¬ã€‚ä¸‹é¢ï¼Œæˆ‘æ¥ä¾æ¬¡è§£è¯»ä¸€ä¸‹ã€‚</p><ul>
<li>
<p>userï¼ˆé€šå¸¸ç¼©å†™ä¸º usï¼‰ï¼Œä»£è¡¨ç”¨æˆ·æ€ CPU æ—¶é—´ã€‚æ³¨æ„ï¼Œå®ƒä¸åŒ…æ‹¬ä¸‹é¢çš„ nice æ—¶é—´ï¼Œä½†åŒ…æ‹¬äº† guest æ—¶é—´ã€‚</p>
</li>
<li>
<p>niceï¼ˆé€šå¸¸ç¼©å†™ä¸º niï¼‰ï¼Œä»£è¡¨ä½ä¼˜å…ˆçº§ç”¨æˆ·æ€ CPU æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¿›ç¨‹çš„ nice å€¼è¢«è°ƒæ•´ä¸º 1-19 ä¹‹é—´æ—¶çš„ CPU æ—¶é—´ã€‚è¿™é‡Œæ³¨æ„ï¼Œnice å¯å–å€¼èŒƒå›´æ˜¯ -20 åˆ° 19ï¼Œæ•°å€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§åè€Œè¶Šä½ã€‚</p>
</li>
<li>
<p>systemï¼ˆé€šå¸¸ç¼©å†™ä¸ºsysï¼‰ï¼Œä»£è¡¨å†…æ ¸æ€ CPU æ—¶é—´ã€‚</p>
</li>
<li>
<p>idleï¼ˆé€šå¸¸ç¼©å†™ä¸ºidï¼‰ï¼Œä»£è¡¨ç©ºé—²æ—¶é—´ã€‚æ³¨æ„ï¼Œå®ƒä¸åŒ…æ‹¬ç­‰å¾… I/O çš„æ—¶é—´ï¼ˆiowaitï¼‰ã€‚</p>
</li>
<li>
<p>iowaitï¼ˆé€šå¸¸ç¼©å†™ä¸º waï¼‰ï¼Œä»£è¡¨ç­‰å¾… I/O çš„ CPU æ—¶é—´ã€‚</p>
</li>
<li>
<p>irqï¼ˆé€šå¸¸ç¼©å†™ä¸º hiï¼‰ï¼Œä»£è¡¨å¤„ç†ç¡¬ä¸­æ–­çš„ CPU æ—¶é—´ã€‚</p>
</li>
<li>
<p>softirqï¼ˆé€šå¸¸ç¼©å†™ä¸º siï¼‰ï¼Œä»£è¡¨å¤„ç†è½¯ä¸­æ–­çš„ CPU æ—¶é—´ã€‚</p>
</li>
<li>
<p>stealï¼ˆé€šå¸¸ç¼©å†™ä¸º stï¼‰ï¼Œä»£è¡¨å½“ç³»ç»Ÿè¿è¡Œåœ¨è™šæ‹Ÿæœºä¸­çš„æ—¶å€™ï¼Œè¢«å…¶ä»–è™šæ‹Ÿæœºå ç”¨çš„ CPU æ—¶é—´ã€‚</p>
</li>
<li>
<p>guestï¼ˆé€šå¸¸ç¼©å†™ä¸º guestï¼‰ï¼Œä»£è¡¨é€šè¿‡è™šæ‹ŸåŒ–è¿è¡Œå…¶ä»–æ“ä½œç³»ç»Ÿçš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¿è¡Œè™šæ‹Ÿæœºçš„ CPU æ—¶é—´ã€‚</p>
</li>
<li>
<p>guest_niceï¼ˆé€šå¸¸ç¼©å†™ä¸º gniceï¼‰ï¼Œä»£è¡¨ä»¥ä½ä¼˜å…ˆçº§è¿è¡Œè™šæ‹Ÿæœºçš„æ—¶é—´ã€‚</p>
</li>
</ul><p>è€Œæˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„ <strong>CPU ä½¿ç”¨ç‡ï¼Œå°±æ˜¯é™¤äº†ç©ºé—²æ—¶é—´å¤–çš„å…¶ä»–æ—¶é—´å æ€» CPU æ—¶é—´çš„ç™¾åˆ†æ¯”</strong>ï¼Œç”¨å…¬å¼æ¥è¡¨ç¤ºå°±æ˜¯ï¼š</p><p><img src="https://static001.geekbang.org/resource/image/3e/09/3edcc7f908c7c1ddba4bbcccc0277c09.png" alt=""><br>
æ ¹æ®è¿™ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä» /proc/stat ä¸­çš„æ•°æ®ï¼Œå¾ˆå®¹æ˜“åœ°è®¡ç®—å‡º CPU ä½¿ç”¨ç‡ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç”¨æ¯ä¸€ä¸ªåœºæ™¯çš„CPUæ—¶é—´ï¼Œé™¤ä»¥æ€»çš„CPUæ—¶é—´ï¼Œè®¡ç®—å‡ºæ¯ä¸ªåœºæ™¯çš„CPUä½¿ç”¨ç‡ã€‚</p><p>ä¸è¿‡å…ˆä¸è¦ç€æ€¥è®¡ç®—ï¼Œä½ èƒ½è¯´å‡ºï¼Œç›´æ¥ç”¨ /proc/stat çš„æ•°æ®ï¼Œç®—çš„æ˜¯ä»€ä¹ˆæ—¶é—´æ®µçš„ CPU ä½¿ç”¨ç‡å—ï¼Ÿ</p><p>çœ‹åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥æƒ³èµ·æ¥äº†ï¼Œè¿™æ˜¯å¼€æœºä»¥æ¥çš„èŠ‚æ‹æ•°ç´¯åŠ å€¼ï¼Œæ‰€ä»¥ç›´æ¥ç®—å‡ºæ¥çš„ï¼Œæ˜¯å¼€æœºä»¥æ¥çš„å¹³å‡ CPU ä½¿ç”¨ç‡ï¼Œä¸€èˆ¬æ²¡å•¥å‚è€ƒä»·å€¼ã€‚</p><p>äº‹å®ä¸Šï¼Œä¸ºäº†è®¡ç®— CPU ä½¿ç”¨ç‡ï¼Œæ€§èƒ½å·¥å…·ä¸€èˆ¬éƒ½ä¼šå–é—´éš”ä¸€æ®µæ—¶é—´ï¼ˆæ¯”å¦‚3ç§’ï¼‰çš„ä¸¤æ¬¡å€¼ï¼Œä½œå·®åï¼Œå†è®¡ç®—å‡ºè¿™æ®µæ—¶é—´å†…çš„å¹³å‡ CPU ä½¿ç”¨ç‡ï¼Œå³</p><p><img src="https://static001.geekbang.org/resource/image/84/5a/8408bb45922afb2db09629a9a7eb1d5a.png" alt=""></p><p>è¿™ä¸ªå…¬å¼ï¼Œå°±æ˜¯æˆ‘ä»¬ç”¨å„ç§æ€§èƒ½å·¥å…·æ‰€çœ‹åˆ°çš„CPU ä½¿ç”¨ç‡çš„å®é™…è®¡ç®—æ–¹æ³•ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬çŸ¥é“äº†ç³»ç»Ÿ CPU ä½¿ç”¨ç‡çš„è®¡ç®—æ–¹æ³•ï¼Œé‚£è¿›ç¨‹çš„å‘¢ï¼Ÿè·Ÿç³»ç»Ÿçš„æŒ‡æ ‡ç±»ä¼¼ï¼ŒLinux ä¹Ÿç»™æ¯ä¸ªè¿›ç¨‹æä¾›äº†è¿è¡Œæƒ…å†µçš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ /proc/[pid]/statã€‚ä¸è¿‡ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«çš„æ•°æ®å°±æ¯”è¾ƒä¸°å¯Œäº†ï¼Œæ€»å…±æœ‰ 52 åˆ—çš„æ•°æ®ã€‚</p><p>å½“ç„¶ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œå› ä¸ºä½ å¹¶ä¸éœ€è¦æŒæ¡æ¯ä¸€åˆ—çš„å«ä¹‰ã€‚è¿˜æ˜¯é‚£å¥è¯ï¼Œéœ€è¦çš„æ—¶å€™ï¼ŒæŸ¥  man proc  å°±è¡Œã€‚</p><p>å›è¿‡å¤´æ¥çœ‹ï¼Œæ˜¯ä¸æ˜¯è¯´è¦æŸ¥çœ‹ CPU ä½¿ç”¨ç‡ï¼Œå°±å¿…é¡»å…ˆè¯»å– /proc/stat å’Œ /proc/[pid]/stat è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œç„¶åå†æŒ‰ç…§ä¸Šé¢çš„å…¬å¼è®¡ç®—å‡ºæ¥å‘¢ï¼Ÿ</p><p>å½“ç„¶ä¸æ˜¯ï¼Œå„ç§å„æ ·çš„æ€§èƒ½åˆ†æå·¥å…·å·²ç»å¸®æˆ‘ä»¬è®¡ç®—å¥½äº†ã€‚ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>æ€§èƒ½åˆ†æå·¥å…·ç»™å‡ºçš„éƒ½æ˜¯é—´éš”ä¸€æ®µæ—¶é—´çš„å¹³å‡ CPU ä½¿ç”¨ç‡ï¼Œæ‰€ä»¥è¦æ³¨æ„é—´éš”æ—¶é—´çš„è®¾ç½®</strong>ï¼Œç‰¹åˆ«æ˜¯ç”¨å¤šä¸ªå·¥å…·å¯¹æ¯”åˆ†ææ—¶ï¼Œä½ ä¸€å®šè¦ä¿è¯å®ƒä»¬ç”¨çš„æ˜¯ç›¸åŒçš„é—´éš”æ—¶é—´ã€‚</p><p>æ¯”å¦‚ï¼Œå¯¹æ¯”ä¸€ä¸‹ top å’Œ ps è¿™ä¸¤ä¸ªå·¥å…·æŠ¥å‘Šçš„ CPU ä½¿ç”¨ç‡ï¼Œé»˜è®¤çš„ç»“æœå¾ˆå¯èƒ½ä¸ä¸€æ ·ï¼Œå› ä¸º top é»˜è®¤ä½¿ç”¨ 3 ç§’æ—¶é—´é—´éš”ï¼Œè€Œ ps ä½¿ç”¨çš„å´æ˜¯è¿›ç¨‹çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚</p><h2>æ€ä¹ˆæŸ¥çœ‹ CPU ä½¿ç”¨ç‡</h2><p>çŸ¥é“äº† CPU ä½¿ç”¨ç‡çš„å«ä¹‰åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹è¦æ€ä¹ˆæŸ¥çœ‹ CPU ä½¿ç”¨ç‡ã€‚è¯´åˆ°æŸ¥çœ‹ CPU ä½¿ç”¨ç‡çš„å·¥å…·ï¼Œæˆ‘çŒœä½ ç¬¬ä¸€ååº”è‚¯å®šæ˜¯  top å’Œ psã€‚çš„ç¡®ï¼Œtop å’Œ ps æ˜¯æœ€å¸¸ç”¨çš„æ€§èƒ½åˆ†æå·¥å…·ï¼š</p><ul>
<li>
<p>top æ˜¾ç¤ºäº†ç³»ç»Ÿæ€»ä½“çš„ CPU å’Œå†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä»¥åŠå„ä¸ªè¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µã€‚</p>
</li>
<li>
<p>ps åˆ™åªæ˜¾ç¤ºäº†æ¯ä¸ªè¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µã€‚</p>
</li>
</ul><p>æ¯”å¦‚ï¼Œtop çš„è¾“å‡ºæ ¼å¼ä¸ºï¼š</p><pre><code># é»˜è®¤æ¯3ç§’åˆ·æ–°ä¸€æ¬¡
$ top
top - 11:58:59 up 9 days, 22:47,  1 user,  load average: 0.03, 0.02, 0.00
Tasks: 123 total,   1 running,  72 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.3 us,  0.3 sy,  0.0 ni, 99.3 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem :  8169348 total,  5606884 free,   334640 used,  2227824 buff/cache
KiB Swap:        0 total,        0 free,        0 used.  7497908 avail Mem

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
    1 root      20   0   78088   9288   6696 S   0.0  0.1   0:16.83 systemd
    2 root      20   0       0      0      0 S   0.0  0.0   0:00.05 kthreadd
    4 root       0 -20       0      0      0 I   0.0  0.0   0:00.00 kworker/0:0H
...
</code></pre><p>è¿™ä¸ªè¾“å‡ºç»“æœä¸­ï¼Œç¬¬ä¸‰è¡Œ %Cpu å°±æ˜¯ç³»ç»Ÿçš„ CPU ä½¿ç”¨ç‡ï¼Œå…·ä½“æ¯ä¸€åˆ—çš„å«ä¹‰ä¸Šä¸€èŠ‚éƒ½è®²è¿‡ï¼Œåªæ˜¯æŠŠCPUæ—¶é—´å˜æ¢æˆäº†CPUä½¿ç”¨ç‡ï¼Œæˆ‘å°±ä¸å†é‡å¤è®²äº†ã€‚ä¸è¿‡éœ€è¦æ³¨æ„ï¼Œtop é»˜è®¤æ˜¾ç¤ºçš„æ˜¯æ‰€æœ‰ CPU çš„å¹³å‡å€¼ï¼Œè¿™ä¸ªæ—¶å€™ä½ åªéœ€è¦æŒ‰ä¸‹æ•°å­— 1 ï¼Œå°±å¯ä»¥åˆ‡æ¢åˆ°æ¯ä¸ª CPU çš„ä½¿ç”¨ç‡äº†ã€‚</p><p>ç»§ç»­å¾€ä¸‹çœ‹ï¼Œç©ºç™½è¡Œä¹‹åæ˜¯è¿›ç¨‹çš„å®æ—¶ä¿¡æ¯ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ª %CPU åˆ—ï¼Œè¡¨ç¤ºè¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡ã€‚å®ƒæ˜¯ç”¨æˆ·æ€å’Œå†…æ ¸æ€ CPU ä½¿ç”¨ç‡çš„æ€»å’Œï¼ŒåŒ…æ‹¬è¿›ç¨‹ç”¨æˆ·ç©ºé—´ä½¿ç”¨çš„ CPUã€é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œçš„å†…æ ¸ç©ºé—´ CPU ã€ä»¥åŠåœ¨å°±ç»ªé˜Ÿåˆ—ç­‰å¾…è¿è¡Œçš„ CPUã€‚åœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ï¼Œå®ƒè¿˜åŒ…æ‹¬äº†è¿è¡Œè™šæ‹Ÿæœºå ç”¨çš„ CPUã€‚</p><p>æ‰€ä»¥ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ top å¹¶æ²¡æœ‰ç»†åˆ†è¿›ç¨‹çš„ç”¨æˆ·æ€CPUå’Œå†…æ ¸æ€ CPUã€‚é‚£è¦æ€ä¹ˆæŸ¥çœ‹æ¯ä¸ªè¿›ç¨‹çš„è¯¦ç»†æƒ…å†µå‘¢ï¼Ÿä½ åº”è¯¥è¿˜è®°å¾—ä¸Šä¸€èŠ‚ç”¨åˆ°çš„  pidstat  å§ï¼Œå®ƒæ­£æ˜¯ä¸€ä¸ªä¸“é—¨åˆ†ææ¯ä¸ªè¿›ç¨‹ CPU ä½¿ç”¨æƒ…å†µçš„å·¥å…·ã€‚</p><p>æ¯”å¦‚ï¼Œä¸‹é¢çš„pidstatå‘½ä»¤ï¼Œå°±é—´éš”1ç§’å±•ç¤ºäº†è¿›ç¨‹çš„5ç»„CPUä½¿ç”¨ç‡ï¼ŒåŒ…æ‹¬ï¼š</p><ul>
<li>
<p>ç”¨æˆ·æ€CPUä½¿ç”¨ç‡ ï¼ˆ%usrï¼‰ï¼›</p>
</li>
<li>
<p>å†…æ ¸æ€CPUä½¿ç”¨ç‡ï¼ˆ%systemï¼‰ï¼›</p>
</li>
<li>
<p>è¿è¡Œè™šæ‹ŸæœºCPUä½¿ç”¨ç‡ï¼ˆ%guestï¼‰ï¼›</p>
</li>
<li>
<p>ç­‰å¾… CPUä½¿ç”¨ç‡ï¼ˆ%waitï¼‰ï¼›</p>
</li>
<li>
<p>ä»¥åŠæ€»çš„CPUä½¿ç”¨ç‡ï¼ˆ%CPUï¼‰ã€‚</p>
</li>
</ul><p>æœ€åçš„ Average éƒ¨åˆ†ï¼Œè¿˜è®¡ç®—äº† 5 ç»„æ•°æ®çš„å¹³å‡å€¼ã€‚</p><pre><code># æ¯éš”1ç§’è¾“å‡ºä¸€ç»„æ•°æ®ï¼Œå…±è¾“å‡º5ç»„
$ pidstat 1 5
15:56:02      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
15:56:03        0     15006    0.00    0.99    0.00    0.00    0.99     1  dockerd

...

Average:      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
Average:        0     15006    0.00    0.99    0.00    0.00    0.99     -  dockerd
</code></pre><h2>CPU ä½¿ç”¨ç‡è¿‡é«˜æ€ä¹ˆåŠï¼Ÿ</h2><p>é€šè¿‡ topã€psã€pidstat ç­‰å·¥å…·ï¼Œä½ èƒ½å¤Ÿè½»æ¾æ‰¾åˆ° CPU ä½¿ç”¨ç‡è¾ƒé«˜ï¼ˆæ¯”å¦‚ 100% ï¼‰çš„è¿›ç¨‹ã€‚æ¥ä¸‹æ¥ï¼Œä½ å¯èƒ½åˆæƒ³çŸ¥é“ï¼Œå ç”¨ CPU çš„åˆ°åº•æ˜¯ä»£ç é‡Œçš„å“ªä¸ªå‡½æ•°å‘¢ï¼Ÿæ‰¾åˆ°å®ƒï¼Œä½ æ‰èƒ½æ›´é«˜æ•ˆã€æ›´é’ˆå¯¹æ€§åœ°è¿›è¡Œä¼˜åŒ–ã€‚</p><p>æˆ‘çŒœä½ ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„ï¼Œåº”è¯¥æ˜¯ GDBï¼ˆThe GNU Project Debuggerï¼‰ï¼Œ è¿™ä¸ªåŠŸèƒ½å¼ºå¤§çš„ç¨‹åºè°ƒè¯•åˆ©å™¨ã€‚çš„ç¡®ï¼ŒGDB åœ¨è°ƒè¯•ç¨‹åºé”™è¯¯æ–¹é¢å¾ˆå¼ºå¤§ã€‚ä½†æ˜¯ï¼Œæˆ‘åˆè¦æ¥â€œæŒ‘åˆºâ€äº†ã€‚è¯·ä½ è®°ä½ï¼ŒGDB å¹¶ä¸é€‚åˆåœ¨æ€§èƒ½åˆ†æçš„æ—©æœŸåº”ç”¨ã€‚</p><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸º GDB è°ƒè¯•ç¨‹åºçš„è¿‡ç¨‹ä¼šä¸­æ–­ç¨‹åºè¿è¡Œï¼Œè¿™åœ¨çº¿ä¸Šç¯å¢ƒå¾€å¾€æ˜¯ä¸å…è®¸çš„ã€‚æ‰€ä»¥ï¼ŒGDB åªé€‚åˆç”¨åœ¨æ€§èƒ½åˆ†æçš„åæœŸï¼Œå½“ä½ æ‰¾åˆ°äº†å‡ºé—®é¢˜çš„å¤§è‡´å‡½æ•°åï¼Œçº¿ä¸‹å†å€ŸåŠ©å®ƒæ¥è¿›ä¸€æ­¥è°ƒè¯•å‡½æ•°å†…éƒ¨çš„é—®é¢˜ã€‚</p><p>é‚£ä¹ˆå“ªç§å·¥å…·é€‚åˆåœ¨ç¬¬ä¸€æ—¶é—´åˆ†æè¿›ç¨‹çš„ CPU é—®é¢˜å‘¢ï¼Ÿæˆ‘çš„æ¨èæ˜¯ perfã€‚perf æ˜¯ Linux 2.6.31 ä»¥åå†…ç½®çš„æ€§èƒ½åˆ†æå·¥å…·ã€‚å®ƒä»¥æ€§èƒ½äº‹ä»¶é‡‡æ ·ä¸ºåŸºç¡€ï¼Œä¸ä»…å¯ä»¥åˆ†æç³»ç»Ÿçš„å„ç§äº‹ä»¶å’Œå†…æ ¸æ€§èƒ½ï¼Œè¿˜å¯ä»¥ç”¨æ¥åˆ†ææŒ‡å®šåº”ç”¨ç¨‹åºçš„æ€§èƒ½é—®é¢˜ã€‚</p><p>ä½¿ç”¨ perf åˆ†æ CPU æ€§èƒ½é—®é¢˜ï¼Œæˆ‘æ¥è¯´ä¸¤ç§æœ€å¸¸è§ã€ä¹Ÿæ˜¯æˆ‘æœ€å–œæ¬¢çš„ç”¨æ³•ã€‚</p><p>ç¬¬ä¸€ç§å¸¸è§ç”¨æ³•æ˜¯ perf topï¼Œç±»ä¼¼äº topï¼Œå®ƒèƒ½å¤Ÿå®æ—¶æ˜¾ç¤ºå ç”¨ CPU æ—¶é’Ÿæœ€å¤šçš„å‡½æ•°æˆ–è€…æŒ‡ä»¤ï¼Œå› æ­¤å¯ä»¥ç”¨æ¥æŸ¥æ‰¾çƒ­ç‚¹å‡½æ•°ï¼Œä½¿ç”¨ç•Œé¢å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>$ perf top
Samples: 833  of event 'cpu-clock', Event count (approx.): 97742399
Overhead  Shared Object       Symbol
   7.28%  perf                [.] 0x00000000001f78a4
   4.72%  [kernel]            [k] vsnprintf
   4.32%  [kernel]            [k] module_get_kallsym
   3.65%  [kernel]            [k] _raw_spin_unlock_irqrestore
...
</code></pre><p>è¾“å‡ºç»“æœä¸­ï¼Œç¬¬ä¸€è¡ŒåŒ…å«ä¸‰ä¸ªæ•°æ®ï¼Œåˆ†åˆ«æ˜¯é‡‡æ ·æ•°ï¼ˆSamplesï¼‰ã€äº‹ä»¶ç±»å‹ï¼ˆeventï¼‰å’Œäº‹ä»¶æ€»æ•°é‡ï¼ˆEvent countï¼‰ã€‚æ¯”å¦‚è¿™ä¸ªä¾‹å­ä¸­ï¼Œperf æ€»å…±é‡‡é›†äº† 833 ä¸ª CPU æ—¶é’Ÿäº‹ä»¶ï¼Œè€Œæ€»äº‹ä»¶æ•°åˆ™ä¸º 97742399ã€‚</p><p>å¦å¤–ï¼Œ<strong>é‡‡æ ·æ•°éœ€è¦æˆ‘ä»¬ç‰¹åˆ«æ³¨æ„</strong>ã€‚å¦‚æœé‡‡æ ·æ•°è¿‡å°‘ï¼ˆæ¯”å¦‚åªæœ‰åå‡ ä¸ªï¼‰ï¼Œé‚£ä¸‹é¢çš„æ’åºå’Œç™¾åˆ†æ¯”å°±æ²¡ä»€ä¹ˆå®é™…å‚è€ƒä»·å€¼äº†ã€‚</p><p>å†å¾€ä¸‹çœ‹æ˜¯ä¸€ä¸ªè¡¨æ ¼å¼æ ·çš„æ•°æ®ï¼Œæ¯ä¸€è¡ŒåŒ…å«å››åˆ—ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul>
<li>
<p>ç¬¬ä¸€åˆ— Overhead ï¼Œæ˜¯è¯¥ç¬¦å·çš„æ€§èƒ½äº‹ä»¶åœ¨æ‰€æœ‰é‡‡æ ·ä¸­çš„æ¯”ä¾‹ï¼Œç”¨ç™¾åˆ†æ¯”æ¥è¡¨ç¤ºã€‚</p>
</li>
<li>
<p>ç¬¬äºŒåˆ— Shared ï¼Œæ˜¯è¯¥å‡½æ•°æˆ–æŒ‡ä»¤æ‰€åœ¨çš„åŠ¨æ€å…±äº«å¯¹è±¡ï¼ˆDynamic Shared Objectï¼‰ï¼Œå¦‚å†…æ ¸ã€è¿›ç¨‹åã€åŠ¨æ€é“¾æ¥åº“åã€å†…æ ¸æ¨¡å—åç­‰ã€‚</p>
</li>
<li>
<p>ç¬¬ä¸‰åˆ— Object ï¼Œæ˜¯åŠ¨æ€å…±äº«å¯¹è±¡çš„ç±»å‹ã€‚æ¯”å¦‚ [.] è¡¨ç¤ºç”¨æˆ·ç©ºé—´çš„å¯æ‰§è¡Œç¨‹åºã€æˆ–è€…åŠ¨æ€é“¾æ¥åº“ï¼Œè€Œ [k] åˆ™è¡¨ç¤ºå†…æ ¸ç©ºé—´ã€‚</p>
</li>
<li>
<p>æœ€åä¸€åˆ— Symbol æ˜¯ç¬¦å·åï¼Œä¹Ÿå°±æ˜¯å‡½æ•°åã€‚å½“å‡½æ•°åæœªçŸ¥æ—¶ï¼Œç”¨åå…­è¿›åˆ¶çš„åœ°å€æ¥è¡¨ç¤ºã€‚</p>
</li>
</ul><p>è¿˜æ˜¯ä»¥ä¸Šé¢çš„è¾“å‡ºä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå ç”¨ CPU æ—¶é’Ÿæœ€å¤šçš„æ˜¯ perf å·¥å…·è‡ªèº«ï¼Œä¸è¿‡å®ƒçš„æ¯”ä¾‹ä¹Ÿåªæœ‰ 7.28%ï¼Œè¯´æ˜ç³»ç»Ÿå¹¶æ²¡æœ‰ CPU æ€§èƒ½é—®é¢˜ã€‚ perf topçš„ä½¿ç”¨ä½ åº”è¯¥å¾ˆæ¸…æ¥šäº†å§ã€‚</p><p>æ¥ç€å†æ¥çœ‹ç¬¬äºŒç§å¸¸è§ç”¨æ³•ï¼Œä¹Ÿå°±æ˜¯ perf record å’Œ perf reportã€‚ perf top è™½ç„¶å®æ—¶å±•ç¤ºäº†ç³»ç»Ÿçš„æ€§èƒ½ä¿¡æ¯ï¼Œä½†å®ƒçš„ç¼ºç‚¹æ˜¯å¹¶ä¸ä¿å­˜æ•°æ®ï¼Œä¹Ÿå°±æ— æ³•ç”¨äºç¦»çº¿æˆ–è€…åç»­çš„åˆ†æã€‚è€Œ perf record åˆ™æä¾›äº†ä¿å­˜æ•°æ®çš„åŠŸèƒ½ï¼Œä¿å­˜åçš„æ•°æ®ï¼Œéœ€è¦ä½ ç”¨ perf report è§£æå±•ç¤ºã€‚</p><pre><code>$ perf record # æŒ‰Ctrl+Cç»ˆæ­¢é‡‡æ ·
[ perf record: Woken up 1 times to write data ]
[ perf record: Captured and wrote 0.452 MB perf.data (6093 samples) ]

$ perf report # å±•ç¤ºç±»ä¼¼äºperf topçš„æŠ¥å‘Š
</code></pre><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬è¿˜ç»å¸¸ä¸º perf top å’Œ perf record åŠ ä¸Š -g å‚æ•°ï¼Œå¼€å¯è°ƒç”¨å…³ç³»çš„é‡‡æ ·ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ ¹æ®è°ƒç”¨é“¾æ¥åˆ†ææ€§èƒ½é—®é¢˜ã€‚</p><h2>æ¡ˆä¾‹</h2><p>ä¸‹é¢æˆ‘ä»¬å°±ä»¥ Nginx + PHP çš„ Web æœåŠ¡ä¸ºä¾‹ï¼Œæ¥çœ‹çœ‹å½“ä½ å‘ç° CPU ä½¿ç”¨ç‡è¿‡é«˜çš„é—®é¢˜åï¼Œè¦æ€ä¹ˆä½¿ç”¨ top ç­‰å·¥å…·æ‰¾å‡ºå¼‚å¸¸çš„è¿›ç¨‹ï¼Œåˆè¦æ€ä¹ˆåˆ©ç”¨ perf æ‰¾å‡ºå¼•å‘æ€§èƒ½é—®é¢˜çš„å‡½æ•°ã€‚</p><h3>ä½ çš„å‡†å¤‡</h3><p>ä»¥ä¸‹æ¡ˆä¾‹åŸºäº Ubuntu 18.04ï¼ŒåŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿã€‚æˆ‘ä½¿ç”¨çš„æ¡ˆä¾‹ç¯å¢ƒå¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul>
<li>
<p>æœºå™¨é…ç½®ï¼š2 CPUï¼Œ8GB å†…å­˜</p>
</li>
<li>
<p>é¢„å…ˆå®‰è£… dockerã€sysstatã€perfã€ab ç­‰å·¥å…·ï¼Œå¦‚ apt install <a href="http://docker.io">docker.io</a> sysstat linux-tools-common apache2-utils</p>
</li>
</ul><p>æˆ‘å…ˆç®€å•ä»‹ç»ä¸€ä¸‹è¿™æ¬¡æ–°ä½¿ç”¨çš„å·¥å…· abã€‚abï¼ˆapache benchï¼‰æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ HTTP æœåŠ¡æ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œè¿™é‡Œç”¨æ¥æ¨¡æ‹Ÿ Ngnix çš„å®¢æˆ·ç«¯ã€‚ç”±äº Nginx å’Œ PHP çš„é…ç½®æ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘æŠŠå®ƒä»¬æ‰“åŒ…æˆäº†ä¸¤ä¸ª <a href="https://github.com/feiskyer/linux-perf-examples/tree/master/nginx-high-cpu">Docker é•œåƒ</a>ï¼Œè¿™æ ·åªéœ€è¦è¿è¡Œä¸¤ä¸ªå®¹å™¨ï¼Œå°±å¯ä»¥å¾—åˆ°æ¨¡æ‹Ÿç¯å¢ƒã€‚</p><p>æ³¨æ„ï¼Œè¿™ä¸ªæ¡ˆä¾‹è¦ç”¨åˆ°ä¸¤å°è™šæ‹Ÿæœºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/90/3d/90c30b4f555218f77241bfe2ac27723d.png" alt=""></p><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œå…¶ä¸­ä¸€å°ç”¨ä½œ Web æœåŠ¡å™¨ï¼Œæ¥æ¨¡æ‹Ÿæ€§èƒ½é—®é¢˜ï¼›å¦ä¸€å°ç”¨ä½œ Web æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ï¼Œæ¥ç»™ Web æœåŠ¡å¢åŠ å‹åŠ›è¯·æ±‚ã€‚ä½¿ç”¨ä¸¤å°è™šæ‹Ÿæœºæ˜¯ä¸ºäº†ç›¸äº’éš”ç¦»ï¼Œé¿å…â€œäº¤å‰æ„ŸæŸ“â€ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯ï¼Œåˆ†åˆ« SSH ç™»å½•åˆ°ä¸¤å°æœºå™¨ä¸Šï¼Œå¹¶å®‰è£…ä¸Šé¢æåˆ°çš„å·¥å…·ã€‚</p><p>è¿˜æ˜¯åŒæ ·çš„â€œé…æ–¹â€ã€‚ä¸‹é¢çš„æ‰€æœ‰å‘½ä»¤ï¼Œéƒ½é»˜è®¤å‡è®¾ä»¥ root ç”¨æˆ·è¿è¡Œï¼Œå¦‚æœä½ æ˜¯æ™®é€šç”¨æˆ·èº«ä»½ç™»é™†ç³»ç»Ÿï¼Œä¸€å®šè¦å…ˆè¿è¡Œ sudo su root å‘½ä»¤åˆ‡æ¢åˆ° root ç”¨æˆ·ã€‚åˆ°è¿™é‡Œï¼Œå‡†å¤‡å·¥ä½œå°±å®Œæˆäº†ã€‚</p><p>ä¸è¿‡ï¼Œæ“ä½œä¹‹å‰ï¼Œæˆ‘è¿˜æƒ³å†è¯´ä¸€ç‚¹ã€‚è¿™æ¬¡æ¡ˆä¾‹ä¸­ PHP åº”ç”¨çš„æ ¸å¿ƒé€»è¾‘æ¯”è¾ƒç®€å•ï¼Œå¤§éƒ¨åˆ†äººä¸€çœ¼å°±å¯ä»¥çœ‹å‡ºé—®é¢˜ï¼Œä½†ä½ è¦çŸ¥é“ï¼Œå®é™…ç”Ÿäº§ç¯å¢ƒä¸­çš„æºç å°±å¤æ‚å¤šäº†ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘å¸Œæœ›ä½ åœ¨æŒ‰ç…§æ­¥éª¤æ“ä½œä¹‹å‰ï¼Œå…ˆä¸è¦æŸ¥çœ‹æºç ï¼ˆé¿å…å…ˆå…¥ä¸ºä¸»ï¼‰ï¼Œè€Œæ˜¯<strong>æŠŠå®ƒå½“æˆä¸€ä¸ªé»‘ç›’æ¥åˆ†æã€‚</strong>è¿™æ ·ï¼Œä½ å¯ä»¥æ›´å¥½åœ°ç†è§£æ•´ä¸ªè§£å†³æ€è·¯ï¼Œæ€ä¹ˆä»ç³»ç»Ÿçš„èµ„æºä½¿ç”¨é—®é¢˜å‡ºå‘ï¼Œåˆ†æå‡ºç“¶é¢ˆæ‰€åœ¨çš„åº”ç”¨ã€ä»¥åŠç“¶é¢ˆåœ¨åº”ç”¨ä¸­çš„å¤§æ¦‚ä½ç½®ã€‚</p><h3>æ“ä½œå’Œåˆ†æ</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ­£å¼è¿›å…¥æ“ä½œç¯èŠ‚ã€‚</p><p>é¦–å…ˆï¼Œåœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡Œ Nginx å’Œ PHP åº”ç”¨ï¼š</p><pre><code>$ docker run --name nginx -p 10000:80 -itd feisky/nginx
$ docker run --name phpfpm -itd --network container:nginx feisky/php-fpm
</code></pre><p>ç„¶åï¼Œåœ¨ç¬¬äºŒä¸ªç»ˆç«¯ä½¿ç”¨ curl è®¿é—® http://[VM1çš„IP]:10000ï¼Œç¡®è®¤ Nginx å·²æ­£å¸¸å¯åŠ¨ã€‚ä½ åº”è¯¥å¯ä»¥çœ‹åˆ° It works! çš„å“åº”ã€‚</p><pre><code># 192.168.0.10æ˜¯ç¬¬ä¸€å°è™šæ‹Ÿæœºçš„IPåœ°å€
$ curl http://192.168.0.10:10000/
It works!
</code></pre><p>æ¥ç€ï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹è¿™ä¸ª Nginx æœåŠ¡çš„æ€§èƒ½ã€‚åœ¨ç¬¬äºŒä¸ªç»ˆç«¯è¿è¡Œä¸‹é¢çš„ ab å‘½ä»¤ï¼š</p><pre><code># å¹¶å‘10ä¸ªè¯·æ±‚æµ‹è¯•Nginxæ€§èƒ½ï¼Œæ€»å…±æµ‹è¯•100ä¸ªè¯·æ±‚
$ ab -c 10 -n 100 http://192.168.0.10:10000/
This is ApacheBench, Version 2.3 &lt;$Revision: 1706008 $&gt;
Copyright 1996 Adam Twiss, Zeus Technology Ltd, 
...
Requests per second:    11.63 [#/sec] (mean)
Time per request:       859.942 [ms] (mean)
...
</code></pre><p>ä»abçš„è¾“å‡ºç»“æœæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒNginxèƒ½æ‰¿å—çš„æ¯ç§’å¹³å‡è¯·æ±‚æ•°åªæœ‰ 11.63ã€‚ä½ ä¸€å®šåœ¨åæ§½ï¼Œè¿™ä¹Ÿå¤ªå·®äº†å§ã€‚é‚£åˆ°åº•æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬ç”¨ top å’Œ pidstat å†æ¥è§‚å¯Ÿä¸‹ã€‚</p><p>è¿™æ¬¡ï¼Œæˆ‘ä»¬åœ¨ç¬¬äºŒä¸ªç»ˆç«¯ï¼Œå°†æµ‹è¯•çš„è¯·æ±‚æ€»æ•°å¢åŠ åˆ° 10000ã€‚è¿™æ ·å½“ä½ åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…·æ—¶ï¼Œ Nginx çš„å‹åŠ›è¿˜æ˜¯ç»§ç»­ã€‚</p><p>ç»§ç»­åœ¨ç¬¬äºŒä¸ªç»ˆç«¯ï¼Œè¿è¡Œ ab å‘½ä»¤ï¼š</p><pre><code>$ ab -c 10 -n 10000 http://10.240.0.5:10000/
</code></pre><p>æ¥ç€ï¼Œå›åˆ°ç¬¬ä¸€ä¸ªç»ˆç«¯è¿è¡Œ top å‘½ä»¤ï¼Œå¹¶æŒ‰ä¸‹æ•°å­— 1 ï¼Œåˆ‡æ¢åˆ°æ¯ä¸ª CPU çš„ä½¿ç”¨ç‡ï¼š</p><pre><code>$ top
...
%Cpu0  : 98.7 us,  1.3 sy,  0.0 ni,  0.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
%Cpu1  : 99.3 us,  0.7 sy,  0.0 ni,  0.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
...
  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
21514 daemon    20   0  336696  16384   8712 R  41.9  0.2   0:06.00 php-fpm
21513 daemon    20   0  336696  13244   5572 R  40.2  0.2   0:06.08 php-fpm
21515 daemon    20   0  336696  16384   8712 R  40.2  0.2   0:05.67 php-fpm
21512 daemon    20   0  336696  13244   5572 R  39.9  0.2   0:05.87 php-fpm
21516 daemon    20   0  336696  16384   8712 R  35.9  0.2   0:05.61 php-fpm
</code></pre><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œç³»ç»Ÿä¸­æœ‰å‡ ä¸ª php-fpm è¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡åŠ èµ·æ¥æ¥è¿‘ 200%ï¼›è€Œæ¯ä¸ª CPU çš„ç”¨æˆ·ä½¿ç”¨ç‡ï¼ˆusï¼‰ä¹Ÿå·²ç»è¶…è¿‡äº† 98%ï¼Œæ¥è¿‘é¥±å’Œã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¡®è®¤ï¼Œæ­£æ˜¯ç”¨æˆ·ç©ºé—´çš„ php-fpm è¿›ç¨‹ï¼Œå¯¼è‡´CPU ä½¿ç”¨ç‡éª¤å‡ã€‚</p><p>é‚£å†å¾€ä¸‹èµ°ï¼Œæ€ä¹ˆçŸ¥é“æ˜¯ php-fpm çš„å“ªä¸ªå‡½æ•°å¯¼è‡´äº† CPU ä½¿ç”¨ç‡å‡é«˜å‘¢ï¼Ÿæˆ‘ä»¬æ¥ç”¨ perf åˆ†æä¸€ä¸‹ã€‚åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯è¿è¡Œä¸‹é¢çš„perfå‘½ä»¤ï¼š</p><pre><code># -gå¼€å¯è°ƒç”¨å…³ç³»åˆ†æï¼Œ-pæŒ‡å®šphp-fpmçš„è¿›ç¨‹å·21515
$ perf top -g -p 21515
</code></pre><p>æŒ‰æ–¹å‘é”®åˆ‡æ¢åˆ° php-fpmï¼Œå†æŒ‰ä¸‹å›è½¦é”®å±•å¼€ php-fpm çš„è°ƒç”¨å…³ç³»ï¼Œä½ ä¼šå‘ç°ï¼Œè°ƒç”¨å…³ç³»æœ€ç»ˆåˆ°äº† sqrt å’Œ add_functionã€‚çœ‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä»è¿™ä¸¤ä¸ªå‡½æ•°å…¥æ‰‹äº†ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/6e/10/6e58d2f7b1ace94501b1833bab16f210.png" alt=""></p><p>æˆ‘ä»¬æ‹·è´å‡º <a href="https://github.com/feiskyer/linux-perf-examples/blob/master/nginx-high-cpu/app/index.php">Nginx åº”ç”¨çš„æºç </a>ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯è°ƒç”¨äº†è¿™ä¸¤ä¸ªå‡½æ•°ï¼š</p><pre><code># ä»å®¹å™¨phpfpmä¸­å°†PHPæºç æ‹·è´å‡ºæ¥
$ docker cp phpfpm:/app .

# ä½¿ç”¨grepæŸ¥æ‰¾å‡½æ•°è°ƒç”¨
$ grep sqrt -r app/ #æ‰¾åˆ°äº†sqrtè°ƒç”¨
app/index.php:  $x += sqrt($x);
$ grep add_function -r app/ #æ²¡æ‰¾åˆ°add_functionè°ƒç”¨ï¼Œè¿™å…¶å®æ˜¯PHPå†…ç½®å‡½æ•°
</code></pre><p>OKï¼ŒåŸæ¥åªæœ‰ sqrt å‡½æ•°åœ¨ app/index.php æ–‡ä»¶ä¸­è°ƒç”¨äº†ã€‚é‚£æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬å°±è¯¥çœ‹çœ‹è¿™ä¸ªæ–‡ä»¶çš„æºç äº†ï¼š</p><pre><code>$ cat app/index.php
&lt;?php
// test only.
$x = 0.0001;
for ($i = 0; $i &lt;= 1000000; $i++) {
  $x += sqrt($x);
}

echo &quot;It works!&quot;
</code></pre><p>å‘€ï¼Œæœ‰æ²¡æœ‰å‘ç°é—®é¢˜åœ¨å“ªé‡Œå‘¢ï¼Ÿæˆ‘æƒ³ä½ è¦ç¬‘è¯æˆ‘äº†ï¼Œå±…ç„¶çŠ¯äº†ä¸€ä¸ªè¿™ä¹ˆå‚»çš„é”™è¯¯ï¼Œæµ‹è¯•ä»£ç æ²¡åˆ å°±ç›´æ¥å‘å¸ƒåº”ç”¨äº†ã€‚ä¸ºäº†æ–¹ä¾¿ä½ éªŒè¯ä¼˜åŒ–åçš„æ•ˆæœï¼Œæˆ‘æŠŠä¿®å¤åçš„åº”ç”¨ä¹Ÿæ‰“åŒ…æˆäº†ä¸€ä¸ªDockeré•œåƒï¼Œä½ å¯ä»¥åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡Œå®ƒï¼š</p><pre><code># åœæ­¢åŸæ¥çš„åº”ç”¨
$ docker rm -f nginx phpfpm
# è¿è¡Œä¼˜åŒ–åçš„åº”ç”¨
$ docker run --name nginx -p 10000:80 -itd feisky/nginx:cpu-fix
$ docker run --name phpfpm -itd --network container:nginx feisky/php-fpm:cpu-fix
</code></pre><p>æ¥ç€ï¼Œåˆ°ç¬¬äºŒä¸ªç»ˆç«¯æ¥éªŒè¯ä¸€ä¸‹ä¿®å¤åçš„æ•ˆæœã€‚é¦–å…ˆCtrl+Cåœæ­¢ä¹‹å‰çš„abå‘½ä»¤åï¼Œå†è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p><pre><code>$ ab -c 10 -n 10000 http://10.240.0.5:10000/
...
Complete requests:      10000
Failed requests:        0
Total transferred:      1720000 bytes
HTML transferred:       90000 bytes
Requests per second:    2237.04 [#/sec] (mean)
Time per request:       4.470 [ms] (mean)
Time per request:       0.447 [ms] (mean, across all concurrent requests)
Transfer rate:          375.75 [Kbytes/sec] received
...
</code></pre><p>ä»è¿™é‡Œä½ å¯ä»¥å‘ç°ï¼Œç°åœ¨æ¯ç§’çš„å¹³å‡è¯·æ±‚æ•°ï¼Œå·²ç»ä»åŸæ¥çš„11å˜æˆäº†2237ã€‚</p><p>ä½ çœ‹ï¼Œå°±æ˜¯è¿™ä¹ˆå¾ˆå‚»çš„ä¸€ä¸ªå°é—®é¢˜ï¼Œå´ä¼šæå¤§çš„å½±å“æ€§èƒ½ï¼Œå¹¶ä¸”æŸ¥æ‰¾èµ·æ¥ä¹Ÿå¹¶ä¸å®¹æ˜“å§ã€‚å½“ç„¶ï¼Œæ‰¾åˆ°é—®é¢˜åï¼Œè§£å†³æ–¹æ³•å°±ç®€å•å¤šäº†ï¼Œåˆ é™¤æµ‹è¯•ä»£ç å°±å¯ä»¥äº†ã€‚</p><h2>å°ç»“</h2><p>CPU ä½¿ç”¨ç‡æ˜¯æœ€ç›´è§‚å’Œæœ€å¸¸ç”¨çš„ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ï¼Œæ›´æ˜¯æˆ‘ä»¬åœ¨æ’æŸ¥æ€§èƒ½é—®é¢˜æ—¶ï¼Œé€šå¸¸ä¼šå…³æ³¨çš„ç¬¬ä¸€ä¸ªæŒ‡æ ‡ã€‚æ‰€ä»¥æˆ‘ä»¬æ›´è¦ç†Ÿæ‚‰å®ƒçš„å«ä¹‰ï¼Œå°¤å…¶è¦å¼„æ¸…æ¥šç”¨æˆ·ï¼ˆ%userï¼‰ã€Niceï¼ˆ%niceï¼‰ã€ç³»ç»Ÿï¼ˆ%systemï¼‰ ã€ç­‰å¾… I/Oï¼ˆ%iowaitï¼‰ ã€ä¸­æ–­ï¼ˆ%irqï¼‰ä»¥åŠè½¯ä¸­æ–­ï¼ˆ%softirqï¼‰è¿™å‡ ç§ä¸åŒ CPU çš„ä½¿ç”¨ç‡ã€‚æ¯”å¦‚è¯´ï¼š</p><ul>
<li>
<p>ç”¨æˆ· CPU å’Œ Nice CPU é«˜ï¼Œè¯´æ˜ç”¨æˆ·æ€è¿›ç¨‹å ç”¨äº†è¾ƒå¤šçš„ CPUï¼Œæ‰€ä»¥åº”è¯¥ç€é‡æ’æŸ¥è¿›ç¨‹çš„æ€§èƒ½é—®é¢˜ã€‚</p>
</li>
<li>
<p>ç³»ç»Ÿ CPU é«˜ï¼Œè¯´æ˜å†…æ ¸æ€å ç”¨äº†è¾ƒå¤šçš„ CPUï¼Œæ‰€ä»¥åº”è¯¥ç€é‡æ’æŸ¥å†…æ ¸çº¿ç¨‹æˆ–è€…ç³»ç»Ÿè°ƒç”¨çš„æ€§èƒ½é—®é¢˜ã€‚</p>
</li>
<li>
<p>I/O ç­‰å¾… CPU é«˜ï¼Œè¯´æ˜ç­‰å¾… I/O çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œæ‰€ä»¥åº”è¯¥ç€é‡æ’æŸ¥ç³»ç»Ÿå­˜å‚¨æ˜¯ä¸æ˜¯å‡ºç°äº† I/O é—®é¢˜ã€‚</p>
</li>
<li>
<p>è½¯ä¸­æ–­å’Œç¡¬ä¸­æ–­é«˜ï¼Œè¯´æ˜è½¯ä¸­æ–­æˆ–ç¡¬ä¸­æ–­çš„å¤„ç†ç¨‹åºå ç”¨äº†è¾ƒå¤šçš„ CPUï¼Œæ‰€ä»¥åº”è¯¥ç€é‡æ’æŸ¥å†…æ ¸ä¸­çš„ä¸­æ–­æœåŠ¡ç¨‹åºã€‚</p>
</li>
</ul><p>ç¢°åˆ° CPU ä½¿ç”¨ç‡å‡é«˜çš„é—®é¢˜ï¼Œä½ å¯ä»¥å€ŸåŠ© topã€pidstat ç­‰å·¥å…·ï¼Œç¡®è®¤å¼•å‘ CPU æ€§èƒ½é—®é¢˜çš„æ¥æºï¼›å†ä½¿ç”¨ perf ç­‰å·¥å…·ï¼Œæ’æŸ¥å‡ºå¼•èµ·æ€§èƒ½é—®é¢˜çš„å…·ä½“å‡½æ•°ã€‚</p><h2>æ€è€ƒ</h2><p>æœ€åï¼Œæˆ‘æƒ³é‚€è¯·ä½ ä¸€èµ·æ¥èŠèŠï¼Œä½ æ‰€ç†è§£çš„ CPU ä½¿ç”¨ç‡ï¼Œä»¥åŠåœ¨å‘ç° CPU ä½¿ç”¨ç‡å‡é«˜æ—¶ï¼Œä½ åˆæ˜¯æ€ä¹ˆåˆ†æçš„å‘¢ï¼Ÿä½ å¯ä»¥ç»“åˆä»Šå¤©çš„å†…å®¹ï¼Œå’Œä½ è‡ªå·±çš„æ“ä½œè®°å½•ï¼Œæ¥æ€»ç»“æ€è·¯ã€‚</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå’Œæˆ‘è®¨è®ºï¼Œä¹Ÿæ¬¢è¿æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ã€‚æˆ‘ä»¬ä¸€èµ·åœ¨å®æˆ˜ä¸­æ¼”ç»ƒï¼Œåœ¨äº¤æµä¸­è¿›æ­¥ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/56/52/565d66d658ad23b2f4997551db153852.jpg" alt=""></p>
                    </div>
                </div>

            </div>
            <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span
                    data-v-87ffcada="">ç²¾é€‰ç•™è¨€</span></h2>
                <ul data-v-87ffcada="">
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e7/47/d0715205.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Dç™½èœ</span>
                            </div>
                            <div class="bd">Day 5ï¼Œå¹²æ´»æ»¡æ»¡å•Šï¼Œè°¢è°¢è€å¸ˆå•Šã€‚<br>ä»Šå¤©æ€»ç»“å¦‚ä¸‹ï¼š<br>1ã€Linuxå¹¶å‘(ä»»åŠ¡å¹¶è¡Œ)çš„å®è´¨ï¼šLinux ä½œä¸ºä¸€ä¸ªå¤šä»»åŠ¡æ“ä½œç³»ç»Ÿï¼Œå°†æ¯ä¸ª CPU çš„æ—¶é—´åˆ’åˆ†ä¸ºå¾ˆçŸ­çš„æ—¶é—´ç‰‡ï¼Œå†é€šè¿‡è°ƒåº¦å™¨è½®æµåˆ†é…ç»™å„ä¸ªä»»åŠ¡ä½¿ç”¨<br>2ã€cpuçš„ç»´æŠ¤ï¼Œé€šè¿‡å®å…ˆå®šä¹‰çš„èŠ‚æ‹ç‡(å†…æ ¸ç”¨èµ«å…¹HZæ ‡ç¤º)è§¦å‘æ—¶é—´åˆ¤æ–­(å…¨å±€å˜é‡jiffiesè®°å½•)ã€‚<br>3ã€èŠ‚æ‹ç‡æ˜¯å†…æ ¸æ€è¿è¡Œï¼Œå±äºå†…æ ¸ç©ºé—´èŠ‚æ‹ç‡ï¼›ç”¨æˆ·ç©ºé—´èŠ‚æ‹ç‡( USER_HZ)æ˜¯ä¸€ä¸ªå›ºå®šè®¾ç½®<br>[root@dbayang ~]# grep &#39;CONFIG_HZ=&#39; &#47;boot&#47;config-$(uname -r)<br>CONFIG_HZ=1000<br>4ã€&#47;proc&#47;stat æä¾›çš„å°±æ˜¯ç³»ç»Ÿçš„ CPU å’Œä»»åŠ¡ç»Ÿè®¡ä¿¡æ¯ï¼› &#47;proc&#47;[pid]&#47;statå±•ç¤ºè¿›ç¨‹çš„CPUå’Œä»»åŠ¡ç»Ÿè®¡ä¿¡æ¯<br>5ã€cpuçš„ä½¿ç”¨ç‡={1-(idle_time&#47;total_cpu_time)}&#47;sample_time<br>6ã€æ€§èƒ½åˆ†æå·¥å…·ç»™å‡ºçš„éƒ½æ˜¯é—´éš”ä¸€æ®µæ—¶é—´çš„å¹³å‡ CPU ä½¿ç”¨ç‡ï¼Œæ‰€ä»¥è¦æ³¨æ„é—´éš”æ—¶é—´çš„è®¾ç½®ã€‚topé»˜è®¤ä¸º3sï¼Œpsä½¿ç”¨çš„æ˜¯è¿›ç¨‹è¿è¡Œæ—¶é—´ã€‚<br>7ã€topã€vmstatã€mpstatç­‰å‘½ä»¤ç§å…³äºcpuæ€§èƒ½ç›¸å…³æŒ‡æ ‡çš„å«ä¹‰<br>8ã€pidstatå‘½ä»¤å«ä¹‰<br>9ã€perf<br>       ä»¥å‰ç”¨åˆ°çš„ä¸€å †[n]traceåˆ†æå·¥å…·ï¼Œperfçš„ç›´è§‚æ˜“ç”¨ï¼Œè¿™æ˜¯ä»Šå¤©æœ€å¤§çš„æ”¶è·ï¼Œä½œä¸ºdbaå¯¹æ•°æ®åº“çš„åˆ†æä¹Ÿå¾ˆæœ‰çš„ï¼Œä¹ˆä¹ˆå“’ã€‚<br>perf topã€perf recordã€perf report<br>å¯¹è¿›ç¨‹è¿›è¡Œè·Ÿè¸ªåˆ†æå…¶è°ƒç”¨perf top -g -p &lt;mysqlpid&gt;<br>10ã€ä»Šå¤©ç”¨åˆ°æµ‹è¯•å·¥å…·ï¼šab <br></div>
                            <span class="time">2018-11-30 08:37</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘ è¯¾ä»£è¡¨çš„æ€»ç»“å¾ˆå…¨é¢</p>
                                <p class="reply-time">2018-11-30 22:43</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ¯å¤©æ™’ç™½ç‰™</span>
                            </div>
                            <div class="bd">ã€D5è¡¥å¡ã€‘<br>æˆ‘çš„ç³»ç»Ÿæ˜¯centos7ï¼Œä¸Šæ¬¡å®æˆ˜ç”¨ perf top -g -p pidæ²¡æœ‰çœ‹åˆ°å‡½æ•°åç§°ï¼Œåªèƒ½çœ‹åˆ°ä¸€å †åå…­è¿›åˆ¶çš„ä¸œè¥¿ï¼Œç„¶åè€å¸ˆç»™äº†è§£å†³æ–¹æ³•ï¼Œæˆ‘è½¬è¿°ä¸‹ï¼š<br>åˆ†æï¼šå½“æ²¡æœ‰çœ‹åˆ°å‡½æ•°åç§°ï¼Œåªçœ‹åˆ°äº†åå…­è¿›åˆ¶ç¬¦å·ï¼Œä¸‹é¢æœ‰Failed to open &#47;usr&#47;lib&#47;x86_64-linux-gnu&#47;libxml2.so.2.9.4, continuing without symbols  è¿™è¯´æ˜perfæ— æ³•æ‰¾åˆ°å¾…åˆ†æè¿›ç¨‹æ‰€ä¾èµ–çš„åº“ã€‚è¿™é‡Œåªæ˜¾ç¤ºäº†ä¸€ä¸ªï¼Œä½†å…¶å®ä¾èµ–çš„åº“è¿˜æœ‰å¾ˆå¤šã€‚è¿™ä¸ªé—®é¢˜å…¶å®æ˜¯åœ¨åˆ†æDockerå®¹å™¨åº”ç”¨æ—¶ç»å¸¸ä¼šç¢°åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºå®¹å™¨åº”ç”¨æ‰€ä¾èµ–çš„åº“éƒ½åœ¨é•œåƒé‡Œé¢ã€‚<br><br>è€å¸ˆç»™äº†ä¸¤ä¸ªè§£å†³æ€è·¯ï¼š<br>ï¼ˆ1ï¼‰åœ¨å®¹å™¨å¤–é¢æ„å»ºç›¸åŒè·¯å¾„çš„ä¾èµ–åº“ã€‚è¿™ç§æ–¹æ³•ä¸æ¨èï¼Œä¸€æ˜¯å› ä¸ºæ‰¾å‡ºè¿™äº›ä¾èµ–æ¯”è¾ƒéº»çƒ¦ï¼Œæ›´é‡è¦çš„æ˜¯æ„å»ºè¿™äº›è·¯å¾„ä¼šæ±¡æŸ“è™šæ‹Ÿæœºçš„ç¯å¢ƒã€‚<br>ï¼ˆ2ï¼‰åœ¨å®¹å™¨å¤–é¢æŠŠåˆ†æçºªå½•ä¿å­˜ä¸‹æ¥ï¼Œåˆ°å®¹å™¨é‡Œé¢å†å»æŸ¥çœ‹ç»“æœï¼Œè¿™æ ·åº“å’Œç¬¦å·çš„è·¯å¾„å°±éƒ½æ˜¯å¯¹çš„äº†ã€‚<br><br>æ“ä½œï¼š<br>ï¼ˆ1ï¼‰åœ¨Centosç³»ç»Ÿä¸Šè¿è¡Œ perf record -g -p &lt;pid&gt;ï¼Œæ‰§è¡Œä¸€ä¼šå„¿ï¼ˆæ¯”å¦‚15ç§’ï¼‰æŒ‰ctrl+cåœæ­¢<br>ï¼ˆ2ï¼‰æŠŠç”Ÿæˆçš„ perf.dataï¼ˆè¿™ä¸ªæ–‡ä»¶ç”Ÿæˆåœ¨æ‰§è¡Œå‘½ä»¤çš„å½“å‰ç›®å½•ä¸‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥æ‰¾å®ƒçš„è·¯å¾„ find | grep perf.dataæˆ– find &#47; -name perf.dataï¼‰æ–‡ä»¶æ‹·è´åˆ°å®¹å™¨é‡Œé¢åˆ†æ:<br>docker cp perf.data phpfpm:&#47;tmp<br>docker exec -i -t phpfpm bash<br>$ cd &#47;tmp&#47;<br>$ apt-get update &amp;&amp; apt-get install -y linux-perf linux-tools procps<br>$ perf_4.9 report<br><br>æ³¨æ„ï¼šæœ€åè¿è¡Œçš„å·¥å…·åå­—æ˜¯å®¹å™¨å†…éƒ¨å®‰è£…çš„ç‰ˆæœ¬ perf_4.9ï¼Œè€Œä¸æ˜¯ perf å‘½ä»¤ï¼Œè¿™æ˜¯å› ä¸º perf ä¼šå»è·Ÿå†…æ ¸çš„ç‰ˆæœ¬è¿›è¡ŒåŒ¹é…ï¼Œä½†é•œåƒé‡Œé¢å®‰è£…çš„perfç‰ˆæœ¬æœ‰å¯èƒ½è·Ÿè™šæ‹Ÿæœºçš„å†…æ ¸ç‰ˆæœ¬ä¸ä¸€è‡´ã€‚<br>æ³¨æ„ï¼šä¸Šé¢çš„é—®é¢˜åªæ˜¯åœ¨centosç³»ç»Ÿä¸­æœ‰é—®é¢˜ï¼Œubuntuä¸Šæ²¡æœ‰è¿™ä¸ªé—®é¢˜ <br></div>
                            <span class="time">2018-12-04 08:25</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/52/fe/df362d52.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ä¸çº¯æœ‰æœºç‰©</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œæˆ‘çš„ä¹Ÿæ˜¯æ— æ³•å®šä½åˆ°å…·ä½“çš„å‡½æ•°ï¼Œéƒ½æ˜¯16è¿›åˆ¶æ˜¾ç¤ºçš„ <br></div>
                            <span class="time">2018-11-30 11:44</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/24/d2/40353046.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">zeroxus</span>
                            </div>
                            <div class="bd">ã€D5ã€‘æ‰“å¡<br>å¹²è´§æ»¡æ»¡<br>ä½¿ç”¨Markdownæ•´ç†æˆäº†ç¬”è®°ï¼Œ é…åˆç›®å½•æŸ¥å›é¡¾ï¼Œä¼šæ–¹ä¾¿å¾ˆå¤š<br>https:&#47;&#47;www.zybuluo.com&#47;Gugoole&#47;note&#47;1354842 <br></div>
                            <span class="time">2018-11-30 15:07</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ¯å¤©æ™’ç™½ç‰™</span>
                            </div>
                            <div class="bd">ã€day5ã€‘æ‰“å¡<br>æ—©æ™¨å…­ç‚¹åŠèµ·æ¥è·Ÿç€ä¸“æ åœ¨è™šæ‹Ÿæœºä¸Šæï¼Œè¿™ä¸ªæ¡ˆä¾‹èƒ½å®Œæ•´è·Ÿä¸‹æ¥ä¹Ÿæ˜¯ä¸å®¹æ˜“ï¼Œè¿˜éœ€è¦dockerï¼Œä¸ªäººè®¤ä¸ºï¼Œè¿™ç§å®æˆ˜çš„è¯¾ï¼Œä¸€å®šè¦ä¸Šæ‰‹ï¼Œå…‰çœ‹æ˜¯ä¸è¡Œçš„ã€‚æ„¿è‡ªå·±èƒ½åšæŒä¸‹å»ã€‚ <br></div>
                            <span class="time">2018-11-30 07:20</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/a7/6d/19bff1f9.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ichen</span>
                            </div>
                            <div class="bd">å†…æ ¸å¦‚æœæ²¡æœ‰perf packageçš„è¯ï¼Œå¯ä»¥ä»gitä¸‹è½½æºç å®‰è£…<br>https:&#47;&#47;askubuntu.com&#47;questions&#47;50145&#47;how-to-install-perf-monitoring-tool&#47;306683<br><br>git clone https:&#47;&#47;git.kernel.org&#47;pub&#47;scm&#47;linux&#47;kernel&#47;git&#47;torvalds&#47;linux.git ï¼ˆå¤§çº¦2.5G å·¦å³ï¼‰<br>cd linux&#47;tools&#47;perf<br>make ï¼ˆå¯èƒ½ç¼ºflexï¼Œbisonç­‰ï¼Œéœ€è‡ªè¡Œå®‰è£…ï¼‰<br>cp perf &#47;usr&#47;bin<br>perf --version  <br></div>
                            <span class="time">2018-12-01 05:21</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ„Ÿè°¢åˆ†äº«</p>
                                <p class="reply-time">2018-12-03 09:04</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/b0/38/076fa6c1.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é£æ¸…æ‰¬ç¬‘</span>
                            </div>
                            <div class="bd">cpuä½¿ç”¨ç‡ï¼Œå°±æ˜¯cpuè¢«ä½¿ç”¨çš„æ¯”ä¾‹ï¼Œä¹Ÿå°±æ˜¯ç©ºé—²ä¹‹å¤–çš„ä½¿ç”¨æ¯”ä¾‹ã€‚<br><br>å¯¹æˆ‘æ¥è¯´ï¼Œå‘ç°cpuä½¿ç”¨ç‡é«˜åï¼Œå…ˆè·Ÿè€å¸ˆä¸€æ ·ç”¨perfæ¥æŠ“å–cpuæ¶ˆè€—æ ˆï¼Œå¾ˆå®¹æ˜“å‘ç°ç“¶é¢ˆã€‚<br><br>å¦å¤–ï¼Œæˆ‘ä¸€èˆ¬ç”¨mpstat -P ALL æ¥çœ‹å„ä¸ªcpuæ ¸å¿ƒçš„ä½¿ç”¨ç‡æƒ…å†µï¼Œå› ä¸ºtopä¹‹ç±»çš„çœ‹çš„æ˜¯ç³»ç»Ÿæ€»ä½¿ç”¨ç‡ï¼Œä¸ä¸€å®šèƒ½å‘ç°é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹åº”ç”¨ <br></div>
                            <span class="time">2018-11-30 01:19</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘</p>
                                <p class="reply-time">2018-11-30 08:22</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/50/89/a6259c76.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">åŒ—æ–—ç‹¼</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œé—®ä¸ªé—®é¢˜ï¼Œæˆ‘æŒ‰æ‚¨çš„æ–‡æ¡£ï¼Œæˆ‘ä½¿ç”¨perf top -g -p è¿›ç¨‹ID æ€ä¹ˆæ— æ³•æŸ¥çœ‹php-fpmçš„è°ƒç”¨å…³ç³»ï¼Œå‡ºä¸æ¥å“ªä¸ªå‡½æ•°è¾ƒç”¨è¾ƒé«˜çš„CPUï¼Ÿ ä»¥ä¸‹æ˜¯æˆ‘çš„æ˜¾ç¤ºç»“æœï¼Œæ‚¨å¸®æˆ‘çœ‹çœ‹ä¸ºä»€ä¹ˆæ˜¾ç¤ºçš„æ˜¯0x7fd...<br>1ã€å¼€å§‹å‹åŠ›æµ‹è¯•<br>ab -c 10 -n 10000 http:&#47;&#47;bjdsj-test-11-58:10001<br><br>2ã€æŸ¥çœ‹è°ƒç”¨å…³ç³» perf top -g -p 39826<br>Samples: 80K of event &#39;cycles&#39;, Event count (approx.): 29700884257                                                       <br>+   93.02%     0.69%  php-fpm             [.] 0x00000000008c296e<br>   0x7fd84a21c96e                                                                                                          <br>   0x7fd84a21d323                                                                                                          <br>   0x7fd84a185f94                                                                                                          <br>   0x7fd84a0d66fc                                                                                                          <br>   0x7fd84a325642                                                                                                          <br>   0x7fd842a702e1                                                                                                          <br>   0x6cb6258d4c544155 <br>+   23.35%     0.38%  php-fpm             [.] 0x00000000008c4a7c<br>+    5.60%     5.60%  libm-2.24.so        [.] 0x000000000002127e<br>+    4.22%     0.00%  php-fpm             [.] 0x000000000098dd97<br>+    2.54%     2.54%  php-fpm             [.] 0x000000000094ede0<br>+    1.96%     1.96%  php-fpm             [.] 0x0000000000681b9d<br>+    1.58%     1.58%  php-fpm             [.] 0x0000000000815e70<br>+    1.52%     1.51%  php-fpm             [.] 0x000000000094eddc<br>+    1.48%     1.48%  php-fpm             [.] 0x00000000008cd729<br>+    1.32%     1.32%  php-fpm             [.] 0x00000000008c4ae5<br>+    1.21%     1.21%  php-fpm             [.] 0x000000000098dc03<br>+    1.04%     1.04%  php-fpm             [.] 0x0000000000681b99<br>Failed to open &#47;opt&#47;bitnami&#47;php&#47;lib&#47;php&#47;extensions&#47;opcache.so, continuing without symbols<br> <br></div>
                            <span class="time">2018-11-30 14:28</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/b3/46/ec914238.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">espzest</span>
                            </div>
                            <div class="bd">iowaitæ‰€è€—è´¹çš„æ—¶é—´ï¼Œåº”è¯¥ä¸ç®—åˆ°cpuä½¿ç”¨ç‡é‡Œé¢å§ï¼Ÿ  å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œä¸Šé¢è®¡ç®—cpuä½¿ç”¨ç‡ é™¤å»idleä»¥å¤–çš„æ—¶é—´éƒ½ç®—ï¼Œæ˜¯ä¸æ˜¯æœ‰é—®é¢˜ï¼Ÿ <br></div>
                            <span class="time">2018-11-30 08:56</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/42/f7/45fd5e3b.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Cå®¶æ—çš„é“ç²‰å„¿</span>
                            </div>
                            <div class="bd">ã€D6æ‰“å¡ã€<br>è¿˜æ²¡æœ‰æ“ä½œå®éªŒï¼Œçœ‹äº†å†…å®¹ï¼Œå…ˆå ä¸ªä½ç½®ã€‚ <br></div>
                            <span class="time">2018-11-30 08:44</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æˆ‘æ¥ä¹Ÿ</span>
                            </div>
                            <div class="bd">[D5æ‰“å¡]<br>ä»¥å‰åªä¼šç”¨topçœ‹CPUä½¿ç”¨ç‡ï¼Œå‘ç°å ç”¨é«˜çš„è¿›ç¨‹äº†å†é’ˆå¯¹æ€§çš„åˆ†æï¼Œæ¯”å¦‚cç¨‹åºå°±ç”¨profï¼Œå±€é™æ€§å¾ˆé«˜ï¼Œ<br>ä»Šå¤©äº†è§£åˆ°å¯ä»¥ç”¨perfï¼Œç›´æ¥çœ‹è¿›ç¨‹å†…å‡½æ•°è°ƒç”¨æ ˆå’Œå„å‡½æ•°çš„cpuä½¿ç”¨ç‡ã€‚<br>ä»¥å‰çœ‹åˆ°%sysè¿‡é«˜ï¼Œç³»ç»Ÿä¸­æ–­æ•°è¿‡é«˜çš„åˆ¤æ–­æ–¹æ³•æ›´æç¬‘ï¼ŒæŒ¨ä¸ªæ€å¯ç–‘è¿›ç¨‹ã€‚<br>ç°åœ¨ç›´æ¥ç”¨pidstatå°±æ˜¯äº†ã€‚<br>â€”â€”â€”â€”â€”â€”<br>æœ€è¿‘åœ¨æŸäº‘æœåŠ¡å™¨ä¸Šå°±é‡åˆ°äº†è¯¡å¼‚çš„äº‹æƒ…ï¼Œcpuç©ºé—²75%ï¼Œ%iowaitä¸åˆ°1ï¼Œç³»ç»Ÿä¸­æ–­æ•°ä¸€ç›´æ¯”è¾ƒç¨³å®šï¼Œvmstatä¸­çš„ræ­£åœ¨è¿è¡Œå’Œç­‰å¾…é˜Ÿåˆ—ä¹Ÿè¿˜æ­£å¸¸ï¼Œä½†æ˜¯ç³»ç»Ÿæ¯éš”1å°æ—¶23åˆ†ï¼Œè´Ÿè½½load1ï¼šå°±ä¼šä»å¹³å¸¸çš„0.2å‡é«˜åˆ°8ç”šè‡³æ˜¯12çš„æƒ…å†µã€‚å¥½åœ¨æ¯æ¬¡æŒç»­æ—¶é—´è¾ƒçŸ­ï¼Œçº¦2åˆ†é’Ÿï¼Œload5çš„å€¼è¿˜å¯ä»¥æ¥å—ã€‚<br>äº‰å–æœ€è¿‘èƒ½æŠŠåŸå› æŸ¥å‡ºæ¥ï¼Œæ—©ç‚¹æŠŠå­¦è´¹èµšå›æ¥ï¼Œå“ˆå“ˆğŸ˜„<br>â€”â€”â€”â€”â€”<br>è™½ç„¶ä¹‹å‰å­¦k8sä¸“æ æ—¶ubuntu 18.04 å’Œdockeréƒ½é…å¥½äº†ï¼Œä½†æ˜¯æœ€è¿‘æ‰‹ä¸Šäº‹æƒ…æœ‰ç‚¹å¤šï¼Œè¿˜æ˜¯å…ˆè§£å†³æ‰‹ä¸Šçš„äº‹æƒ…å§ã€‚è€å¸ˆè§è°…å“ˆã€‚ <br></div>
                            <span class="time">2018-11-30 13:27</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¾ˆå¤šçº¿ä¸Šé—®é¢˜å…¶å®è·Ÿè¿™ä¸ªç±»ä¼¼ï¼Œç­‰åˆ°ä½ ç™»é™†æœåŠ¡å™¨çš„æ—¶å€™æ€§èƒ½é—®é¢˜å·²ç»ç»“æŸäº†ï¼Œè¿™æ ·åœ¨çº¿åˆ†æå°±çœ‹ä¸å‡ºå“ªé‡Œå¯¼è‡´çš„é—®é¢˜ï¼Œåªæœ‰ä»å¹³å‡è´Ÿè½½è¿™ç§ååº”å†å²çš„æŒ‡æ ‡çœ‹å‡ºä¸€äº›é—®é¢˜ã€‚<br><br>è¿™ç§æƒ…æ™¯ä¸‹ï¼Œå°±éœ€è¦ç›‘æ§ç³»ç»Ÿçš„é…åˆï¼Œè®°å½•ä¸‹å†å²çš„ç³»ç»Ÿå’Œè¿›ç¨‹çš„æ€§èƒ½æŒ‡æ ‡ã€‚å¹¶ä¸”ï¼Œè¿™ä¸ªcaseåªæœ‰load1é«˜ï¼Œæ‰€ä»¥ç›‘æ§çš„é—´éš”æ—¶é—´ä¹Ÿéœ€è¦æ¯”è¾ƒç²¾ç»†ã€‚</p>
                                <p class="reply-time">2018-11-30 17:46</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/9c/17/6ffd80f6.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æå˜‰é¹</span>
                            </div>
                            <div class="bd">æˆ‘å®‰è£…çš„ubuntu 18.04 live serverç‰ˆæœ¬ï¼Œä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤å®‰è£…çš„perfï¼š<br>apt install linux-tools-generic <br></div>
                            <span class="time">2018-12-15 12:29</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘ è°¢è°¢åˆ†äº«å®‰è£…æ–¹æ³•</p>
                                <p class="reply-time">2018-12-17 07:51</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/30/f1/bf7fd8d2.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ¨Šæµ·æ¶›</span>
                            </div>
                            <div class="bd">æ‰§è¡Œperf top -g -p  ï¼ˆphp-fpmè¿›ç¨‹å·ï¼‰ï¼Œå‘ç°ä¸äº†sqrtå‡½æ•°<br> <br></div>
                            <span class="time">2018-12-02 16:18</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">åªçœ‹åˆ°åœ°å€è€Œä¸æ˜¯å‡½æ•°åæ˜¯ç”±äºåº”ç”¨ç¨‹åºè¿è¡Œåœ¨å®¹å™¨ä¸­ï¼Œå®ƒçš„ä¾èµ–ä¹Ÿéƒ½åœ¨å®¹å™¨å†…éƒ¨ï¼Œæ•…è€Œperfæ— æ³•æ‰¾åˆ°PHPç¬¦å·è¡¨ã€‚ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨perf recordç”Ÿæˆperf.dataæ‹·è´åˆ°å®¹å™¨å†…éƒ¨ perf reportã€‚</p>
                                <p class="reply-time">2018-12-03 08:33</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/30/f1/bf7fd8d2.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ¨Šæµ·æ¶›</span>
                            </div>
                            <div class="bd">[Day6æ‰“å¡]<br>æ–‡ç« å‰é¢ï¼ˆæŸ¥è¯¢ man proc å°±å¯ä»¥ï¼‰ï¼Œæœ¨æœ‰è¿™ä¹ˆä¸ªå‘½ä»¤å§ï¼Ÿ<br> <br></div>
                            <span class="time">2018-12-02 12:55</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">manæ˜¯Linuxæœ€åŸºæœ¬çš„å‘½ä»¤</p>
                                <p class="reply-time">2018-12-03 08:36</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/0c/ca/6173350b.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">éƒ­æ±Ÿä¼Ÿ</span>
                            </div>
                            <div class="bd">ç”¨sysbenchæµ‹è¯•cpuæ€§èƒ½ï¼Œç„¶ååˆ©ç”¨perf æ‰¾åˆ°å…·ä½“å“ªä¸ªè¿›ç¨‹çš„å“ªä¸ªå‡½æ•°åœ¨æ¶ˆè€—CPU<br>gjw@gjw:&#47;etc&#47;apt$ sysbench --threads=1 --time=600 cpu run<br>sysbench 1.1.0 (using bundled LuaJIT 2.1.0-beta3)<br>Running the test with following options:<br>Number of threads: 1<br>Initializing random number generator from current time<br>Prime numbers limit: 10000<br>Initializing worker threads...<br>Threads started!<br>æŸ¥çœ‹sysbenchè¿›ç¨‹<br>ps -egjw@gjw:~$ ps -ef | grep sysbench<br>gjw      31921  1294 77 11:20 pts&#47;0    00:04:39 sysbench --threads=1 --time=600 cpu run<br>perf topè·å–è¿›ç¨‹ä¿¡æ¯ï¼š<br>sudo perf top -g -p 31921<br>Samples: 824  of event &#39;cycles:ppp&#39;, Event count (approx.): 618842235                                                                                                         <br>  Children      Self  Shared Object  Symbol                                                                                                                                   <br>+  100.00%   100.00%  sysbench       [.] cpu_execute_event<br>ç„¶ååœ¨sysbenchæºç ä¸­æŸ¥çœ‹cpu_execute_event å‡½æ•°ï¼š<br>gjw@gjw:~&#47;soft&#47;sysbench-master$ grep -r cpu_execute_event<br>Binary file src&#47;tests&#47;cpu&#47;libsbcpu.a matches<br>Binary file src&#47;tests&#47;cpu&#47;libsbcpu_a-sb_cpu.o matches<br>src&#47;tests&#47;cpu&#47;sb_cpu.c:static int cpu_execute_event(sb_event_t *, int);<br>src&#47;tests&#47;cpu&#47;sb_cpu.c:    .execute_event = cpu_execute_event,<br>src&#47;tests&#47;cpu&#47;sb_cpu.c:int cpu_execute_event(sb_event_t *r, int thread_id)<br>Binary file src&#47;sysbench matches<br>gjw@gjw:~&#47;soft&#47;sysbench-master$ vi src&#47;tests&#47;cpu&#47;sb_cpu.c <br> int cpu_execute_event(sb_event_t *r, int thread_id)<br>{<br>  unsigned long long c;<br>  unsigned long long l;<br>  double t;<br>  unsigned long long n=0;<br>  (void)thread_id; &#47;* unused *&#47;<br>  (void)r; &#47;* unused *&#47;<br>  &#47;* So far we&#39;re using very simple test prime number tests in 64bit *&#47;<br>  for(c=3; c &lt; max_prime; c++)<br>  {<br>    t = sqrt((double)c);<br>    for(l = 2; l &lt;= t; l++)<br>      if (c % l == 0)<br>        break;<br>    if (l &gt; t )<br>      n++;<br>  }<br>  return 0;<br>å¯ä»¥çœ‹åˆ°è¯¥å‡½æ•°åœ¨è®¡ç®—ç´ æ•°ï¼Œç”±æ­¤å®Œæˆäº†ä¸€ä¸ªcpuä½¿ç”¨ç‡å¾ˆé«˜çš„æ¡ˆä¾‹åˆ†æ <br></div>
                            <span class="time">2018-12-02 11:34</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¾ˆè¯¦ç»†çš„åˆ†ææ­¥éª¤ï¼Œæ„Ÿè°¢åˆ†äº«ğŸ‘</p>
                                <p class="reply-time">2018-12-03 08:39</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">dexter</span>
                            </div>
                            <div class="bd">æ¯å¤©ä¸Šç­åœ°é“å¬ä¸€éï¼Œä¸‹ç­åœ°é“å¬ä¸€éï¼Œæ™šä¸Šåšå®éªŒ <br></div>
                            <span class="time">2018-12-01 14:08</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘</p>
                                <p class="reply-time">2018-12-03 18:22</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLkhgYnYZBdhdwKnXQibey04cy9N9ria3DadH7iagoKukaWK1FJwjfCoh0He4p7b2icSYVzHH71l8ZXiaQ/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">çŒªå“¥å“¥</span>
                            </div>
                            <div class="bd">è€å¸ˆä½ å¥½ æˆ‘å†™äº†ä¸€ä¸ªpythonæ­»å¾ªç¯ ä»£ç å¦‚ä¸‹ <br>def wangfang():<br>  while True:<br>    i =1<br>wangfang()<br>ä½¿ç”¨perf topå‘½ä»¤ æ— æ³•æŠ“å–åˆ°è¯¥å¾ªç¯çš„å‡½æ•°, è€å¸ˆèƒ½è§£é‡Šä¸€ä¸‹å— <br></div>
                            <span class="time">2019-01-07 17:05</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/15/a4/3744053e.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Ivan</span>
                            </div>
                            <div class="bd">è¯·é—®iowait timeç®—åœ¨idle timeé‡Œé¢å—ï¼Ÿcpuçš„åˆ©ç”¨ç‡è®¡ç®—å…¬å¼ä¸­ç©ºé—²æ—¶é—´æŒ‡çš„æ˜¯idle timeï¼Œè¿˜æ˜¯idle+iowait timeã€‚ <br></div>
                            <span class="time">2018-12-03 15:49</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">iowaitä¸ç®—åœ¨idleé‡Œé¢</p>
                                <p class="reply-time">2018-12-03 17:38</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ernR4NKI5tejJAV3HMTF3gszBBUAjkjLO2QYic2gx5dMGelFv4LWibib7CUGexmMcMp5HiaaibmOH3dyHg/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ¸¡æ¸¡é¸Ÿ_linux</span>
                            </div>
                            <div class="bd">ä½¿ç”¨perf åªèƒ½åˆ†æåˆ°16è¿›åˆ¶çš„åœ°å€ï¼Œæ— æ³•æ˜¾ç¤ºå‡½æ•°åç§° <br></div>
                            <span class="time">2018-12-02 16:37</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">åªçœ‹åˆ°åœ°å€è€Œä¸æ˜¯å‡½æ•°åæ˜¯ç”±äºåº”ç”¨ç¨‹åºè¿è¡Œåœ¨å®¹å™¨ä¸­ï¼Œå®ƒçš„ä¾èµ–ä¹Ÿéƒ½åœ¨å®¹å™¨å†…éƒ¨ï¼Œæ•…è€Œperfæ— æ³•æ‰¾åˆ°PHPç¬¦å·è¡¨ã€‚</p>
                                <p class="reply-time">2018-12-03 08:28</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/b1/4d/10c75b34.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Johnson</span>
                            </div>
                            <div class="bd">ç¢°åˆ°ä¸€ä¸ªcpuåˆ©ç”¨ç‡å¾ˆä½ä½†æ˜¯loadéå¸¸é«˜çš„é—®é¢˜ï¼Œåˆ†ææ˜¯DçŠ¶æ€çš„è¿›ç¨‹å¾ˆå¤šï¼Œå¤§å¤šæ˜¯pså‘½ä»¤ï¼Œæœ‰æ²¡æœ‰æ€æ‰è¿™äº›å‘½ä»¤çš„åŠæ³•ï¼Ÿä¸èƒ½é‡å¯çš„ <br></div>
                            <span class="time">2018-11-30 19:02</span>
                            
                        </div>
                    </li>
                    


                </ul>
            </div>
        </div>
    </div>
</div>
</body>
</html>