<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <style type="text/css">

#watermark {

  position: relative;
  overflow: hidden;
}

#watermark .x {
  position: absolute;
  top: 800;
  left: 400;
  color: #3300ff;
  font-size: 50px;
  pointer-events: none;
  opacity:0.3;
  filter:Alpha(opacity=50);
  -webkit-transform: rotate(45deg);
  -moz-transform: rotate(45deg);
}
    </style>


    <style type="text/css">
 html{color:#333;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-rendering:optimizelegibility;font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif}html.borderbox *,html.borderbox :after,html.borderbox :before{box-sizing:border-box}article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul{margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}audio,canvas,video{display:inline-block}body,button,input,select,textarea{font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}blockquote{position:relative;color:#999;font-weight:400;border-left:1px solid #1abc9c;padding-left:1em;margin:1em 3em 1em 2em}@media only screen and (max-width:640px){blockquote{margin:1em 0}}abbr,acronym{border-bottom:1px dotted;font-variant:normal}abbr{cursor:help}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:400}ol,ul{list-style:none}caption,th{text-align:left}q:after,q:before{content:""}sub,sup{font-size:75%;line-height:0;position:relative}:root sub,:root sup{vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a{color:#1abc9c}a:hover{text-decoration:underline}.typo a{border-bottom:1px solid #1abc9c}.typo a:hover{border-bottom-color:#555;color:#555}.typo a:hover,a,ins{text-decoration:none}.typo-u,u{text-decoration:underline}mark{background:#fffdd1;border-bottom:1px solid #ffedce;padding:2px;margin:0 5px}code,pre,pre tt{font-family:Courier,Courier New,monospace}pre{background:hsla(0,0%,97%,.7);border:1px solid #ddd;padding:1em 1.5em;display:block;-webkit-overflow-scrolling:touch}hr{border:none;border-bottom:1px solid #cfcfcf;margin-bottom:.8em;height:10px}.typo-small,figcaption,small{font-size:.9em;color:#888}b,strong{font-weight:700;color:#000}[draggable]{cursor:move}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.textwrap,.textwrap td,.textwrap th{word-wrap:break-word;word-break:break-all}.textwrap-table{table-layout:fixed}.serif{font-family:Palatino,Optima,Georgia,serif}.typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote{margin-bottom:1rem}h1,h2,h3,h4,h5,h6{font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;line-height:1.35}.typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}.typo-h1,.typo h1{font-size:2em}.typo-h2,.typo h2{font-size:1.8em}.typo-h3,.typo h3{font-size:1.6em}.typo-h4,.typo h4{font-size:1.4em}.typo-h5,.typo-h6,.typo h5,.typo h6{font-size:1.2em}.typo-ul,.typo ul{margin-left:1.3em;list-style:disc}.typo-ol,.typo ol{list-style:decimal;margin-left:1.9em}.typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul{margin-bottom:.8em;margin-left:2em}.typo-ol ul,.typo-ul ul,.typo li ul{list-style:circle}.typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th{border:1px solid #ddd;padding:.5em 1em;color:#666}.typo-table th,.typo table th{background:#fbfbfb}.typo-table thead th,.typo table thead th{background:hsla(0,0%,95%,.7)}.typo table caption{border-bottom:none}.typo-input,.typo-textarea{-webkit-appearance:none;border-radius:0}.typo-em,.typo em,caption,legend{color:#000;font-weight:inherit}.typo-em{position:relative}.typo-em:after{position:absolute;top:.65em;left:0;width:100%;overflow:hidden;white-space:nowrap;content:"\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"}.typo img{max-width:100%}.common-content{font-weight:400;color:#353535;line-height:1.75rem;white-space:normal;word-break:normal;font-size:1rem}.common-content img{display:block;max-width:100%;background-color:#eee}.common-content audio,.common-content video{width:100%;background-color:#eee}.common-content center,.common-content font{margin-top:1rem;display:inline-block}.common-content center{width:100%}.common-content pre{margin-top:1rem;padding-left:0;padding-right:0;position:relative;overflow:hidden}.common-content pre code{font-size:.8rem;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;width:100%;box-sizing:border-box;padding-left:1rem;padding-right:1rem;overflow-x:auto}.common-content hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}.common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong{font-weight:700}.common-content h1,.common-content h2{font-size:1.125rem;margin-bottom:.45rem}.common-content h3,.common-content h4,.common-content h5{font-size:1rem;margin-bottom:.45rem}.common-content p{font-weight:400;color:#353535;margin-top:.15rem}.common-content .orange{color:#ff5a05}.common-content .reference{font-size:1rem;color:#888}.custom-rich-content h1{margin-top:0;font-weight:400;font-size:15.25px;border-bottom:1px solid #eee;line-height:2.8}.custom-rich-content li,.custom-rich-content p{font-size:14px;color:#888;line-height:1.6}table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr{box-sizing:border-box}table.hljs-ln td{padding:0;border:0}table.hljs-ln td.hljs-ln-numbers{min-width:15px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;user-select:none}table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;line-height:20px;vertical-align:top}table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;color:#24292e;word-wrap:normal;white-space:pre}video::-webkit-media-controls{overflow:hidden!important}video::-webkit-media-controls-enclosure{width:calc(100% + 32px);margin-left:auto}.button-cancel{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel,.button-primary{-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary{color:#fff;background-color:#ff5a05;border-radius:3px}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot);src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.woff) format("woff"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.ttf) format("truetype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.svg#iconfont) format("svg")}@font-face{font-family:player-font;src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot);src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.woff) format("woff"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.ttf) format("truetype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.svg#player-font) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}html{background:#fff;min-height:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{width:100%}body.fixed{overflow:hidden;position:fixed;width:100vw;height:100vh}i{font-style:normal}a{word-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0)}a:hover{text-decoration:none}.fade-enter-active,.fade-leave-active{transition:opacity .3s}.fade-enter,.fade-leave-to{opacity:0}.MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG{outline:0}.ios-app-switch .js-audit{display:none}._loading_wrap_{position:fixed;width:100vw;height:100vh;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999}._loading_div_class_,._loading_wrap_{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}._loading_div_class_{word-wrap:break-word;padding:.5rem .75rem;text-align:center;z-index:9999;font-size:.6rem;max-width:60%;color:#fff;border-radius:.25rem;-ms-flex-direction:column;flex-direction:column}._loading_div_class_ .message{color:#353535;font-size:16px;line-height:3}.spinner{animation:circle-rotator 1.4s linear infinite}.spinner *{line-height:0;box-sizing:border-box}@keyframes circle-rotator{0%{transform:rotate(0deg)}to{transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;transform-origin:center;animation:circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite}@keyframes circle-colors{0%{stroke:#ff5a05}to{stroke:#ff5a05}}@keyframes circle-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;transform:rotate(135deg)}to{stroke-dashoffset:187;transform:rotate(450deg)}}.confirm-box-wrapper,.confirm-box-wrapper .mask{position:absolute;top:0;left:0;right:0;bottom:0}.confirm-box-wrapper .mask{background:rgba(0,0,0,.6)}.confirm-box-wrapper .confirm-box{position:fixed;top:50%;left:50%;width:267px;background:#fff;transform:translate(-50%,-50%);border-radius:7px}.confirm-box-wrapper .confirm-box .head{margin:0 18px;font-size:18px;text-align:center;line-height:65px;border-bottom:1px solid #d9d9d9}.confirm-box-wrapper .confirm-box .body{padding:18px;padding-bottom:0;color:#353535;font-size:12.5px;max-height:150px;overflow:auto}.confirm-box-wrapper .confirm-box .foot{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:18px}.confirm-box-wrapper .confirm-box .foot .button-cancel{border:1px solid #d9d9d9}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}




    </style>
    <style type="text/css">
        .button-cancel[data-v-87ffcada]{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel[data-v-87ffcada],.button-primary[data-v-87ffcada]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary[data-v-87ffcada]{color:#fff;background-color:#ff5a05;border-radius:3px}.pd[data-v-87ffcada]{padding-left:1.375rem;padding-right:1.375rem}.article[data-v-87ffcada]{max-width:70rem;margin:0 auto}.article .article-unavailable[data-v-87ffcada]{color:#fa8919;font-size:15px;font-weight:600;line-height:24px;border-radius:5px;padding:12px;background-color:#f6f7fb;margin-top:20px}.article .article-unavailable .iconfont[data-v-87ffcada]{font-size:12px}.article .main[data-v-87ffcada]{padding:1.25rem 0;margin-bottom:52px}.article-title[data-v-87ffcada]{color:#353535;font-weight:400;line-height:1.65rem;font-size:1.34375rem}.article-info[data-v-87ffcada]{color:#888;font-size:.9375rem;margin-top:1.0625rem}.article-content[data-v-87ffcada]{margin-top:1.0625rem}.article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button{display:none}.copyright[data-v-87ffcada]{color:#b2b2b2;padding-bottom:20px;margin-top:20px;font-size:13px}.audio-player[data-v-87ffcada]{width:100%;margin:20px 0}.to-comment[data-v-87ffcada]{overflow:hidden;padding-top:10px;margin-bottom:-30px}.to-comment a.button-primary[data-v-87ffcada]{float:right;height:20px;font-size:12px;line-height:20px;padding:4px 8px;cursor:pointer}.article-comments[data-v-87ffcada]{margin-top:2rem}.article-comments h2[data-v-87ffcada]{text-align:center;color:#888;position:relative;z-index:1;margin-bottom:1rem}.article-comments h2[data-v-87ffcada]:before{border-top:1px dotted #888;content:"";position:absolute;top:56%;left:0;width:100%;z-index:-1}.article-comments h2 span[data-v-87ffcada]{font-size:15.25px;font-weight:400;padding:0 1rem;background:#fff;display:inline-block}.article-sub-bottom[data-v-87ffcada]{z-index:10;cursor:pointer}.switch-btns[data-v-87ffcada]{height:76px;cursor:pointer;padding-top:24px;padding-bottom:24px;border-bottom:10px solid #f6f7fb;position:relative}.switch-btns[data-v-87ffcada]:before{content:" ";height:1px;background:#e8e8e8;position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;left:1.375rem;right:1.375rem}.switch-btns .btn[data-v-87ffcada]{height:38px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.switch-btns .btn .tag[data-v-87ffcada]{-webkit-box-flex:0;-ms-flex:0 0 62px;flex:0 0 62px;text-align:center;color:#888;font-size:14px;border-radius:10px;height:22px;line-height:22px;background:#f6f7fb;font-weight:400}.switch-btns .btn .txt[data-v-87ffcada]{margin-left:10px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:#888;font-size:15px;height:22px;line-height:22px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:400}@media (max-width:769px){.article .breadcrumb[data-v-87ffcada]{padding-top:10px;padding-bottom:10px}}





    </style>

    <style type="text/css">
        .comment-item{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:1rem}.comment-item a{border-bottom:none}.comment-item .avatar{width:2.625rem;height:2.625rem;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}.comment-item .info{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.comment-item .info .hd{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .username{color:#888;font-size:15.25px;font-weight:400;line-height:1.2}.comment-item .info .hd .control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .control .btn-share{color:#888;font-size:.75rem;margin-right:1rem}.comment-item .info .hd .control .btn-praise{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:15.25px;text-decoration:none}.comment-item .info .hd .control .btn-praise i{color:#888;display:inline-block;font-size:.75rem;margin-right:.3rem;margin-top:-.01rem}.comment-item .info .hd .control .btn-praise i.on,.comment-item .info .hd .control .btn-praise span{color:#ff5a05}.comment-item .info .bd{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6}.comment-item .info .time{color:#888;font-size:9px;line-height:1}.comment-item .info .reply .reply-hd{font-size:15.25px}.comment-item .info .reply .reply-hd span{margin-left:-12px;color:#888;font-weight:400}.comment-item .info .reply .reply-hd i{color:#ff5a05;font-size:15.25px}.comment-item .info .reply .reply-content{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all}.comment-item .info .reply .reply-time{color:#888;font-size:9px}




    </style>
</head>
<body>
<div id="app">


    <div data-v-87ffcada="" class="article" id="watermark">
        <p class="x">æ›´å¤šè¯¾ç¨‹è¯·åŠ QQç¾¤170701297</p>
        <div data-v-87ffcada="" class="main main-app">
            <h1 data-v-87ffcada="" class="article-title pd">
                17è®²æ¡ˆä¾‹ç¯‡ï¼šå¦‚ä½•åˆ©ç”¨ç³»ç»Ÿç¼“å­˜ä¼˜åŒ–ç¨‹åºçš„è¿è¡Œæ•ˆç‡
            </h1>
            <div data-v-87ffcada="" class="article-content typo common-content pd"><img data-v-87ffcada=""
                                                                                        src="https://static001.geekbang.org/resource/image/c0/77/c019a34b850af69ca9aae5a44f01cb77.jpg">


                <div data-v-87ffcada="" id="article-content" class="">
                    <div class="text">
                        <p>ä½ å¥½ï¼Œæˆ‘æ˜¯å€ªæœ‹é£ã€‚</p><p>ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å†…å­˜æ€§èƒ½ä¸­ Buffer å’Œ Cache çš„æ¦‚å¿µã€‚ç®€å•å¤ä¹ ä¸€ä¸‹ï¼ŒBuffer å’Œ Cache çš„è®¾è®¡ç›®çš„ï¼Œæ˜¯ä¸ºäº†æå‡ç³»ç»Ÿçš„ I/O æ€§èƒ½ã€‚å®ƒä»¬åˆ©ç”¨å†…å­˜ï¼Œå……å½“èµ·æ…¢é€Ÿç£ç›˜ä¸å¿«é€Ÿ CPU ä¹‹é—´çš„æ¡¥æ¢ï¼Œå¯ä»¥åŠ é€Ÿ I/O çš„è®¿é—®é€Ÿåº¦ã€‚</p><p>Bufferå’ŒCacheåˆ†åˆ«ç¼“å­˜çš„æ˜¯å¯¹ç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿçš„è¯»å†™æ•°æ®ã€‚</p><ul>
<li>
<p>ä»å†™çš„è§’åº¦æ¥è¯´ï¼Œä¸ä»…å¯ä»¥ä¼˜åŒ–ç£ç›˜å’Œæ–‡ä»¶çš„å†™å…¥ï¼Œå¯¹åº”ç”¨ç¨‹åºä¹Ÿæœ‰å¥½å¤„ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åœ¨æ•°æ®çœŸæ­£è½ç›˜å‰ï¼Œå°±è¿”å›å»åšå…¶ä»–å·¥ä½œã€‚</p>
</li>
<li>
<p>ä»è¯»çš„è§’åº¦æ¥è¯´ï¼Œä¸ä»…å¯ä»¥æé«˜é‚£äº›é¢‘ç¹è®¿é—®æ•°æ®çš„è¯»å–é€Ÿåº¦ï¼Œä¹Ÿé™ä½äº†é¢‘ç¹ I/O å¯¹ç£ç›˜çš„å‹åŠ›ã€‚</p>
</li>
</ul><p>æ—¢ç„¶ Buffer å’Œ Cache å¯¹ç³»ç»Ÿæ€§èƒ½æœ‰å¾ˆå¤§å½±å“ï¼Œé‚£æˆ‘ä»¬åœ¨è½¯ä»¶å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œèƒ½ä¸èƒ½åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæ¥ä¼˜åŒ– I/O æ€§èƒ½ï¼Œæå‡åº”ç”¨ç¨‹åºçš„è¿è¡Œæ•ˆç‡å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆè‡ªç„¶æ˜¯è‚¯å®šçš„ã€‚ä»Šå¤©ï¼Œæˆ‘å°±ç”¨å‡ ä¸ªæ¡ˆä¾‹å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ç¼“å­˜çš„ä½œç”¨ï¼Œå¹¶å­¦ä¹ å¦‚ä½•å……åˆ†åˆ©ç”¨è¿™äº›ç¼“å­˜æ¥æé«˜ç¨‹åºæ•ˆç‡ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼ŒBufferå’ŒCacheæˆ‘ä»ç„¶ç”¨è‹±æ–‡è¡¨ç¤ºï¼Œé¿å…è·Ÿâ€œç¼“å­˜â€ä¸€è¯æ··æ·†ã€‚è€Œæ–‡ä¸­çš„â€œç¼“å­˜â€ï¼Œé€šæŒ‡æ•°æ®åœ¨å†…å­˜ä¸­çš„ä¸´æ—¶å­˜å‚¨ã€‚</p><h2>ç¼“å­˜å‘½ä¸­ç‡</h2><p>åœ¨æ¡ˆä¾‹å¼€å§‹å‰ï¼Œä½ åº”è¯¥ä¹ æƒ¯æ€§åœ°å…ˆé—®è‡ªå·±ä¸€ä¸ªé—®é¢˜ï¼Œä½ æƒ³è¦åšæˆæŸä»¶äº‹æƒ…ï¼Œç»“æœåº”è¯¥æ€ä¹ˆè¯„ä¼°ï¼Ÿæ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æƒ³åˆ©ç”¨ç¼“å­˜æ¥æå‡ç¨‹åºçš„è¿è¡Œæ•ˆç‡ï¼Œåº”è¯¥æ€ä¹ˆè¯„ä¼°è¿™ä¸ªæ•ˆæœå‘¢ï¼Ÿæ¢å¥è¯è¯´ï¼Œæœ‰æ²¡æœ‰å“ªä¸ªæŒ‡æ ‡å¯ä»¥è¡¡é‡ç¼“å­˜ä½¿ç”¨çš„å¥½åå‘¢ï¼Ÿ</p><!-- [[[read_end]]] --><p>æˆ‘ä¼°è®¡ä½ å·²ç»æƒ³åˆ°äº†ï¼Œ<strong>ç¼“å­˜çš„å‘½ä¸­ç‡</strong>ã€‚æ‰€è°“ç¼“å­˜å‘½ä¸­ç‡ï¼Œæ˜¯æŒ‡ç›´æ¥é€šè¿‡ç¼“å­˜è·å–æ•°æ®çš„è¯·æ±‚æ¬¡æ•°ï¼Œå æ‰€æœ‰æ•°æ®è¯·æ±‚æ¬¡æ•°çš„ç™¾åˆ†æ¯”ã€‚</p><p><strong>å‘½ä¸­ç‡è¶Šé«˜ï¼Œè¡¨ç¤ºä½¿ç”¨ç¼“å­˜å¸¦æ¥çš„æ”¶ç›Šè¶Šé«˜ï¼Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½ä¹Ÿå°±è¶Šå¥½ã€‚</strong></p><p>å®é™…ä¸Šï¼Œç¼“å­˜æ˜¯ç°åœ¨æ‰€æœ‰é«˜å¹¶å‘ç³»ç»Ÿå¿…éœ€çš„æ ¸å¿ƒæ¨¡å—ï¼Œä¸»è¦ä½œç”¨å°±æ˜¯æŠŠç»å¸¸è®¿é—®çš„æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯çƒ­ç‚¹æ•°æ®ï¼‰ï¼Œæå‰è¯»å…¥åˆ°å†…å­˜ä¸­ã€‚è¿™æ ·ï¼Œä¸‹æ¬¡è®¿é—®æ—¶å°±å¯ä»¥ç›´æ¥ä»å†…å­˜è¯»å–æ•°æ®ï¼Œè€Œä¸éœ€è¦ç»è¿‡ç¡¬ç›˜ï¼Œä»è€ŒåŠ å¿«åº”ç”¨ç¨‹åºçš„å“åº”é€Ÿåº¦ã€‚</p><p>è¿™äº›ç‹¬ç«‹çš„ç¼“å­˜æ¨¡å—é€šå¸¸ä¼šæä¾›æŸ¥è¯¢æ¥å£ï¼Œæ–¹ä¾¿æˆ‘ä»¬éšæ—¶æŸ¥çœ‹ç¼“å­˜çš„å‘½ä¸­æƒ…å†µã€‚ä¸è¿‡ Linux ç³»ç»Ÿä¸­å¹¶æ²¡æœ‰ç›´æ¥æä¾›è¿™äº›æ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘è¦ä»‹ç»ä¸€ä¸‹ï¼Œcachestat å’Œ cachetop  ï¼Œå®ƒä»¬æ­£æ˜¯æŸ¥çœ‹ç³»ç»Ÿç¼“å­˜å‘½ä¸­æƒ…å†µçš„å·¥å…·ã€‚</p><ul>
<li>
<p>cachestat æä¾›äº†æ•´ä¸ªæ“ä½œç³»ç»Ÿç¼“å­˜çš„è¯»å†™å‘½ä¸­æƒ…å†µã€‚</p>
</li>
<li>
<p>cachetop æä¾›äº†æ¯ä¸ªè¿›ç¨‹çš„ç¼“å­˜å‘½ä¸­æƒ…å†µã€‚</p>
</li>
</ul><p>è¿™ä¸¤ä¸ªå·¥å…·éƒ½æ˜¯ <a href="https://github.com/iovisor/bcc">bcc</a> è½¯ä»¶åŒ…çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä»¬åŸºäº Linux å†…æ ¸çš„ eBPFï¼ˆextended Berkeley Packet Filtersï¼‰æœºåˆ¶ï¼Œæ¥è·Ÿè¸ªå†…æ ¸ä¸­ç®¡ç†çš„ç¼“å­˜ï¼Œå¹¶è¾“å‡ºç¼“å­˜çš„ä½¿ç”¨å’Œå‘½ä¸­æƒ…å†µã€‚</p><p>è¿™é‡Œæ³¨æ„ï¼ŒeBPF çš„å·¥ä½œåŸç†ä¸æ˜¯æˆ‘ä»¬ä»Šå¤©çš„é‡ç‚¹ï¼Œè®°ä½è¿™ä¸ªåå­—å³å¯ï¼Œåé¢æ–‡ç« ä¸­æˆ‘ä»¬ä¼šè¯¦ç»†å­¦ä¹ ã€‚ä»Šå¤©è¦æŒæ¡çš„é‡ç‚¹ï¼Œæ˜¯è¿™ä¸¤ä¸ªå·¥å…·çš„ä½¿ç”¨æ–¹æ³•ã€‚</p><p>ä½¿ç”¨ cachestat å’Œ cachetop å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å®‰è£… bcc è½¯ä»¶åŒ…ã€‚æ¯”å¦‚ï¼Œåœ¨ Ubuntu ç³»ç»Ÿä¸­ï¼Œä½ å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£…ï¼š</p><pre><code>sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 4052245BD4284CDD
echo &quot;deb https://repo.iovisor.org/apt/xenial xenial main&quot; | sudo tee /etc/apt/sources.list.d/iovisor.list
sudo apt-get update
sudo apt-get install -y bcc-tools libbcc-examples linux-headers-$(uname -r)
</code></pre><blockquote>
<p>æ³¨æ„ï¼šbcc-toolséœ€è¦å†…æ ¸ç‰ˆæœ¬ä¸º4.1æˆ–è€…æ›´æ–°çš„ç‰ˆæœ¬ï¼Œå¦‚æœä½ ç”¨çš„æ˜¯CentOSï¼Œé‚£å°±éœ€è¦æ‰‹åŠ¨<a href="https://github.com/iovisor/bcc/issues/462">å‡çº§å†…æ ¸ç‰ˆæœ¬åå†å®‰è£…</a>ã€‚</p>
</blockquote><p>æ“ä½œå®Œè¿™äº›æ­¥éª¤ï¼Œbcc æä¾›çš„æ‰€æœ‰å·¥å…·å°±éƒ½å®‰è£…åˆ° /usr/share/bcc/tools è¿™ä¸ªç›®å½•ä¸­äº†ã€‚ä¸è¿‡è¿™é‡Œæé†’ä½ ï¼Œbcc è½¯ä»¶åŒ…é»˜è®¤ä¸ä¼šæŠŠè¿™äº›å·¥å…·é…ç½®åˆ°ç³»ç»Ÿçš„ PATH è·¯å¾„ä¸­ï¼Œæ‰€ä»¥ä½ å¾—è‡ªå·±æ‰‹åŠ¨é…ç½®ï¼š</p><pre><code>$ export PATH=$PATH:/usr/share/bcc/tools
</code></pre><p>é…ç½®å®Œï¼Œä½ å°±å¯ä»¥è¿è¡Œ cachestat å’Œ cachetop å‘½ä»¤äº†ã€‚æ¯”å¦‚ï¼Œä¸‹é¢å°±æ˜¯ä¸€ä¸ª cachestat çš„è¿è¡Œç•Œé¢ï¼Œå®ƒä»¥1ç§’çš„æ—¶é—´é—´éš”ï¼Œè¾“å‡ºäº†3ç»„ç¼“å­˜ç»Ÿè®¡æ•°æ®ï¼š</p><pre><code>$ cachestat 1 3
   TOTAL   MISSES     HITS  DIRTIES   BUFFERS_MB  CACHED_MB
       2        0        2        1           17        279
       2        0        2        1           17        279
       2        0        2        1           17        279 
</code></pre><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œcachestat çš„è¾“å‡ºå…¶å®æ˜¯ä¸€ä¸ªè¡¨æ ¼ã€‚æ¯è¡Œä»£è¡¨ä¸€ç»„æ•°æ®ï¼Œè€Œæ¯ä¸€åˆ—ä»£è¡¨ä¸åŒçš„ç¼“å­˜ç»Ÿè®¡æŒ‡æ ‡ã€‚è¿™äº›æŒ‡æ ‡ä»å·¦åˆ°å³ä¾æ¬¡è¡¨ç¤ºï¼š</p><ul>
<li>
<p>TOTAL ï¼Œè¡¨ç¤ºæ€»çš„ I/O æ¬¡æ•°ï¼›</p>
</li>
<li>
<p>MISSES ï¼Œè¡¨ç¤ºç¼“å­˜æœªå‘½ä¸­çš„æ¬¡æ•°ï¼›</p>
</li>
<li>
<p>HITS ï¼Œè¡¨ç¤ºç¼“å­˜å‘½ä¸­çš„æ¬¡æ•°ï¼›</p>
</li>
<li>
<p>DIRTIESï¼Œ è¡¨ç¤ºæ–°å¢åˆ°ç¼“å­˜ä¸­çš„è„é¡µæ•°ï¼›</p>
</li>
<li>
<p>BUFFERS_MB è¡¨ç¤º Buffers çš„å¤§å°ï¼Œä»¥ MB ä¸ºå•ä½ï¼›</p>
</li>
<li>
<p>CACHED_MB è¡¨ç¤º Cache çš„å¤§å°ï¼Œä»¥ MB ä¸ºå•ä½ã€‚</p>
</li>
</ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ª cachetop çš„è¿è¡Œç•Œé¢ï¼š</p><pre><code>$ cachetop
11:58:50 Buffers MB: 258 / Cached MB: 347 / Sort: HITS / Order: ascending
PID      UID      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%
   13029 root     python                  1        0        0     100.0%       0.0%
</code></pre><p>å®ƒçš„è¾“å‡ºè·Ÿ top ç±»ä¼¼ï¼Œé»˜è®¤æŒ‰ç…§ç¼“å­˜çš„å‘½ä¸­æ¬¡æ•°ï¼ˆHITSï¼‰æ’åºï¼Œå±•ç¤ºäº†æ¯ä¸ªè¿›ç¨‹çš„ç¼“å­˜å‘½ä¸­æƒ…å†µã€‚å…·ä½“åˆ°æ¯ä¸€ä¸ªæŒ‡æ ‡ï¼Œè¿™é‡Œçš„ HITSã€MISSESå’ŒDIRTIES ï¼Œè·Ÿ cachestat é‡Œçš„å«ä¹‰ä¸€æ ·ï¼Œåˆ†åˆ«ä»£è¡¨é—´éš”æ—¶é—´å†…çš„ç¼“å­˜å‘½ä¸­æ¬¡æ•°ã€æœªå‘½ä¸­æ¬¡æ•°ä»¥åŠæ–°å¢åˆ°ç¼“å­˜ä¸­çš„è„é¡µæ•°ã€‚</p><p>è€Œ READ_HIT å’Œ WRITE_HIT ï¼Œåˆ†åˆ«è¡¨ç¤ºè¯»å’Œå†™çš„ç¼“å­˜å‘½ä¸­ç‡ã€‚</p><h2>æŒ‡å®šæ–‡ä»¶çš„ç¼“å­˜å¤§å°</h2><p>é™¤äº†ç¼“å­˜çš„å‘½ä¸­ç‡å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæŒ‡æ ‡ä½ å¯èƒ½ä¹Ÿä¼šå¾ˆæ„Ÿå…´è¶£ï¼Œé‚£å°±æ˜¯æŒ‡å®šæ–‡ä»¶åœ¨å†…å­˜ä¸­çš„ç¼“å­˜å¤§å°ã€‚ä½ å¯ä»¥ä½¿ç”¨ <a href="https://github.com/tobert/pcstat">pcstat</a> è¿™ä¸ªå·¥å…·ï¼Œæ¥æŸ¥çœ‹æ–‡ä»¶åœ¨å†…å­˜ä¸­çš„ç¼“å­˜å¤§å°ä»¥åŠç¼“å­˜æ¯”ä¾‹ã€‚</p><p>pcstat æ˜¯ä¸€ä¸ªåŸºäº Go è¯­è¨€å¼€å‘çš„å·¥å…·ï¼Œæ‰€ä»¥å®‰è£…å®ƒä¹‹å‰ï¼Œä½ é¦–å…ˆåº”è¯¥å®‰è£… Go è¯­è¨€ï¼Œä½ å¯ä»¥ç‚¹å‡»<a href="https://golang.org/dl/">è¿™é‡Œ</a>ä¸‹è½½å®‰è£…ã€‚</p><p>å®‰è£…å®Œ Go è¯­è¨€ï¼Œå†è¿è¡Œä¸‹é¢çš„å‘½ä»¤å®‰è£… pcstatï¼š</p><pre><code>$ export GOPATH=~/go
$ export PATH=~/go/bin:$PATH
$ go get golang.org/x/sys/unix
$ go get github.com/tobert/pcstat/pcstat
</code></pre><p>å…¨éƒ¨å®‰è£…å®Œæˆåï¼Œä½ å°±å¯ä»¥è¿è¡Œ pcstat æ¥æŸ¥çœ‹æ–‡ä»¶çš„ç¼“å­˜æƒ…å†µäº†ã€‚æ¯”å¦‚ï¼Œä¸‹é¢å°±æ˜¯ä¸€ä¸ª pcstat è¿è¡Œçš„ç¤ºä¾‹ï¼Œå®ƒå±•ç¤ºäº† /bin/ls è¿™ä¸ªæ–‡ä»¶çš„ç¼“å­˜æƒ…å†µï¼š</p><pre><code>$ pcstat /bin/ls
+---------+----------------+------------+-----------+---------+
| Name    | Size (bytes)   | Pages      | Cached    | Percent |
|---------+----------------+------------+-----------+---------|
| /bin/ls | 133792         | 33         | 0         | 000.000 |
+---------+----------------+------------+-----------+---------+
</code></pre><p>è¿™ä¸ªè¾“å‡ºä¸­ï¼ŒCached å°±æ˜¯ /bin/ls åœ¨ç¼“å­˜ä¸­çš„å¤§å°ï¼Œè€Œ Percent åˆ™æ˜¯ç¼“å­˜çš„ç™¾åˆ†æ¯”ã€‚ä½ çœ‹åˆ°å®ƒä»¬éƒ½æ˜¯ 0ï¼Œè¿™è¯´æ˜ /bin/ls å¹¶ä¸åœ¨ç¼“å­˜ä¸­ã€‚</p><p>æ¥ç€ï¼Œå¦‚æœä½ æ‰§è¡Œä¸€ä¸‹ ls å‘½ä»¤ï¼Œå†è¿è¡Œç›¸åŒçš„å‘½ä»¤æ¥æŸ¥çœ‹çš„è¯ï¼Œå°±ä¼šå‘ç° /bin/ls éƒ½åœ¨ç¼“å­˜ä¸­äº†ï¼š</p><pre><code>$ ls
$ pcstat /bin/ls
+---------+----------------+------------+-----------+---------+
| Name    | Size (bytes)   | Pages      | Cached    | Percent |
|---------+----------------+------------+-----------+---------|
| /bin/ls | 133792         | 33         | 33        | 100.000 |
+---------+----------------+------------+-----------+---------+
</code></pre><p>çŸ¥é“äº†ç¼“å­˜ç›¸åº”çš„æŒ‡æ ‡å’ŒæŸ¥çœ‹ç³»ç»Ÿç¼“å­˜çš„æ–¹æ³•åï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±è¿›å…¥ä»Šå¤©çš„æ­£å¼æ¡ˆä¾‹ã€‚</p><p>è·Ÿå‰é¢çš„æ¡ˆä¾‹ä¸€æ ·ï¼Œä»Šå¤©çš„æ¡ˆä¾‹ä¹Ÿæ˜¯åŸºäº Ubuntu 18.04ï¼Œå½“ç„¶åŒæ ·é€‚ç”¨äºå…¶ä»–çš„ Linux ç³»ç»Ÿã€‚</p><ul>
<li>
<p>æœºå™¨é…ç½®ï¼š2 CPUï¼Œ8GB å†…å­˜ã€‚</p>
</li>
<li>
<p>é¢„å…ˆæŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤å®‰è£… bcc å’Œ pcstat è½¯ä»¶åŒ…ï¼Œå¹¶æŠŠè¿™äº›å·¥å…·çš„å®‰è£…è·¯å¾„æ·»åŠ åˆ°åˆ° PATH ç¯å¢ƒå˜é‡ä¸­ã€‚</p>
</li>
<li>
<p>é¢„å…ˆå®‰è£… Docker è½¯ä»¶åŒ…ï¼Œæ¯”å¦‚ apt-get install <a href="http://docker.io">docker.io</a></p>
</li>
</ul><h2>æ¡ˆä¾‹ä¸€</h2><p>ç¬¬ä¸€ä¸ªæ¡ˆä¾‹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ä¸Šä¸€èŠ‚æåˆ°çš„ dd å‘½ä»¤ã€‚</p><p>dd ä½œä¸ºä¸€ä¸ªç£ç›˜å’Œæ–‡ä»¶çš„æ‹·è´å·¥å…·ï¼Œç»å¸¸è¢«æ‹¿æ¥æµ‹è¯•ç£ç›˜æˆ–è€…æ–‡ä»¶ç³»ç»Ÿçš„è¯»å†™æ€§èƒ½ã€‚ä¸è¿‡ï¼Œæ—¢ç„¶ç¼“å­˜ä¼šå½±å“åˆ°æ€§èƒ½ï¼Œå¦‚æœç”¨ddå¯¹åŒä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå¤šæ¬¡è¯»å–æµ‹è¯•ï¼Œæµ‹è¯•çš„ç»“æœä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬æ¥åŠ¨æ‰‹è¯•è¯•ã€‚é¦–å…ˆï¼Œæ‰“å¼€ä¸¤ä¸ªç»ˆç«¯ï¼Œè¿æ¥åˆ° Ubuntu æœºå™¨ä¸Šï¼Œç¡®ä¿ bcc å·²ç»å®‰è£…é…ç½®æˆåŠŸã€‚</p><p>ç„¶åï¼Œä½¿ç”¨ dd å‘½ä»¤ç”Ÿæˆä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œç”¨äºåé¢çš„æ–‡ä»¶è¯»å–æµ‹è¯•ï¼š</p><pre><code># ç”Ÿæˆä¸€ä¸ª512MBçš„ä¸´æ—¶æ–‡ä»¶
$ dd if=/dev/sda1 of=file bs=1M count=512
# æ¸…ç†ç¼“å­˜
$ echo 3 &gt; /proc/sys/vm/drop_caches
</code></pre><p>ç»§ç»­åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ï¼Œè¿è¡Œ pcstat å‘½ä»¤ï¼Œç¡®è®¤åˆšåˆšç”Ÿæˆçš„æ–‡ä»¶ä¸åœ¨ç¼“å­˜ä¸­ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ ä¼šçœ‹åˆ° Cached å’Œ Percent éƒ½æ˜¯0:</p><pre><code>$ pcstat file
+-------+----------------+------------+-----------+---------+
| Name  | Size (bytes)   | Pages      | Cached    | Percent |
|-------+----------------+------------+-----------+---------|
| file  | 536870912      | 131072     | 0         | 000.000 |
+-------+----------------+------------+-----------+---------+
</code></pre><p>è¿˜æ˜¯åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­ï¼Œç°åœ¨è¿è¡Œ cachetop å‘½ä»¤ï¼š</p><pre><code># æ¯éš”5ç§’åˆ·æ–°ä¸€æ¬¡æ•°æ®
$ cachetop 5
</code></pre><p>è¿™æ¬¡æ˜¯ç¬¬äºŒä¸ªç»ˆç«¯ï¼Œè¿è¡Œ dd å‘½ä»¤æµ‹è¯•æ–‡ä»¶çš„è¯»å–é€Ÿåº¦ï¼š</p><pre><code>$ dd if=file of=/dev/null bs=1M
512+0 records in
512+0 records out
536870912 bytes (537 MB, 512 MiB) copied, 16.0509 s, 33.4 MB/s
</code></pre><p>ä» dd çš„ç»“æœå¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªæ–‡ä»¶çš„è¯»æ€§èƒ½æ˜¯ 33.4 MB/sã€‚ç”±äºåœ¨ dd å‘½ä»¤è¿è¡Œå‰æˆ‘ä»¬å·²ç»æ¸…ç†äº†ç¼“å­˜ï¼Œæ‰€ä»¥ dd å‘½ä»¤è¯»å–æ•°æ®æ—¶ï¼Œè‚¯å®šè¦é€šè¿‡æ–‡ä»¶ç³»ç»Ÿä»ç£ç›˜ä¸­è¯»å–ã€‚</p><p>ä¸è¿‡ï¼Œè¿™æ˜¯ä¸æ˜¯æ„å‘³ç€ï¼Œ dd æ‰€æœ‰çš„è¯»è¯·æ±‚éƒ½èƒ½ç›´æ¥å‘é€åˆ°ç£ç›˜å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å†å›åˆ°ç¬¬ä¸€ä¸ªç»ˆç«¯ï¼Œ æŸ¥çœ‹ cachetop ç•Œé¢çš„ç¼“å­˜å‘½ä¸­æƒ…å†µï¼š</p><pre><code>PID      UID      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%
\.\.\.
    3264 root     dd                  37077    37330        0      49.8%      50.2%
</code></pre><p>ä» cachetop çš„ç»“æœå¯ä»¥å‘ç°ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è¯»éƒ½è½åˆ°äº†ç£ç›˜ä¸Šï¼Œäº‹å®ä¸Šè¯»è¯·æ±‚çš„ç¼“å­˜å‘½ä¸­ç‡åªæœ‰ 50% ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­å°è¯•ç›¸åŒçš„æµ‹è¯•å‘½ä»¤ã€‚å…ˆåˆ‡æ¢åˆ°ç¬¬äºŒä¸ªç»ˆç«¯ï¼Œå†æ¬¡æ‰§è¡Œåˆšæ‰çš„ dd å‘½ä»¤ï¼š</p><pre><code>$ dd if=file of=/dev/null bs=1M
512+0 records in
512+0 records out
536870912 bytes (537 MB, 512 MiB) copied, 0.118415 s, 4.5 GB/s
</code></pre><p>çœ‹åˆ°è¿™æ¬¡çš„ç»“æœï¼Œæœ‰æ²¡æœ‰ç‚¹å°æƒŠè®¶ï¼Ÿç£ç›˜çš„è¯»æ€§èƒ½å±…ç„¶å˜æˆäº† 4.5 GB/sï¼Œæ¯”ç¬¬ä¸€æ¬¡çš„ç»“æœæ˜æ˜¾é«˜äº†å¤ªå¤šã€‚ä¸ºä»€ä¹ˆè¿™æ¬¡çš„ç»“æœè¿™ä¹ˆå¥½å‘¢ï¼Ÿ</p><p>ä¸å¦¨å†å›åˆ°ç¬¬ä¸€ä¸ªç»ˆç«¯ï¼Œçœ‹çœ‹ cachetop çš„æƒ…å†µï¼š</p><pre><code>10:45:22 Buffers MB: 4 / Cached MB: 719 / Sort: HITS / Order: ascending
PID      UID      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%
\.\.\.
   32642 root     dd                 131637        0        0     100.0%       0.0%
</code></pre><p>æ˜¾ç„¶ï¼Œcachetopä¹Ÿæœ‰äº†ä¸å°çš„å˜åŒ–ã€‚ä½ å¯ä»¥å‘ç°ï¼Œè¿™æ¬¡çš„è¯»çš„ç¼“å­˜å‘½ä¸­ç‡æ˜¯100.0%ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™æ¬¡çš„ dd å‘½ä»¤å…¨éƒ¨å‘½ä¸­äº†ç¼“å­˜ï¼Œæ‰€ä»¥æ‰ä¼šçœ‹åˆ°é‚£ä¹ˆé«˜çš„æ€§èƒ½ã€‚</p><p>ç„¶åï¼Œå›åˆ°ç¬¬äºŒä¸ªç»ˆç«¯ï¼Œå†æ¬¡æ‰§è¡Œ pcstat æŸ¥çœ‹æ–‡ä»¶ file çš„ç¼“å­˜æƒ…å†µï¼š</p><pre><code>$ pcstat file
+-------+----------------+------------+-----------+---------+
| Name  | Size (bytes)   | Pages      | Cached    | Percent |
|-------+----------------+------------+-----------+---------|
| file  | 536870912      | 131072     | 131072    | 100.000 |
+-------+----------------+------------+-----------+---------+
</code></pre><p>ä» pcstat çš„ç»“æœä½ å¯ä»¥å‘ç°ï¼Œæµ‹è¯•æ–‡ä»¶ file å·²ç»è¢«å…¨éƒ¨ç¼“å­˜äº†èµ·æ¥ï¼Œè¿™è·Ÿåˆšæ‰è§‚å¯Ÿåˆ°çš„ç¼“å­˜å‘½ä¸­ç‡ 100% æ˜¯ä¸€è‡´çš„ã€‚</p><p>è¿™ä¸¤æ¬¡ç»“æœè¯´æ˜ï¼Œç³»ç»Ÿç¼“å­˜å¯¹ç¬¬äºŒæ¬¡ dd æ“ä½œæœ‰æ˜æ˜¾çš„åŠ é€Ÿæ•ˆæœï¼Œå¯ä»¥å¤§å¤§æé«˜æ–‡ä»¶è¯»å–çš„æ€§èƒ½ã€‚</p><p>ä½†åŒæ—¶ä¹Ÿè¦æ³¨æ„ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ dd å½“æˆæµ‹è¯•æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½çš„å·¥å…·ï¼Œç”±äºç¼“å­˜çš„å­˜åœ¨ï¼Œå°±ä¼šå¯¼è‡´æµ‹è¯•ç»“æœä¸¥é‡å¤±çœŸã€‚</p><h2>æ¡ˆä¾‹äºŒ</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªæ–‡ä»¶è¯»å†™çš„æ¡ˆä¾‹ã€‚è¿™ä¸ªæ¡ˆä¾‹ç±»ä¼¼äºå‰é¢å­¦è¿‡çš„ä¸å¯ä¸­æ–­çŠ¶æ€è¿›ç¨‹çš„ä¾‹å­ã€‚å®ƒçš„åŸºæœ¬åŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œä¹Ÿå°±æ˜¯æ¯ç§’ä»ç£ç›˜åˆ†åŒº /dev/sda1 ä¸­è¯»å– 32MB çš„æ•°æ®ï¼Œå¹¶æ‰“å°å‡ºè¯»å–æ•°æ®èŠ±è´¹çš„æ—¶é—´ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ä½ è¿è¡Œæ¡ˆä¾‹ï¼Œæˆ‘æŠŠå®ƒæ‰“åŒ…æˆäº†ä¸€ä¸ª <a href="https://github.com/feiskyer/linux-perf-examples/tree/master/io-cached">Docker é•œåƒ</a>ã€‚ è·Ÿå‰é¢æ¡ˆä¾‹ç±»ä¼¼ï¼Œæˆ‘æä¾›äº†ä¸‹é¢ä¸¤ä¸ªé€‰é¡¹ï¼Œä½ å¯ä»¥æ ¹æ®ç³»ç»Ÿé…ç½®ï¼Œè‡ªè¡Œè°ƒæ•´ç£ç›˜åˆ†åŒºçš„è·¯å¾„ä»¥åŠ I/O çš„å¤§å°ã€‚</p><ul>
<li>
<p>-d é€‰é¡¹ï¼Œè®¾ç½®è¦è¯»å–çš„ç£ç›˜æˆ–åˆ†åŒºè·¯å¾„ï¼Œé»˜è®¤æ˜¯æŸ¥æ‰¾å‰ç¼€ä¸º /dev/sd æˆ–è€… /dev/xvd çš„ç£ç›˜ã€‚</p>
</li>
<li>
<p>-s é€‰é¡¹ï¼Œè®¾ç½®æ¯æ¬¡è¯»å–çš„æ•°æ®é‡å¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œé»˜è®¤ä¸º 33554432ï¼ˆä¹Ÿå°±æ˜¯ 32MBï¼‰ã€‚</p>
</li>
</ul><p>è¿™ä¸ªæ¡ˆä¾‹åŒæ ·éœ€è¦ä½ å¼€å¯ä¸¤ä¸ªç»ˆç«¯ã€‚åˆ†åˆ« SSH ç™»å½•åˆ°æœºå™¨ä¸Šåï¼Œå…ˆåœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œ cachetop å‘½ä»¤ï¼š</p><pre><code># æ¯éš”5ç§’åˆ·æ–°ä¸€æ¬¡æ•°æ®
$ cachetop 5 
</code></pre><p>æ¥ç€ï¼Œå†åˆ°ç¬¬äºŒä¸ªç»ˆç«¯ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿è¡Œæ¡ˆä¾‹ï¼š</p><pre><code>$ docker run --privileged --name=app -itd feisky/app:io-direct
</code></pre><p>æ¡ˆä¾‹è¿è¡Œåï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿è¡Œä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼Œæ¥ç¡®è®¤æ¡ˆä¾‹å·²ç»æ­£å¸¸å¯åŠ¨ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ åº”è¯¥å¯ä»¥çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„è¾“å‡ºï¼š</p><pre><code>$ docker logs app
Reading data from disk /dev/sdb1 with buffer size 33554432
Time used: 0.929935 s to read 33554432 bytes
Time used: 0.949625 s to read 33554432 bytes
</code></pre><p>ä»è¿™é‡Œä½ å¯ä»¥çœ‹åˆ°ï¼Œæ¯è¯»å– 32 MB çš„æ•°æ®ï¼Œå°±éœ€è¦èŠ± 0.9 ç§’ã€‚è¿™ä¸ªæ—¶é—´åˆç†å—ï¼Ÿæˆ‘æƒ³ä½ ç¬¬ä¸€ååº”å°±æ˜¯ï¼Œå¤ªæ…¢äº†å§ã€‚é‚£è¿™æ˜¯ä¸æ˜¯æ²¡ç”¨ç³»ç»Ÿç¼“å­˜å¯¼è‡´çš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å†æ¥æ£€æŸ¥ä¸€ä¸‹ã€‚å›åˆ°ç¬¬ä¸€ä¸ªç»ˆç«¯ï¼Œå…ˆçœ‹çœ‹ cachetop çš„è¾“å‡ºï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ‰¾åˆ°æ¡ˆä¾‹è¿›ç¨‹ app çš„ç¼“å­˜ä½¿ç”¨æƒ…å†µï¼š</p><pre><code>16:39:18 Buffers MB: 73 / Cached MB: 281 / Sort: HITS / Order: ascending
PID      UID      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%
   21881 root     app                  1024        0        0     100.0%       0.0% 
</code></pre><p>è¿™ä¸ªè¾“å‡ºä¼¼ä¹æœ‰ç‚¹æ„æ€äº†ã€‚1024 æ¬¡ç¼“å­˜å…¨éƒ¨å‘½ä¸­ï¼Œè¯»çš„å‘½ä¸­ç‡æ˜¯ 100%ï¼Œçœ‹èµ·æ¥å…¨éƒ¨çš„è¯»è¯·æ±‚éƒ½ç»è¿‡äº†ç³»ç»Ÿç¼“å­˜ã€‚ä½†æ˜¯é—®é¢˜åˆæ¥äº†ï¼Œå¦‚æœçœŸçš„éƒ½æ˜¯ç¼“å­˜ I/Oï¼Œè¯»å–é€Ÿåº¦ä¸åº”è¯¥è¿™ä¹ˆæ…¢ã€‚</p><p>ä¸è¿‡ï¼Œè¯è¯´å›æ¥ï¼Œæˆ‘ä»¬ä¼¼ä¹å¿½ç•¥äº†å¦ä¸€ä¸ªé‡è¦å› ç´ ï¼Œæ¯ç§’å®é™…è¯»å–çš„æ•°æ®å¤§å°ã€‚HITS ä»£è¡¨ç¼“å­˜çš„å‘½ä¸­æ¬¡æ•°ï¼Œé‚£ä¹ˆæ¯æ¬¡å‘½ä¸­èƒ½è¯»å–å¤šå°‘æ•°æ®å‘¢ï¼Ÿè‡ªç„¶æ˜¯ä¸€é¡µã€‚</p><p>å‰é¢è®²è¿‡ï¼Œå†…å­˜ä»¥é¡µä¸ºå•ä½è¿›è¡Œç®¡ç†ï¼Œè€Œæ¯ä¸ªé¡µçš„å¤§å°æ˜¯ 4KBã€‚æ‰€ä»¥ï¼Œåœ¨5ç§’çš„æ—¶é—´é—´éš”é‡Œï¼Œå‘½ä¸­çš„ç¼“å­˜ä¸º 1024*4K/1024 = 4MBï¼Œå†é™¤ä»¥5 ç§’ï¼Œå¯ä»¥å¾—åˆ°æ¯ç§’è¯»çš„ç¼“å­˜æ˜¯ 0.8MBï¼Œæ˜¾ç„¶è·Ÿæ¡ˆä¾‹åº”ç”¨çš„32 MB/s ç›¸å·®å¤ªå¤šã€‚</p><p>è‡³äºä¸ºä»€ä¹ˆåªèƒ½çœ‹åˆ° 0.8 MB çš„ HITSï¼Œæˆ‘ä»¬åé¢å†è§£é‡Šï¼Œè¿™é‡Œä½ å…ˆçŸ¥é“æ€ä¹ˆæ ¹æ®ç»“æœæ¥åˆ†æå°±å¯ä»¥äº†ã€‚</p><p>è¿™ä¹Ÿè¿›ä¸€æ­¥éªŒè¯äº†æˆ‘ä»¬çš„çŒœæƒ³ï¼Œè¿™ä¸ªæ¡ˆä¾‹ä¼°è®¡æ²¡æœ‰å……åˆ†åˆ©ç”¨ç³»ç»Ÿç¼“å­˜ã€‚å…¶å®å‰é¢æˆ‘ä»¬é‡åˆ°è¿‡ç±»ä¼¼çš„é—®é¢˜ï¼Œå¦‚æœä¸ºç³»ç»Ÿè°ƒç”¨è®¾ç½®ç›´æ¥ I/O çš„æ ‡å¿—ï¼Œå°±å¯ä»¥ç»•è¿‡ç³»ç»Ÿç¼“å­˜ã€‚</p><p>é‚£ä¹ˆï¼Œè¦åˆ¤æ–­åº”ç”¨ç¨‹åºæ˜¯å¦ç”¨äº†ç›´æ¥I/Oï¼Œæœ€ç®€å•çš„æ–¹æ³•å½“ç„¶æ˜¯è§‚å¯Ÿå®ƒçš„ç³»ç»Ÿè°ƒç”¨ï¼ŒæŸ¥æ‰¾åº”ç”¨ç¨‹åºåœ¨è°ƒç”¨å®ƒä»¬æ—¶çš„é€‰é¡¹ã€‚ä½¿ç”¨ä»€ä¹ˆå·¥å…·æ¥è§‚å¯Ÿç³»ç»Ÿè°ƒç”¨å‘¢ï¼Ÿè‡ªç„¶è¿˜æ˜¯ straceã€‚</p><p>ç»§ç»­åœ¨ç»ˆç«¯äºŒä¸­è¿è¡Œä¸‹é¢çš„ strace å‘½ä»¤ï¼Œè§‚å¯Ÿæ¡ˆä¾‹åº”ç”¨çš„ç³»ç»Ÿè°ƒç”¨æƒ…å†µã€‚æ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨äº† pgrep å‘½ä»¤æ¥æŸ¥æ‰¾æ¡ˆä¾‹è¿›ç¨‹çš„ PID å·ï¼š</p><pre><code># strace -p $(pgrep app)
strace: Process 4988 attached
restart_syscall(&lt;\.\.\. resuming interrupted nanosleep \.\.\.&gt;) = 0
openat(AT_FDCWD, &quot;/dev/sdb1&quot;, O_RDONLY|O_DIRECT) = 4
mmap(NULL, 33558528, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f448d240000
read(4, &quot;8vq\213\314\264u\373\4\336K\224\25@\371\1\252\2\262\252q\221\n0\30\225bD\252\266@J&quot;\.\.\., 33554432) = 33554432
write(1, &quot;Time used: 0.948897 s to read 33&quot;\.\.\., 45) = 45
close(4)                                = 0
</code></pre><p>ä» strace çš„ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œæ¡ˆä¾‹åº”ç”¨è°ƒç”¨äº† openat æ¥æ‰“å¼€ç£ç›˜åˆ†åŒº /dev/sdb1ï¼Œå¹¶ä¸”ä¼ å…¥çš„å‚æ•°ä¸º O_RDONLY|O_DIRECTï¼ˆä¸­é—´çš„ç«–çº¿è¡¨ç¤ºæˆ–ï¼‰ã€‚</p><p>O_RDONLY è¡¨ç¤ºä»¥åªè¯»æ–¹å¼æ‰“å¼€ï¼Œè€Œ O_DIRECT åˆ™è¡¨ç¤ºä»¥ç›´æ¥è¯»å–çš„æ–¹å¼æ‰“å¼€ï¼Œè¿™ä¼šç»•è¿‡ç³»ç»Ÿçš„ç¼“å­˜ã€‚</p><p>éªŒè¯äº†è¿™ä¸€ç‚¹ï¼Œå°±å¾ˆå®¹æ˜“ç†è§£ä¸ºä»€ä¹ˆè¯» 32 MBçš„æ•°æ®å°±éƒ½è¦é‚£ä¹ˆä¹…äº†ã€‚ç›´æ¥ä»ç£ç›˜è¯»å†™çš„é€Ÿåº¦ï¼Œè‡ªç„¶è¿œæ…¢äºå¯¹ç¼“å­˜çš„è¯»å†™ã€‚è¿™ä¹Ÿæ˜¯ç¼“å­˜å­˜åœ¨çš„æœ€å¤§æ„ä¹‰äº†ã€‚</p><p>æ‰¾å‡ºé—®é¢˜åï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨å†çœ‹çœ‹æ¡ˆä¾‹åº”ç”¨çš„<a href="https://github.com/feiskyer/linux-perf-examples/blob/master/io-cached/app.c">æºä»£ç </a>ï¼Œå†æ¬¡éªŒè¯ä¸€ä¸‹ï¼š</p><pre><code>int flags = O_RDONLY | O_LARGEFILE | O_DIRECT; 
int fd = open(disk, flags, 0755);
</code></pre><p>ä¸Šé¢çš„ä»£ç ï¼Œå¾ˆæ¸…æ¥šåœ°å‘Šè¯‰æˆ‘ä»¬ï¼šå®ƒæœç„¶ç”¨äº†ç›´æ¥ I/Oã€‚</p><p>æ‰¾å‡ºäº†ç£ç›˜è¯»å–ç¼“æ…¢çš„åŸå› ï¼Œä¼˜åŒ–ç£ç›˜è¯»çš„æ€§èƒ½è‡ªç„¶ä¸åœ¨è¯ä¸‹ã€‚ä¿®æ”¹æºä»£ç ï¼Œåˆ é™¤ O_DIRECT é€‰é¡¹ï¼Œè®©åº”ç”¨ç¨‹åºä½¿ç”¨ç¼“å­˜ I/O ï¼Œè€Œä¸æ˜¯ç›´æ¥ I/Oï¼Œå°±å¯ä»¥åŠ é€Ÿç£ç›˜è¯»å–é€Ÿåº¦ã€‚</p><p><a href="https://github.com/feiskyer/linux-perf-examples/blob/master/io-cached/app-cached.c">app-cached.c</a> å°±æ˜¯ä¿®å¤åçš„æºç ï¼Œæˆ‘ä¹ŸæŠŠå®ƒæ‰“åŒ…æˆäº†ä¸€ä¸ªå®¹å™¨é•œåƒã€‚åœ¨ç¬¬äºŒä¸ªç»ˆç«¯ä¸­ï¼ŒæŒ‰ Ctrl+C åœæ­¢åˆšæ‰çš„ strace å‘½ä»¤ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä½ å°±å¯ä»¥å¯åŠ¨å®ƒï¼š</p><pre><code># åˆ é™¤ä¸Šè¿°æ¡ˆä¾‹åº”ç”¨
$ docker rm -f app

# è¿è¡Œä¿®å¤åçš„åº”ç”¨
$ docker run --privileged --name=app -itd feisky/app:io-cached
</code></pre><p>è¿˜æ˜¯ç¬¬äºŒä¸ªç»ˆç«¯ï¼Œå†æ¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹æ–°åº”ç”¨çš„æ—¥å¿—ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°ä¸‹é¢è¿™ä¸ªè¾“å‡ºï¼š</p><pre><code>$ docker logs app
Reading data from disk /dev/sdb1 with buffer size 33554432
Time used: 0.037342 s s to read 33554432 bytes
Time used: 0.029676 s to read 33554432 bytes
</code></pre><p>ç°åœ¨ï¼Œæ¯æ¬¡åªéœ€è¦ 0.03ç§’ï¼Œå°±å¯ä»¥è¯»å– 32MB æ•°æ®ï¼Œæ˜æ˜¾æ¯”ä¹‹å‰çš„ 0.9 ç§’å¿«å¤šäº†ã€‚æ‰€ä»¥ï¼Œè¿™æ¬¡åº”è¯¥ç”¨äº†ç³»ç»Ÿç¼“å­˜ã€‚</p><p>æˆ‘ä»¬å†å›åˆ°ç¬¬ä¸€ä¸ªç»ˆç«¯ï¼ŒæŸ¥çœ‹ cachetop çš„è¾“å‡ºæ¥ç¡®è®¤ä¸€ä¸‹ï¼š</p><pre><code>16:40:08 Buffers MB: 73 / Cached MB: 281 / Sort: HITS / Order: ascending
PID      UID      CMD              HITS     MISSES   DIRTIES  READ_HIT%  WRITE_HIT%
   22106 root     app                 40960        0        0     100.0%       0.0%
</code></pre><p>æœç„¶ï¼Œè¯»çš„å‘½ä¸­ç‡è¿˜æ˜¯ 100%ï¼ŒHITS ï¼ˆå³å‘½ä¸­æ•°ï¼‰å´å˜æˆäº† 40960ï¼ŒåŒæ ·çš„æ–¹æ³•è®¡ç®—ä¸€ä¸‹ï¼Œæ¢ç®—æˆæ¯ç§’å­—èŠ‚æ•°æ­£å¥½æ˜¯ 32 MBï¼ˆå³ 40960*4k/5/1024=32Mï¼‰ã€‚</p><p>è¿™ä¸ªæ¡ˆä¾‹è¯´æ˜ï¼Œåœ¨è¿›è¡Œ I/O æ“ä½œæ—¶ï¼Œå……åˆ†åˆ©ç”¨ç³»ç»Ÿç¼“å­˜å¯ä»¥æå¤§åœ°æå‡æ€§èƒ½ã€‚ ä½†åœ¨è§‚å¯Ÿç¼“å­˜å‘½ä¸­ç‡æ—¶ï¼Œè¿˜è¦æ³¨æ„ç»“åˆåº”ç”¨ç¨‹åºå®é™…çš„ I/O å¤§å°ï¼Œç»¼åˆåˆ†æç¼“å­˜çš„ä½¿ç”¨æƒ…å†µã€‚</p><p>æ¡ˆä¾‹çš„æœ€åï¼Œå†å›åˆ°å¼€å§‹çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆä¼˜åŒ–å‰ï¼Œé€šè¿‡ cachetop åªèƒ½çœ‹åˆ°å¾ˆå°‘ä¸€éƒ¨åˆ†æ•°æ®çš„å…¨éƒ¨å‘½ä¸­ï¼Œè€Œæ²¡æœ‰è§‚å¯Ÿåˆ°å¤§é‡æ•°æ®çš„æœªå‘½ä¸­æƒ…å†µå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºï¼Œcachetop å·¥å…·å¹¶ä¸æŠŠç›´æ¥ I/O ç®—è¿›æ¥ã€‚è¿™ä¹Ÿåˆä¸€æ¬¡è¯´æ˜äº†ï¼Œäº†è§£å·¥å…·åŸç†çš„é‡è¦ã€‚</p><blockquote>
<p>cachetop çš„è®¡ç®—æ–¹æ³•æ¶‰åŠåˆ° I/O çš„åŸç†ä»¥åŠä¸€äº›å†…æ ¸çš„çŸ¥è¯†ï¼Œå¦‚æœä½ æƒ³äº†è§£å®ƒçš„åŸç†çš„è¯ï¼Œå¯ä»¥ç‚¹å‡»<a href="https://github.com/iovisor/bcc/blob/master/tools/cachetop.py">è¿™é‡Œ</a>æŸ¥çœ‹å®ƒçš„æºä»£ç ã€‚</p>
</blockquote><h2>æ€»ç»“</h2><p>Buffers å’Œ Cache å¯ä»¥æå¤§æå‡ç³»ç»Ÿçš„ I/O æ€§èƒ½ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬ç”¨ç¼“å­˜å‘½ä¸­ç‡ï¼Œæ¥è¡¡é‡ç¼“å­˜çš„ä½¿ç”¨æ•ˆç‡ã€‚å‘½ä¸­ç‡è¶Šé«˜ï¼Œè¡¨ç¤ºç¼“å­˜è¢«åˆ©ç”¨å¾—è¶Šå……åˆ†ï¼Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½ä¹Ÿå°±è¶Šå¥½ã€‚</p><p>ä½ å¯ä»¥ç”¨ cachestat å’Œ cachetop è¿™ä¸¤ä¸ªå·¥å…·ï¼Œè§‚å¯Ÿç³»ç»Ÿå’Œè¿›ç¨‹çš„ç¼“å­˜å‘½ä¸­æƒ…å†µã€‚å…¶ä¸­ï¼Œ</p><ul>
<li>
<p>cachestat æä¾›äº†æ•´ä¸ªç³»ç»Ÿç¼“å­˜çš„è¯»å†™å‘½ä¸­æƒ…å†µã€‚</p>
</li>
<li>
<p>cachetop æä¾›äº†æ¯ä¸ªè¿›ç¨‹çš„ç¼“å­˜å‘½ä¸­æƒ…å†µã€‚</p>
</li>
</ul><p>ä¸è¿‡è¦æ³¨æ„ï¼ŒBuffers å’Œ Cache éƒ½æ˜¯æ“ä½œç³»ç»Ÿæ¥ç®¡ç†çš„ï¼Œåº”ç”¨ç¨‹åºå¹¶ä¸èƒ½ç›´æ¥æ§åˆ¶è¿™äº›ç¼“å­˜çš„å†…å®¹å’Œç”Ÿå‘½å‘¨æœŸã€‚æ‰€ä»¥ï¼Œåœ¨åº”ç”¨ç¨‹åºå¼€å‘ä¸­ï¼Œä¸€èˆ¬è¦ç”¨ä¸“é—¨çš„ç¼“å­˜ç»„ä»¶ï¼Œæ¥è¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚</p><p>æ¯”å¦‚ï¼Œç¨‹åºå†…éƒ¨å¯ä»¥ä½¿ç”¨å †æˆ–è€…æ ˆæ˜ç¡®å£°æ˜å†…å­˜ç©ºé—´ï¼Œæ¥å­˜å‚¨éœ€è¦ç¼“å­˜çš„æ•°æ®ã€‚å†æˆ–è€…ï¼Œä½¿ç”¨ Redis è¿™ç±»å¤–éƒ¨ç¼“å­˜æœåŠ¡ï¼Œä¼˜åŒ–æ•°æ®çš„è®¿é—®æ•ˆç‡ã€‚</p><h2>æ€è€ƒ</h2><p>æœ€åï¼Œæˆ‘æƒ³ç»™ä½ ç•™ä¸‹ä¸€é“æ€è€ƒé¢˜ï¼Œå¸®ä½ æ›´è¿›ä¸€æ­¥äº†è§£ç¼“å­˜çš„åŸç†ã€‚</p><p>ä»Šå¤©çš„ç¬¬äºŒä¸ªæ¡ˆä¾‹ä½ åº”è¯¥å¾ˆçœ¼ç†Ÿï¼Œå› ä¸ºå‰é¢ä¸å¯ä¸­æ–­è¿›ç¨‹çš„æ–‡ç« ç”¨çš„ä¹Ÿæ˜¯ç›´æ¥I/Oçš„ä¾‹å­ï¼Œä¸è¿‡é‚£æ¬¡ï¼Œæˆ‘ä»¬æ˜¯ä»CPUä½¿ç”¨ç‡å’Œè¿›ç¨‹çŠ¶æ€çš„è§’åº¦æ¥åˆ†æçš„ã€‚å¯¹æ¯”CPUå’Œç¼“å­˜è¿™ä¸¤ä¸ªä¸åŒè§’åº¦çš„åˆ†ææ€è·¯ï¼Œä½ æœ‰ä»€ä¹ˆæ ·çš„å‘ç°å‘¢ï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå’Œæˆ‘è®¨è®ºï¼Œå†™ä¸‹ä½ çš„ç­”æ¡ˆå’Œæ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ã€‚æˆ‘ä»¬ä¸€èµ·åœ¨å®æˆ˜ä¸­æ¼”ç»ƒï¼Œåœ¨äº¤æµä¸­è¿›æ­¥ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/a3/e9/a396aed4116c2c989771c1295736abe9.jpg" alt=""></p>
                    </div>
                </div>

            </div>
            <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span
                    data-v-87ffcada="">ç²¾é€‰ç•™è¨€</span></h2>
                <ul data-v-87ffcada="">
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æˆ‘æ¥ä¹Ÿ</span>
                            </div>
                            <div class="bd">[D17æ‰“å¡]<br>æƒ³ä¸åˆ°Buffer å’Œ Cacheè¿˜æœ‰ä¸“é—¨çš„å·¥å…·åˆ†æ, é•¿è§è¯†äº†!<br>æš‚æ—¶åªèƒ½åœ¨è‡ªå·±çš„æœºå™¨ä¸Šç©ç©, ç”Ÿäº§ç¯å¢ƒè¿rootæƒé™éƒ½æ²¡æœ‰,æ›´åˆ«æå‡çº§CentOSå†…æ ¸ç‰ˆæœ¬äº†.<br>-----------------<br>å…³äºæ€è€ƒé¢˜,æˆ‘æ˜¯è¿™æ ·æƒ³çš„:<br>å‡ºç°æ€§èƒ½é—®é¢˜æ—¶çš„ç—‡çŠ¶å¯èƒ½å¹¶ä¸æ˜¯å•ä¸€çš„. <br>æ¯”å¦‚è¿™æ¬¡åŒä¸€ä¸ªæ¡ˆä¾‹,ä»CPUå’Œç¼“å­˜ä¸¤ä¸ªä¸åŒçš„è§’åº¦, éƒ½æ˜¯å®šä½åˆ°äº†ä»£ç ä¸­çš„open.<br>cpuè§’åº¦åˆ†æçš„æµç¨‹æ˜¯:<br>1.top çœ‹åˆ°äº†%iowaitå‡é«˜<br>2.dstat çœ‹åˆ°äº†waitå‡é«˜æ—¶ readåŒæ­¥å‡é«˜. è¯´æ˜è·Ÿç£ç›˜ç›¸å…³<br>3.$ perf record -g   ;   $ perf report  å®šä½åˆ°äº†è·Ÿç£ç›˜ç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨ sys_read(). new_sync_read å’Œ blkdev_direct_IO å®šä½åˆ°äº†è·Ÿç›´æ¥è¯»æœ‰å…³ç³».<br>4.æŸ¥çœ‹ä»£ç  æ‰¾åˆ°äº†è·Ÿç£ç›˜ç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨ open.<br>ç¼“å­˜è§’åº¦åˆ†æçš„æµç¨‹æ˜¯:<br>1.è¿›ç¨‹5ç§’ç¼“å­˜å‘½ä¸­ç‡100%,ä½†æ˜¯åªå‘½ä¸­äº†1024æ¬¡,æ¨ç®—ä½¿ç”¨ç¼“å­˜4MB.å®é™…æ¯ç§’0.8MB<br>2.çœ‹æ—¥å¿—çŸ¥é“æ¯æ¬¡è¯»å–çš„æ˜¯32MB.[å®é™…ä¹Ÿå¯ä»¥é€šè¿‡dstat vmstatç­‰å·¥å…·ç²—ç•¥æ¨ç®—å‡ºè¯¥å€¼]<br>3.é¢„æœŸçš„32Mä¸å®é™…çš„0.8Mç›¸å·®ç”šè¿œ. æ¥æ‰¾åŸå› .<br>4.strace æŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨ å®šä½åˆ°äº†openat åŠ ç›´æ¥ç»™å‡ºäº†è°ƒç”¨å‚æ•° O_DIRECT<br>5.æŸ¥çœ‹ä»£ç  æ‰¾åˆ°äº†è·Ÿç£ç›˜ç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨ open.<br>-----------------<br>ä¸ªäººæ€»ç»“:<br>é¡ºè—¤æ‘¸ç“œ, æ ¹æ®ç°åƒæ‰¾æœ¬è´¨åŸå› . <br>ç£ç›˜ioå¯¼è‡´æ€§èƒ½é—®é¢˜ -&gt; æŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨  -&gt; å®šä½å¤§è‡´åŸå›  -&gt; æŸ¥çœ‹æºç   -&gt; ç¡®å®šé—®é¢˜<br>è¿˜å±…ç„¶åœ¨å®Œå…¨ä¸çŸ¥é“ç¨‹åºå…·ä½“å®ç°çš„åŸºç¡€ä¸Š,å®šä½åˆ°äº†å¼•èµ·æ€§èƒ½é—®é¢˜çš„ç³»ç»Ÿè°ƒç”¨. æœ‰çš„ç”šè‡³è¿˜ç›´æ¥ç»™å‡ºäº†å‚æ•°,å¤ªç‰›äº†. <br></div>
                            <span class="time">2018-12-28 12:04</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ€»ç»“çš„å¾ˆå¥½ï¼Œå…¶å®ä¸¤ä¸ªæ€è·¯éƒ½å¯ä»¥ï¼Œä¸è¿‡å…·ä½“å®è·µæ—¶å¯èƒ½ä¼šå—é™äºå¯ç”¨çš„æ€§èƒ½å·¥å…·</p>
                                <p class="reply-time">2018-12-28 21:26</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/b1/4d/10c75b34.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Johnson</span>
                            </div>
                            <div class="bd">ddå‘½ä»¤ä¹Ÿæ”¯æŒç›´æ¥IOçš„ æœ‰é€‰é¡¹oflagå’Œiflag æ‰€ä»¥ddä¹Ÿå¯ä»¥ç”¨æ¥ç»•è¿‡cache buffåšæµ‹è¯• <br></div>
                            <span class="time">2018-12-28 12:42</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘å¯¹çš„</p>
                                <p class="reply-time">2018-12-28 21:22</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å¾€äº‹éšé£ï¼Œé¡ºå…¶è‡ªç„¶</span>
                            </div>
                            <div class="bd">è¦æ˜¯centoséªŒè¯ä¸€ä¸‹å°±å¥½äº†ï¼Œä¸åŒç³»ç»Ÿå¾ˆå¤šé—®é¢˜ä¸ä¸€æ ·ï¼Œæ“ä½œä¸Šé‡åˆ°é—®é¢˜å¾ˆå¥‡æ€ª <br></div>
                            <span class="time">2018-12-28 08:32</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¤§éƒ¨åˆ†æ¡ˆä¾‹æˆ‘éƒ½åœ¨centos7éªŒè¯äº†ï¼Œä¸è¿‡æ–‡ç« ä¸­æœ‰äº›åœ°æ–¹æ²¡æœ‰åˆ—å‡ºæ¥è¯¦ç»†çš„æ­¥éª¤ï¼Œæ¯”å¦‚å®‰è£…æˆ–è€…å‡çº§è½¯ä»¶åŒ…çš„æ­¥éª¤ï¼Œè¿™äº›å…¶å®éƒ½æ˜¯äº›åŸºæœ¬åŠŸäº†ã€‚å¦‚æœç¢°åˆ°å®åœ¨æ— æ³•è§£å†³çš„é—®é¢˜ï¼Œè¯·å…·ä½“æè¿°ä¸‹ã€‚</p>
                                <p class="reply-time">2018-12-28 21:49</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/5a/56/115c6433.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">jssfy</span>
                            </div>
                            <div class="bd">è¯·é—®ç¬¬ä¸€æ¬¡è¯»50%çš„å‘½ä¸­ç‡å¦‚ä½•è§£é‡Šå‘¢ï¼Ÿ <br></div>
                            <span class="time">2019-01-04 09:56</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">noma</span>
                            </div>
                            <div class="bd">pcstat ä¸ä½¿ç”¨ä»£ç†å®‰è£…ï¼š<br>if [ $(uname -m) == &quot;x86_64&quot; ] ; then<br>    curl -L -o pcstat https:&#47;&#47;github.com&#47;tobert&#47;pcstat&#47;raw&#47;2014-05-02-01&#47;pcstat.x86_64<br>else<br>    curl -L -o pcstat https:&#47;&#47;github.com&#47;tobert&#47;pcstat&#47;raw&#47;2014-05-02-01&#47;pcstat.x86_32<br>fi<br>chmod 755 pcstat<br>.&#47;pcstat å³å¯ä½¿ç”¨ <br></div>
                            <span class="time">2019-01-02 22:53</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/8b/70/ab68020f.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Tech</span>
                            </div>
                            <div class="bd">æœ‰ä¸ªç–‘é—®ï¼Œæ—¢ç„¶appé‚£ä¸ªæ¡ˆä¾‹æ˜¯ç›´æ¥i&#47;oï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜æ˜¯æœ‰ç¼“å­˜äº†4MBå‘¢ï¼Ÿ <br></div>
                            <span class="time">2018-12-31 10:43</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/13/52/db1b01fc.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ç™½å</span>
                            </div>
                            <div class="bd">centos7ç³»ç»Ÿå®‰è£…bcc-toolsçš„æ•™ç¨‹æˆ‘å†™åœ¨äº†ç®€ä¹¦ä¸Šï¼šhttps:&#47;&#47;www.jianshu.com&#47;p&#47;997e0a6d8e09å¤§å®¶å¦‚æœæœ‰å®‰è£…ä¸ä¸‹æ¥çš„å¯ä»¥çœ‹çœ‹ <br></div>
                            <span class="time">2018-12-29 11:09</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/8b/15/5278f52a.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ˜¥æš–èŠ±å¼€</span>
                            </div>
                            <div class="bd">éå¸¸æœ‰ä»·å€¼ï¼Œæ˜¯æˆ‘é˜…è¯»çš„æå®¢è¯¾ç¨‹é‡Œé¢æœ€æ£’çš„ã€‚ <br></div>
                            <span class="time">2018-12-28 08:07</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ˜Šè°¢è°¢</p>
                                <p class="reply-time">2018-12-28 21:53</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/be/52/568e8c06.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è‹¹æœxixi</span>
                            </div>
                            <div class="bd">1024*4K&#47;1024=4mè¿™æ˜¯æ€ä¹ˆç®—çš„<br><br> <br></div>
                            <span class="time">2019-01-01 11:21</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKsz8j0bAayjSne9iakvjzUmvUdxWEbsM9iasQ74spGFayIgbSE232sH2LOWmaKtx1WqAFDiaYgVPwIQ/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">2xshu</span>
                            </div>
                            <div class="bd">è€å¸ˆä½ å¥½ï¼Œç¬¬ä¸€ä¸ªæ¡ˆåˆ—æˆ‘æœ‰ä¸å¤ªæ˜ç™½çš„åœ°æ–¹ã€‚å¸Œæœ›èƒ½å¾—åˆ°è€å¸ˆçš„æŒ‡æ•™ã€‚<br>æ—¢ç„¶æ‰§è¡Œäº† echo 3 &gt; &#47;proc&#47;sys&#47;vm&#47;drop_cacchesï¼Œä¸ºä»€ä¹ˆåœ¨dd if=file of=&#47;dev&#47;null bs=1M çš„æ—¶å€™ï¼Œè¿˜æœ‰ç¼“å­˜èƒ½å‘½ä¸­å‘¢ï¼Ÿæˆ‘å¾—ç†è§£æ˜¯è¿™äº›æ•°æ®åº”è¯¥éƒ½æ²¡æœ‰åœ¨ç¼“å­˜å•Šã€‚<br> <br></div>
                            <span class="time">2018-12-29 09:50</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/62/2f/bb04ae52.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æœ«ç­è½¦</span>
                            </div>
                            <div class="bd">è€å¸ˆå¤ªå‰å®³äº†ï¼Œè¿™ä¸ªè¯¾ç¨‹çš„ä»·å€¼è¿œè¿œé«˜äºè¿™ä¸ªä»·ï¼ï¼ <br></div>
                            <span class="time">2018-12-28 23:34</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/f2/2b/7d9751bb.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è®¸å±±å±±</span>
                            </div>
                            <div class="bd">æˆ‘ä¹Ÿè§‰å¾—è¿™é—¨è¯¾è¶…çº§æ£’äº†ï¼ŒåŸç†åŠ æ—¶é—´ï¼Œå­¦åˆ°å¾ˆå¤šï¼ <br></div>
                            <span class="time">2018-12-28 12:05</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">è°¢è°¢ğŸ‘</p>
                                <p class="reply-time">2018-12-28 21:23</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/32/0b/981b4e93.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å¿µä½ å¦‚æ˜”</span>
                            </div>
                            <div class="bd">ï¼ˆæˆ‘æ˜¯å°ç™½ï¼‰<br>1.ddå‘½ä»¤å‰æ¸…ç†äº†ç¼“å­˜ï¼Œä¸ºä»€ä¹ˆç¼“å­˜å‘½ä¸­ç‡æ˜¯ç™¾åˆ†ä¹‹49.8å‘¢ï¼Ÿï¼ˆéƒ½å·²ç»æ²¡æœ‰ç¼“å­˜äº†ï¼ŒæŒ‰ç†è¯´æ˜¯0ï¼‰<br>2.ç»•è¿‡äº†ç³»ç»Ÿç¼“å­˜ï¼Œä¸ºä»€ä¹ˆç¼“å­˜å‘½ä¸­ç‡è¿˜ç™¾åˆ†ä¹‹ç™¾ï¼Ÿ <br></div>
                            <span class="time">2019-01-04 15:26</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ernR4NKI5tejJAV3HMTF3gszBBUAjkjLO2QYic2gx5dMGelFv4LWibib7CUGexmMcMp5HiaaibmOH3dyHg/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ¸¡æ¸¡é¸Ÿ_linux</span>
                            </div>
                            <div class="bd">è¡¥å……ä¸‹centos7ä½¿ç”¨yum å®‰è£…bcc-tools:<br>[root@centos-80 ~]# yum update<br>[root@centos-80 ~]# rpm --import https:&#47;&#47;www.elrepo.org&#47;RPM-GPG-KEY-elrepo.org &amp;&amp; rpm -Uvh http:&#47;&#47;www.elrepo.org&#47;elrepo-release-7.0-2.el7.elrepo.noarch.rpm<br>[root@centos-80 ~]# uname -r ## <br>3.10.0-862.el7.x86_64<br>[root@centos-80 ~]# yum remove kernel-headers kernel-tools kernel-tools-libs<br>[root@centos-80 ~]# yum --disablerepo=&quot;*&quot; --enablerepo=&quot;elrepo-kernel&quot; install kernel-ml kernel-ml-devel kernel-ml-headers kernel-ml-tools kernel-ml-tools-libs kernel-ml-tools-libs-devel <br>[root@centos-80 ~]# sed -i &#39;&#47;GRUB_DEFAULT&#47;s&#47;=.*&#47;=0&#47;&#39; &#47;etc&#47;default&#47;grub<br>[root@centos-80 ~]# grub2-mkconfig -o &#47;boot&#47;grub2&#47;grub.cfg<br>[root@centos-80 ~]# reboot<br>[root@centos-80 ~]# uname -r ## å‡çº§æˆåŠŸ<br>4.20.0-1.el7.elrepo.x86_64<br>[root@centos-80 ~]# yum install -y bcc-tools<br>[root@centos-80 ~]# echo &#39;export PATH=$PATH:&#47;usr&#47;share&#47;bcc&#47;tools&#39; &gt; &#47;etc&#47;profile.d&#47;bcc-tools.sh<br>[root@centos-80 ~]# . &#47;etc&#47;profile.d&#47;bcc-tools.sh<br>[root@centos-80 ~]# cachestat 1 1 ## æµ‹è¯•å®‰è£…æ˜¯å¦æˆåŠŸ<br>   TOTAL   MISSES     HITS  DIRTIES   BUFFERS_MB  CACHED_MB<br>       0        0        0        0            2        287 <br></div>
                            <span class="time">2019-01-01 10:18</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/57/ed/d96acbd7.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">mj4ever</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼š<br>1ã€ä¸çŸ¥é“æ˜¯ä¸æ˜¯å›ºæ€ç¡¬ç›˜çš„åŸå› ï¼Œè°ƒæ•´äº†å‚æ•°è‡³320MB<br>docker run --privileged --name=app -itd feisky&#47;app:io-direct &#47;app -d &#47;dev&#47;sdb -s 335544320<br>2ã€ç”¨å‘½ä»¤è§‚å¯Ÿï¼Œcachestat 5ï¼Œå¯ä»¥è¾¾åˆ°409600ï¼Œ409600*4&#47;1024=320MB<br>3ã€å¦å¤–ï¼Œæƒ³å†è°ƒå¤§äº›å‚æ•°ï¼Œä¼šæŠ¥é”™ï¼š<br>Reading data from disk &#47;dev&#47;sda1 with buffer size 335544321<br>failed to read contents: Invalid argument <br></div>
                            <span class="time">2018-12-31 16:22</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/57/6e/dd0eee5f.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å¤œç©ºä¸­æœ€äº®çš„æ˜Ÿï¼ˆåä»”ï¼‰</span>
                            </div>
                            <div class="bd">è€å¸ˆ ï¼š<br>è¿™ä¸ª go get golang.org&#47;x&#47;sys&#47;unix   è®¿é—®ä¸äº†å›½å†…ä¸‹è½½ä¸äº†ï¼Œ<br>è€å¸ˆæ‚¨æœ‰ä»€ä¹ˆæ–¹æ³•å—ï¼ŸæŒ‡ç‚¹ä¸‹ è°¢è°¢<br>[root@bogon ~]# go get golang.org&#47;x&#47;sys&#47;unix <br>package golang.org&#47;x&#47;sys&#47;unix: unrecognized import path &quot;golang.org&#47;x&#47;sys&#47;unix&quot; (https fetch: Get https:&#47;&#47;golang.org&#47;x&#47;sys&#47;unix?go-get=1: dial tcp 216.239.37.1:443: connect: connection refused)<br>[root@bogon ~]# <br><br>å¯¼è‡´ä¸‹é¢çš„ä¹Ÿå®‰è£…ä¸ä¸Š<br>go get github.com&#47;tobert&#47;pcstat&#47;pcstat<br><br>[root@bogon ~]# go get github.com&#47;tobert&#47;pcstat&#47;pcstat<br>package golang.org&#47;x&#47;sys&#47;unix: unrecognized import path &quot;golang.org&#47;x&#47;sys&#47;unix&quot; (https fetch: Get https:&#47;&#47;golang.org&#47;x&#47;sys&#47;unix?go-get=1: dial tcp 216.239.37.1:443: connect: connection refused)<br>[root@bogon ~]#  <br></div>
                            <span class="time">2018-12-28 19:13</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ˜¯çš„ï¼Œä¸‹è½½ golang.org çš„åŒ…éœ€è¦ä½¿ç”¨ä»£ç†ï¼Œè®¾ç½®æ–¹æ³•æ˜¯ï¼š<br><br>git config [--global] http.proxy http:&#47;&#47;proxy.example.com:port</p>
                                <p class="reply-time">2018-12-28 20:53</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ninuxer</span>
                            </div>
                            <div class="bd">æ‰“å¡day18<br>å¹´ç»ˆå¿™ç€å„ç§æ€»ç»“ï¼Œå„ç§æ–‡å­—æ€§ä¸œè¥¿ï¼Œå·²ç»è¿ç€ä¸€ç¤¼æ‹œ12ç‚¹ä¹‹åä¸‹ç­äº†ï¼Œå†å¿™ä¹Ÿè¦åšæŒè·Ÿç€å®è·µï½ğŸ’ªğŸ’ªğŸ’ª <br></div>
                            <span class="time">2018-12-28 13:39</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘åŠ æ²¹</p>
                                <p class="reply-time">2018-12-28 21:20</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/92/01/c723d180.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é¥¼å­</span>
                            </div>
                            <div class="bd">æˆ‘çš„ç†è§£æ˜¯ï¼Œè¦é«˜æ•ˆè¿è¡Œå’Œä½¿ç”¨cpuï¼Œå¹¶è®©cpuæŒç»­å·¥ä½œï¼Œå‡å°‘ç­‰å¾…æ—¶é—´ï¼Œå°±éœ€è¦åœ¨ç‰©ç†ioä¸Šé¢åšä¼˜åŒ–ï¼Œå‡å°‘ä¸å¯ä¸­æ–­ï¼Œåœ¨åŠ å…¥ç¼“å­˜æ˜¯å¯ä»¥ä¼˜åŒ–ioæ¬¡æ•°çš„ï¼ <br></div>
                            <span class="time">2018-12-28 11:24</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¯¹å¯¹ï¼Œç”¨ç¼“å­˜ä¼˜åŒ–æ…¢é€ŸI&#47;O</p>
                                <p class="reply-time">2018-12-28 21:27</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/1b/36/abe6d066.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ä»˜ç›¼æ˜Ÿ</span>
                            </div>
                            <div class="bd">è€å¸ˆå¥½ï¼Œæˆ‘æœ‰ä¸ªé—®é¢˜ï¼Œå…¬å¸æœåŠ¡å™¨æ˜¯4æ ¸8gï¼Œä½†æ˜¯æˆ‘çœ‹åˆ°æ™®éçš„cacheä½¿ç”¨é‡éƒ½åœ¨3gå·¦å³ï¼Œè¿™ä¸ªæ˜¯å¦æ­£å¸¸ï¼Œæœ‰æ²¡æœ‰å‘½ä»¤å¯ä»¥æŸ¥çœ‹å“ªäº›å¤§æ–‡ä»¶è¢«ç¼“å­˜äº†ï¼ŒæŒ‰ç…§å æ€»é‡æ’åºï¼Œèƒ½ä¸èƒ½æ¸…ç†ï¼Œå› ä¸ºfreeå°±å‰©ä¸‹ä¸åˆ°1gï¼Œå¾ˆå®¹æ˜“å°±oomäº†ï¼Œéå¸¸æ„Ÿè°¢è€å¸ˆï¼ŒæœŸå¾…è€å¸ˆè§£ç­”ã€‚ <br></div>
                            <span class="time">2018-12-28 08:59</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">è¿™æ˜¯æ­£å¸¸çš„ï¼Œå®é™…ä¸Šç¹å¿™çš„ç³»ç»Ÿä¸­ç¼“å­˜å¯èƒ½è¿˜ä¼šæ›´å¤šã€‚<br><br>æ®æˆ‘æ‰€çŸ¥ï¼Œè¿˜æ²¡æœ‰å¯ä»¥æŒ‰æ–‡ä»¶ç¼“å­˜å¤§å°æ’åºçš„å·¥å…·ã€‚å¾ˆå¤šç¼“å­˜éƒ½æ˜¯å¯å›æ”¶çš„ï¼Œæ‰€ä»¥å¹¶ä¸ä»£è¡¨å°±å®¹æ˜“OOMã€‚çœŸçš„å®¹æ˜“å‘ç”ŸOOMæ—¶ï¼Œè¯´æ˜ç¼“å­˜æ­£åœ¨è¢«ä½¿ç”¨ï¼Œè¿™å…¶å®å°±å¯ä»¥ä»è¿›ç¨‹è§’åº¦æ¥åˆ†æäº†</p>
                                <p class="reply-time">2018-12-28 21:39</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/11/4b/afafe35e.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">xfan</span>
                            </div>
                            <div class="bd">æˆ‘çŸ¥é“é—®é¢˜åœ¨å“ªäº†ï¼Œæ˜¯æˆ‘çš„æ—¶é—´ä¸æ˜¯1ç§’ï¼Œæˆ‘ä¸è¯¥é™¤ä»¥5ï¼Œ <br></div>
                            <span class="time">2019-01-11 00:22</span>
                            
                        </div>
                    </li>
                    


                </ul>
            </div>
        </div>
    </div>
</div>
</body>
</html>