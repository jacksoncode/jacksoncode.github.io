# 配置文件参考

## 1 系统级配置文件

### 1.1 网络配置

#### /etc/network/interfaces (Debian/Ubuntu)
```bash
# 静态IP配置
auto eth0
iface eth0 inet static
    address 192.168.1.100
    netmask 255.255.255.0
    gateway 192.168.1.1
    dns-nameservers 8.8.8.8 8.8.4.4

# DHCP配置
auto eth0
iface eth0 inet dhcp
```

#### /etc/sysconfig/network-scripts/ifcfg-eth0 (CentOS/RHEL)
```bash
TYPE=Ethernet
BOOTPROTO=static
IPADDR=192.168.1.100
NETMASK=255.255.255.0
GATEWAY=192.168.1.1
DNS1=8.8.8.8
DNS2=8.8.4.4
ONBOOT=yes
NAME=eth0
DEVICE=eth0
```

#### /etc/netplan/01-netcfg.yaml (Ubuntu 18.04+)
```yaml
network:
  version: 2
  renderer: networkd
  ethernets:
    eth0:
      dhcp4: no
      addresses: [192.168.1.100/24]
      gateway4: 192.168.1.1
      nameservers:
        addresses: [8.8.8.8, 8.8.4.4]
```

#### /etc/NetworkManager/system-connections/eth0.nmconnection
```ini
[connection]
id=eth0
uuid=xxx-xxx-xxx-xxx
type=ethernet
autoconnect=true

[ethernet]
mac-address=AA:BB:CC:DD:EE:FF

[ipv4]
method=manual
addresses=192.168.1.100/24
gateway=192.168.1.1
dns=8.8.8.8;8.8.4.4

[ipv6]
method=auto
```

### 1.2 DNS配置

#### /etc/resolv.conf
```bash
# DNS服务器
nameserver 8.8.8.8
nameserver 8.8.4.4

# 搜索域
search example.com company.com

# 选项
options ndots:0 timeout:2 attempts:3
```

#### /etc/nsswitch.conf
```bash
# 名称服务切换配置
passwd:     files systemd
shadow:     files systemd
group:      files systemd
hosts:      files dns myhostname
services:   files
networks:   files
protocols:  files
```

### 1.3 系统启动配置

#### /etc/default/grub
```bash
# GRUB配置
GRUB_TIMEOUT=5
GRUB_DISTRIBUTOR=`lsb_release -i -s 2> /dev/null || echo Debian`
GRUB_DEFAULT=0
GRUB_CMDLINE_LINUX_DEFAULT="quiet splash"
GRUB_CMDLINE_LINUX="net.ifnames=0 biosdevname=0"

# 安全设置
GRUB_DISABLE_RECOVERY="true"
GRUB_DISABLE_OS_PROBER=false
```

#### /etc/fstab
```bash
# 文件系统表
UUID=xxx-xxx-xxx-xxx  /               ext4    defaults,noatime,nodiratime,errors=remount-ro 0 1
UUID=xxx-xxx-xxx-xxx  /home           ext4    defaults,noatime,nodiratime,commit=120 0 2
UUID=xxx-xxx-xxx-xxx  /var            ext4    defaults,noatime,nodiratime,commit=120 0 2
UUID=xxx-xxx-xxx-xxx  none            swap    sw              0 0

# NFS挂载
server:/export/data    /mnt/data    nfs    defaults,_netdev    0 0
```

## 2 服务配置文件

### 2.1 SSH配置

#### /etc/ssh/sshd_config
```bash
# SSH服务配置
Port 22
AddressFamily inet
ListenAddress 0.0.0.0

# 认证
PasswordAuthentication yes
PubkeyAuthentication yes
AuthorizedKeysFile .ssh/authorized_keys
PermitRootLogin no
MaxAuthTries 3
MaxSessions 10
LoginGraceTime 60

# 安全
Protocol 2
HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key
HostKey /etc/ssh/ssh_host_ed25519_key

# 性能
UseDNS no
GSSAPIAuthentication no

# 子系统
Subsystem sftp /usr/lib/openssh/sftp-server
```

#### ~/.ssh/config
```bash
# 个人SSH配置
Host server1
    HostName 192.168.1.10
    Port 22
    User admin
    IdentityFile ~/.ssh/id_rsa
    ServerAliveInterval 60
    ServerAliveCountMax 3

Host github.com
    HostName github.com
    User git
    IdentityFile ~/.ssh/github_key
    IdentitiesOnly yes
```

### 2.2 Web服务器配置

#### /etc/apache2/sites-available/example.com.conf
```apache
<VirtualHost *:80>
    ServerName example.com
    ServerAlias www.example.com
    DocumentRoot /var/www/example.com
    
    ErrorLog ${APACHE_LOG_DIR}/example.com_error.log
    CustomLog ${APACHE_LOG_DIR}/example.com_access.log combined
    
    <Directory /var/www/example.com>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    # PHP配置
    php_value upload_max_filesize 64M
    php_value post_max_size 64M
    php_value memory_limit 256M
</VirtualHost>
```

#### /etc/nginx/sites-available/example.com
```nginx
server {
    listen 80;
    listen [::]:80;
    server_name example.com www.example.com;
    root /var/www/example.com;
    index index.php index.html index.htm;
    
    access_log /var/log/nginx/example.com.access.log;
    error_log /var/log/nginx/example.com.error.log;
    
    # 静态文件缓存
    location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # PHP处理
    location ~ \\.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
    
    # 安全设置
    location ~ /\. {
        deny all;
    }
}
```

### 2.3 数据库配置

#### /etc/mysql/mysql.conf.d/mysqld.cnf
```ini
[mysqld]
# 基本设置
user = mysql
pid-file = /var/run/mysqld/mysqld.pid
socket = /var/run/mysqld/mysqld.sock
port = 3306
basedir = /usr
datadir = /var/lib/mysql
tmpdir = /tmp
lc-messages-dir = /usr/share/mysql
skip-external-locking

# 性能设置
key_buffer_size = 16M
max_allowed_packet = 16M
thread_stack = 192K
thread_cache_size = 8
myisam_recover_options = BACKUP

# 查询缓存
query_cache_limit = 1M
query_cache_size = 16M

# 日志设置
log_error = /var/log/mysql/error.log
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2
log_queries_not_using_indexes = 1

# InnoDB设置
innodb_buffer_pool_size = 128M
innodb_log_file_size = 48M
innodb_flush_log_at_trx_commit = 1
innodb_flush_method = O_DIRECT

# 连接设置
max_connections = 100
wait_timeout = 28800
interactive_timeout = 28800
```

#### /etc/postgresql/12/main/postgresql.conf
```ini
# 连接设置
listen_addresses = 'localhost'
port = 5432
max_connections = 100

# 内存设置
shared_buffers = 128MB
effective_cache_size = 4GB
work_mem = 4MB
maintenance_work_mem = 64MB

# WAL设置
wal_buffers = 16MB
checkpoint_completion_target = 0.9
checkpoint_timeout = 10min

# 日志设置
log_destination = 'stderr'
logging_collector = on
log_directory = '/var/log/postgresql'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_rotation_age = 1d
log_rotation_size = 100MB
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# 性能设置
random_page_cost = 1.1
effective_io_concurrency = 200
```

## 3 现代服务配置

### 3.1 Systemd服务配置

#### /etc/systemd/system/myservice.service
```ini
[Unit]
Description=My Custom Service
After=network.target
Wants=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/myservice
ExecReload=/bin/kill -HUP $MAINPID
KillMode=process
Restart=always
RestartSec=5s
User=myuser
Group=mygroup
WorkingDirectory=/opt/myservice
Environment=ENV_VAR=value
EnvironmentFile=/etc/myservice/env

# 资源限制
LimitNOFILE=65536
LimitNPROC=4096

# 日志
StandardOutput=journal
StandardError=journal
SyslogIdentifier=myservice

[Install]
WantedBy=multi-user.target
```

### 3.2 定时任务配置

#### /etc/crontab
```bash
# 系统级crontab
SHELL=/bin/bash
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

# 分 时 日 月 周 用户 命令
0 2 * * * root /usr/local/bin/backup.sh >/dev/null 2>&1
*/5 * * * * www-data /usr/local/bin/check.php
0 0 * * 0 root /usr/bin/apt update && /usr/bin/apt upgrade -y
```

#### /etc/cron.d/mytasks
```bash
# 自定义定时任务
# 每天凌晨3点清理日志
0 3 * * * root find /var/log -name "*.log" -mtime +30 -delete

# 每小时检查磁盘空间
0 * * * * root /usr/local/bin/disk-check.sh

# 每周备份数据库
0 1 * * 0 postgres /usr/local/bin/backup-db.sh
```

### 3.3 日志轮转配置

#### /etc/logrotate.d/myservice
```bash
# 自定义日志轮转
/var/log/myservice/*.log {
    daily
    missingok
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 myuser mygroup
    sharedscripts
    postrotate
        # 通知服务重新打开日志文件
        systemctl reload myservice || true
    endscript
}
```

#### /etc/logrotate.d/nginx
```bash
# Nginx日志轮转
/var/log/nginx/*.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 0640 www-data adm
    sharedscripts
    postrotate
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 `cat /var/run/nginx.pid`
        fi
    endscript
}
```

## 4 现代网络配置

### 4.1 Firewalld配置

#### /etc/firewalld/zones/public.xml
```xml
<?xml version="1.0" encoding="utf-8"?>
<zone target="default">
  <short>Public</short>
  <description>For use in public areas.</description>
  <service name="ssh"/>
  <service name="dhcpv6-client"/>
  <service name="http"/>
  <service name="https"/>
  <port protocol="tcp" port="8080"/>
  <port protocol="tcp" port="3306"/>
  <rule family="ipv4">
    <source address="192.168.1.0/24"/>
    <service name="mysql"/>
    <accept/>
  </rule>
</zone>
```

#### /etc/firewalld/direct.xml
```xml
<?xml version="1.0" encoding="utf-8"?>
<direct>
  <chain ipv="ipv4" table="filter" chain="INPUT"/>
  <rule ipv="ipv4" table="filter" chain="INPUT" priority="0">
    -s 192.168.1.0/24 -p tcp --dport 22 -j ACCEPT
  </rule>
  <rule ipv="ipv4" table="filter" chain="INPUT" priority="1">
    -p tcp --dport 22 -j DROP
  </rule>
</direct>
```

### 4.2 现代应用程序配置

#### /etc/php/7.4/apache2/php.ini
```ini
[PHP]
# 基本设置
engine = On
short_open_tag = Off
precision = 14
output_buffering = 4096
zlib.output_compression = Off
implicit_flush = Off
unserialize_callback_func =
serialize_precision = -1
disable_functions = exec,passthru,shell_exec,system
max_execution_time = 30
max_input_time = 60
memory_limit = 256M

# 文件上传
file_uploads = On
upload_tmp_dir = /tmp
upload_max_filesize = 64M
max_file_uploads = 20

# 会话设置
session.save_handler = files
session.save_path = "/var/lib/php/sessions"
session.use_cookies = 1
session.use_only_cookies = 1
session.name = PHPSESSID
session.auto_start = 0
session.cookie_lifetime = 0
session.cookie_httponly = 1

# 错误处理
display_errors = Off
display_startup_errors = Off
log_errors = On
error_log = /var/log/php/error.log
error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT
```

#### /etc/redis/redis.conf
```bash
# Redis配置文件
bind 127.0.0.1 ::1
port 6379
tcp-backlog 511
timeout 0
tcp-keepalive 300

# 通用
daemonize yes
supervised systemd
pidfile /var/run/redis/redis-server.pid
loglevel notice
logfile /var/log/redis/redis-server.log

# 持久化
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir /var/lib/redis

# 内存
maxmemory 256mb
maxmemory-policy allkeys-lru

# 安全
requirepass your-strong-password
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command CONFIG "CONFIG_b4dfe2a8a0"

# 慢查询日志
slowlog-log-slower-than 10000
slowlog-max-len 128
```

#### /etc/mongod.conf
```yaml
# MongoDB配置文件
storage:
  dbPath: /var/lib/mongodb
  journal:
    enabled: true
  engine: wiredTiger

systemLog:
  destination: file
  logAppend: true
  path: /var/log/mongodb/mongod.log

net:
  port: 27017
  bindIp: 127.0.0.1

processManagement:
  timeZoneInfo: /usr/share/zoneinfo

security:
  authorization: enabled

replication:
  replSetName: rs0

sharding:
  clusterRole: shardsvr
```

## 5 用户级配置文件

### 5.1 Shell配置

#### ~/.bashrc
```bash
# 用户bash配置
# 提示符
PS1='\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '

# 历史记录
HISTSIZE=10000
HISTFILESIZE=20000
HISTCONTROL=ignoredups:ignorespace
HISTTIMEFORMAT="%F %T "

# 别名
alias ll='ls -la'
alias la='ls -A'
alias l='ls -CF'
alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'

# 函数
mkcd() {
    mkdir -p "$1" && cd "$1"
}

extract() {
    if [ -f "$1" ]; then
        case "$1" in
            *.tar.bz2) tar -xjf "$1" ;;
            *.tar.gz) tar -xzf "$1" ;;
            *.bz2) bunzip2 "$1" ;;
            *.rar) unrar x "$1" ;;
            *.gz) gunzip "$1" ;;
            *.tar) tar -xf "$1" ;;
            *.tbz2) tar -xjf "$1" ;;
            *.tgz) tar -xzf "$1" ;;
            *.zip) unzip "$1" ;;
            *.Z) uncompress "$1" ;;
            *.7z) 7z x "$1" ;;
            *) echo "'${1}' cannot be extracted via extract()" ;;
        esac
    else
        echo "'${1}' is not a valid file"
    fi
}

# 路径
export PATH="$HOME/bin:$HOME/.local/bin:$PATH"
export EDITOR=nano
export VISUAL=nano

# 颜色
if [ -x /usr/bin/dircolors ]; then
    test -r ~/.dircolors && eval "$(dircolors -b ~/.dircolors)" || eval "$(dircolors -b)"
fi
```

#### ~/.bash_profile
```bash
# 登录shell配置
if [ -f ~/.bashrc ]; then
    source ~/.bashrc
fi

# SSH代理
if [ -z "$SSH_AUTH_SOCK" ]; then
    eval "$(ssh-agent -s)"
    ssh-add ~/.ssh/id_rsa
fi

# 路径设置
export PATH="$HOME/bin:$PATH"
export MANPATH="$HOME/man:$MANPATH"
```

### 5.2 开发工具配置

#### ~/.gitconfig
```ini
[user]
    name = Your Name
    email = your.email@example.com

[core]
    editor = nano
    autocrlf = input
    safecrlf = true

[color]
    ui = auto

[color "branch"]
    current = yellow reverse
    local = yellow
    remote = green

[color "diff"]
    meta = yellow bold
    frag = magenta bold
    old = red bold
    new = green bold

[color "status"]
    added = yellow
    changed = green
    untracked = cyan

[alias]
    st = status
    co = checkout
    br = branch
    ci = commit
    unstage = reset HEAD --
    last = log -1 HEAD
    visual = !gitk
    lg = log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit

[push]
    default = simple

[merge]
    tool = vimdiff
```

#### ~/.vimrc
```vim
" Vim配置文件
set nocompatible
filetype off

" 基本设置
set number
set ruler
set showcmd
set showmode
set showmatch
set incsearch
set hlsearch
set ignorecase
set smartcase
set autoindent
set smartindent
set cindent
set tabstop=4
set shiftwidth=4
set expandtab
set backspace=2
set textwidth=80
set wrap
set linebreak

" 文件设置
set encoding=utf-8
set fileencoding=utf-8
set fileencodings=utf-8,gb2312,gbk,gb18030
set fileformat=unix
set fileformats=unix,dos,mac

" 界面设置
set background=dark
syntax on
set laststatus=2
set statusline=%F%m%r%h%w\ [%Y\ %{&fileencoding}\ %{&fileformat}]\ [%l,%v]%p%%

" 快捷键
nnoremap <C-h> <C-w>h
nnoremap <C-j> <C-w>j
nnoremap <C-k> <C-w>k
nnoremap <C-l> <C-w>l

" 插件管理 (vim-plug)
if empty(glob('~/.vim/autoload/plug.vim'))
    silent !curl -fLo ~/.vim/autoload/plug.vim --create-dirs
        \ https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
    autocmd VimEnter * PlugInstall --sync | source $MYVIMRC
endif

call plug#begin('~/.vim/plugged')
Plug 'tpope/vim-sensible'
Plug 'junegunn/fzf', { 'do': { -> fzf#install() } }
Plug 'junegunn/fzf.vim'
Plug 'scrooloose/nerdtree'
Plug 'vim-airline/vim-airline'
Plug 'vim-airline/vim-airline-themes'
call plug#end()
```

#### ~/.tmux.conf
```bash
# Tmux配置文件
# 设置前缀键
set-option -g prefix C-a
unbind-key C-b
bind-key C-a send-prefix

# 基础设置
set-option -g default-shell /bin/bash
set-option -g history-limit 10000
set-option -g display-time 3000
set-option -g repeat-time 1000

# 鼠标支持
set-option -g mouse on

# 状态栏
set-option -g status-bg colour235
set-option -g status-fg colour250
set-option -g status-left-length 20
set-option -g status-left '#[fg=colour252,bg=colour235] #S #[fg=colour235,bg=colour252]'
set-option -g status-right '#[fg=colour252,bg=colour235] %H:%M #[fg=colour252,bg=colour235]'

# 窗口设置
set-option -g window-status-format '#[fg=colour252,bg=colour235] #I:#W '
set-option -g window-status-current-format '#[fg=colour235,bg=colour252] #I:#W '

# 面板设置
set-option -g pane-border-style fg=colour235
set-option -g pane-active-border-style fg=colour252

# 快捷键
bind-key r source-file ~/.tmux.conf \; display-message "Config reloaded!"
bind-key | split-window -h
bind-key - split-window -v
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# 快速窗口切换
bind-key -n C-h previous-window
bind-key -n C-l next-window
```

## 6 系统监控配置

### 6.1 Rsyslog配置

#### /etc/rsyslog.conf
```bash
# Rsyslog主配置文件
$ModLoad imuxsock # 本地系统日志
$ModLoad imjournal # 访问systemd日志
$WorkDirectory /var/lib/rsyslog
$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat

# 包含自定义配置
$IncludeConfig /etc/rsyslog.d/*.conf

# 日志权限
$FileOwner syslog
$FileGroup adm
$FileCreateMode 0640
$DirCreateMode 0755
$Umask 0022

# 本地日志
*.info;mail.none;authpriv.none;cron.none                /var/log/messages
authpriv.*                                              /var/log/secure
mail.*                                                  -/var/log/maillog
cron.*                                                  /var/log/cron
*.emerg                                                 :omusrmsg:*
uucp,news.crit                                          /var/log/spooler
local7.*                                                /var/log/boot.log

# Systemd日志
$IMJournalStateFile imjournal.state
```

#### /etc/rsyslog.d/50-default.conf
```bash
# 默认日志配置
# 应用程序日志
:programname, isequal, "nginx" /var/log/nginx/error.log
:programname, isequal, "mysql" /var/log/mysql/error.log

# 远程日志
$ModLoad imudp
$UDPServerRun 514
$UDPServerAddress 0.0.0.0

# 日志转发
*.* @remote.server:514
```

### 6.2 Logrotate配置

#### /etc/logrotate.conf
```bash
# 全局logrotate配置
weekly
rotate 52
create
dateext
compress
delaycompress
missingok
notifempty

# 包含子目录配置
include /etc/logrotate.d

# 系统日志
/var/log/wtmp {
    monthly
    create 0664 root utmp
    minsize 1M
    rotate 1
}

/var/log/btmp {
    missingok
    monthly
    create 0600 root utmp
    rotate 1
}
```

#### /etc/logrotate.d/syslog
```bash
# 系统日志轮转
/var/log/cron
/var/log/maillog
/var/log/messages
/var/log/secure
/var/log/spooler
{
    sharedscripts
    postrotate
        /bin/kill -HUP `cat /var/run/syslogd.pid 2> /dev/null` 2> /dev/null || true
    endscript
}
```

这个配置文件参考涵盖了从基础网络配置到现代应用程序配置的主要场景，可以作为系统配置的标准参考。