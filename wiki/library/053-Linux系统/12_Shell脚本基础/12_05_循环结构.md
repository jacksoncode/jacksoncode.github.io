# å¾ªç¯ç»“æ„

## 1 forå¾ªç¯è¯¦è§£

### 1.1 åŸºæœ¬forå¾ªç¯

#### 1.1.1 éå†åˆ—è¡¨

```bash
#!/bin/bash
# forå¾ªç¯éå†åˆ—è¡¨ç¤ºä¾‹

# éå†å­—ç¬¦ä¸²åˆ—è¡¨
for fruit in apple banana orange grape; do
    echo "æ°´æœï¼š$fruit"
done

# éå†æ•°ç»„
fruits=("è‹¹æœ" "é¦™è•‰" "æ©™å­" "è‘¡è„")
for fruit in "${fruits[@]}"; do
    echo "ä¸­æ–‡æ°´æœï¼š$fruit"
done

# éå†å‘½ä»¤è¾“å‡º
for user in $(cut -d: -f1 /etc/passwd); do
    echo "ç³»ç»Ÿç”¨æˆ·ï¼š$user"
done

# éå†æ–‡ä»¶åˆ—è¡¨
for file in *.txt; do
    if [ -f "$file" ]; then
        echo "æ–‡æœ¬æ–‡ä»¶ï¼š$file"
    fi
done
```

#### 1.1.2 èŒƒå›´éå†

```bash
#!/bin/bash
# èŒƒå›´éå†ç¤ºä¾‹

# éå†æ•°å­—èŒƒå›´
for i in {1..10}; do
    echo "æ•°å­—ï¼š$i"
done

# éå†å­—æ¯èŒƒå›´
for letter in {a..z}; do
    echo "å°å†™å­—æ¯ï¼š$letter"
done

# éå†å¸¦æ­¥é•¿çš„èŒƒå›´
for i in {1..10..2}; do
    echo "å¥‡æ•°ï¼š$i"
done

# éå†æ—¥æœŸèŒƒå›´
for day in {01..31}; do
    echo "2024-01-$day"
done
```

### 1.2 Cè¯­è¨€é£æ ¼forå¾ªç¯

#### 1.2.1 åŸºæœ¬è¯­æ³•

```bash
#!/bin/bash
# Cè¯­è¨€é£æ ¼forå¾ªç¯

# è®¡æ•°å¾ªç¯
for ((i=1; i<=5; i++)); do
    echo "è®¡æ•°ï¼š$i"
done

# é€’å‡å¾ªç¯
for ((i=10; i>=1; i--)); do
    echo "é€’å‡ï¼š$i"
done

# æ­¥é•¿ä¸ä¸º1çš„å¾ªç¯
for ((i=0; i<=20; i+=5)); do
    echo "5çš„å€æ•°ï¼š$i"
done

# å¤šä¸ªå˜é‡å¾ªç¯
for ((i=1, j=10; i<=5; i++, j--)); do
    echo "i=$i, j=$j"
done
```

#### 1.2.2 å¤æ‚å¾ªç¯

```bash
#!/bin/bash
# å¤æ‚forå¾ªç¯ç¤ºä¾‹

# å¤„ç†æ–‡ä»¶å†…å®¹
lines=($(cat /etc/passwd))
for ((i=0; i<${#lines[@]}; i++)); do
    username=$(echo "${lines[$i]}" | cut -d: -f1)
    shell=$(echo "${lines[$i]}" | cut -d: -f7)
    echo "ç”¨æˆ· $i: $username ä½¿ç”¨ $shell"
done

# å¤„ç†äºŒç»´æ•°ç»„
matrix=(
    "1 2 3"
    "4 5 6"
    "7 8 9"
)

for ((i=0; i<${#matrix[@]}; i++)); do
    row=(${matrix[$i]})
    for ((j=0; j<${#row[@]}; j++)); do
        echo "matrix[$i][$j] = ${row[$j]}"
    done
done
```

## 2 whileå¾ªç¯è¯¦è§£

### 2.1 åŸºæœ¬whileå¾ªç¯

#### 2.1.1 è®¡æ•°å¾ªç¯

```bash
#!/bin/bash
# whileå¾ªç¯è®¡æ•°ç¤ºä¾‹

counter=1
while [ $counter -le 5 ]; do
    echo "è®¡æ•°å™¨ï¼š$counter"
    ((counter++))
done

# æ— é™å¾ªç¯ï¼ˆéœ€è¦breakè¯­å¥ï¼‰
counter=0
while true; do
    if [ $counter -ge 5 ]; then
        break
    fi
    echo "æ— é™å¾ªç¯è®¡æ•°ï¼š$counter"
    ((counter++))
done

# æ¡ä»¶å¾ªç¯
read -p "è¯·è¾“å…¥å¯†ç ï¼š" password
attempts=0
max_attempts=3

while [ "$password" != "secret" ] && [ $attempts -lt $max_attempts ]; do
    echo "å¯†ç é”™è¯¯ï¼"
    attempts=$((attempts + 1))
    remaining=$((max_attempts - attempts))
    echo "å‰©ä½™å°è¯•æ¬¡æ•°ï¼š$remaining"
    
    if [ $attempts -lt $max_attempts ]; then
        read -p "è¯·é‡æ–°è¾“å…¥å¯†ç ï¼š" password
    fi
done

if [ "$password" = "secret" ]; then
    echo "ç™»å½•æˆåŠŸï¼"
else
    echo "ç™»å½•å¤±è´¥ï¼"
fi
```

#### 2.1.2 æ–‡ä»¶å¤„ç†å¾ªç¯

```bash
#!/bin/bash
# whileå¾ªç¯å¤„ç†æ–‡ä»¶ç¤ºä¾‹

# é€è¡Œè¯»å–æ–‡ä»¶
if [ -f "/etc/passwd" ]; then
    while IFS=: read -r username password uid gid gecos home shell; do
        echo "ç”¨æˆ·ï¼š$username"
        echo "  UIDï¼š$uid"
        echo "  ä¸»ç›®å½•ï¼š$home"
        echo "  Shellï¼š$shell"
        echo "---"
    done < "/etc/passwd"
fi

# å¤„ç†å‘½ä»¤è¾“å‡º
df -h | while read -r filesystem size used avail use_percent mount_point; do
    if [[ "$filesystem" == /dev/* ]]; then
        echo "ç£ç›˜ï¼š$filesystem"
        echo "  æ€»å¤§å°ï¼š$size"
        echo "  å·²ä½¿ç”¨ï¼š$used ($use_percent)"
        echo "  å¯ç”¨ï¼š$avail"
        echo "---"
    fi
done

# å¤„ç†ç”¨æˆ·è¾“å…¥
while read -p "è¯·è¾“å…¥å‘½ä»¤ï¼ˆè¾“å…¥quité€€å‡ºï¼‰ï¼š" command; do
    case "$command" in
        quit|exit|q)
            echo "å†è§ï¼"
            break
            ;;
        date)
            echo "å½“å‰æ—¶é—´ï¼š$(date)"
            ;;
        pwd)
            echo "å½“å‰ç›®å½•ï¼š$(pwd)"
            ;;
        ls)
            echo "å½“å‰ç›®å½•å†…å®¹ï¼š"
            ls -la
            ;;
        *)
            echo "æœªçŸ¥å‘½ä»¤ï¼š$command"
            ;;
    esac
done
```

### 2.2 é«˜çº§whileå¾ªç¯

#### 2.2.1 æ–‡ä»¶ç›‘æ§å¾ªç¯

```bash
#!/bin/bash
# æ–‡ä»¶ç›‘æ§å¾ªç¯ç¤ºä¾‹

logfile="/var/log/syslog"
pattern="error"

# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
if [ ! -f "$logfile" ]; then
    echo "æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨ï¼š$logfile"
    exit 1
fi

# è·å–åˆå§‹æ–‡ä»¶å¤§å°
last_size=$(stat -c%s "$logfile")

echo "å¼€å§‹ç›‘æ§æ—¥å¿—æ–‡ä»¶ï¼š$logfile"
echo "æŸ¥æ‰¾åŒ…å« '$pattern' çš„è¡Œ"
echo "æŒ‰ Ctrl+C é€€å‡º"

while true; do
    current_size=$(stat -c%s "$logfile")
    
    if [ "$current_size" -gt "$last_size" ]; then
        echo "å‘ç°æ–°æ—¥å¿—ï¼š"
        tail -c +$((last_size + 1)) "$logfile" | grep -i "$pattern" || true
        last_size=$current_size
    fi
    
    sleep 1
done
```

#### 2.2.2 ç½‘ç»œç›‘æ§å¾ªç¯

```bash
#!/bin/bash
# ç½‘ç»œç›‘æ§å¾ªç¯ç¤ºä¾‹

hosts=(
    "google.com"
    "github.com"
    "stackoverflow.com"
)

max_attempts=3
interval=5

echo "å¼€å§‹ç½‘ç»œç›‘æ§..."
echo "ç›‘æ§çš„ä¸»æœºï¼š${hosts[*]}"
echo "é—´éš”ï¼š${interval}ç§’"

while true; do
    timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    echo "[$timestamp] æ£€æŸ¥ç½‘ç»œçŠ¶æ€..."
    
    for host in "${hosts[@]}"; do
        if ping -c 1 "$host" > /dev/null 2>&1; then
            echo "  âœ… $host - åœ¨çº¿"
        else
            echo "  âŒ $host - ç¦»çº¿"
        fi
    done
    
    echo "---"
    sleep "$interval"
done
```

## 3 untilå¾ªç¯è¯¦è§£

### 3.1 åŸºæœ¬untilå¾ªç¯

```bash
#!/bin/bash
# untilå¾ªç¯ç¤ºä¾‹

# ç­‰å¾…æœåŠ¡å¯åŠ¨
service_name="nginx"
max_wait=30
counter=0

echo "ç­‰å¾… $service_name æœåŠ¡å¯åŠ¨..."

until systemctl is-active --quiet "$service_name"; do
    if [ $counter -ge $max_wait ]; then
        echo "ç­‰å¾…è¶…æ—¶ï¼Œ$service_name æœåŠ¡æœªå¯åŠ¨"
        exit 1
    fi
    
    echo "ç­‰å¾…ä¸­... ($counter/$max_wait)"
    ((counter++))
    sleep 1
done

echo "$service_name æœåŠ¡å·²å¯åŠ¨ï¼"

# ç­‰å¾…æ–‡ä»¶åˆ›å»º
file_path="/tmp/ready.txt"
max_wait=60
counter=0

echo "ç­‰å¾…æ–‡ä»¶åˆ›å»ºï¼š$file_path"

until [ -f "$file_path" ]; do
    if [ $counter -ge $max_wait ]; then
        echo "ç­‰å¾…è¶…æ—¶ï¼Œæ–‡ä»¶æœªåˆ›å»º"
        exit 1
    fi
    
    echo "ç­‰å¾…æ–‡ä»¶åˆ›å»º... ($counter/$max_wait)"
    ((counter++))
    sleep 1
done

echo "æ–‡ä»¶å·²åˆ›å»ºï¼š$file_path"
```

### 3.2 untilå¾ªç¯ä¸å‡½æ•°ç»“åˆ

```bash
#!/bin/bash
# untilå¾ªç¯ä¸å‡½æ•°ç»“åˆç¤ºä¾‹

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
check_db_connection() {
    local host="$1"
    local port="$2"
    local timeout=5
    
    if command -v nc > /dev/null; then
        nc -z "$host" "$port" -w "$timeout"
    elif command -v telnet > /dev/null; then
        timeout "$timeout" bash -c "</dev/tcp/$host/$port"
    else
        return 1
    fi
}

# ç­‰å¾…æ•°æ®åº“è¿æ¥
wait_for_db() {
    local host="${1:-localhost}"
    local port="${2:-3306}"
    local max_wait="${3:-60}"
    local counter=0
    
    echo "ç­‰å¾…æ•°æ®åº“è¿æ¥ $host:$port..."
    
    until check_db_connection "$host" "$port"; do
        if [ $counter -ge $max_wait ]; then
            echo "æ•°æ®åº“è¿æ¥è¶…æ—¶"
            return 1
        fi
        
        echo "ç­‰å¾…æ•°æ®åº“... ($counter/$max_wait)"
        ((counter++))
        sleep 1
    done
    
    echo "æ•°æ®åº“å·²è¿æ¥ï¼"
    return 0
}

# ä½¿ç”¨å‡½æ•°
wait_for_db "localhost" 3306 30
```

## 4 å¾ªç¯æ§åˆ¶è¯­å¥

### 4.1 breakè¯­å¥

```bash
#!/bin/bash
# breakè¯­å¥ç¤ºä¾‹

# åœ¨forå¾ªç¯ä¸­ä½¿ç”¨break
for i in {1..10}; do
    if [ $i -eq 5 ]; then
        echo "åœ¨$iå¤„ä¸­æ–­å¾ªç¯"
        break
    fi
    echo "æ•°å­—ï¼š$i"
done

# åœ¨whileå¾ªç¯ä¸­ä½¿ç”¨break
while true; do
    read -p "è¯·è¾“å…¥æ•°å­—ï¼ˆè¾“å…¥0é€€å‡ºï¼‰ï¼š" num
    
    if [ -z "$num" ]; then
        echo "è¾“å…¥ä¸èƒ½ä¸ºç©º"
        continue
    fi
    
    if ! [[ "$num" =~ ^[0-9]+$ ]]; then
        echo "è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—"
        continue
    fi
    
    if [ "$num" -eq 0 ]; then
        echo "é€€å‡ºç¨‹åº"
        break
    fi
    
    echo "ä½ è¾“å…¥äº†ï¼š$num"
done
```

### 4.2 continueè¯­å¥

```bash
#!/bin/bash
# continueè¯­å¥ç¤ºä¾‹

# è·³è¿‡å¶æ•°
for i in {1..10}; do
    if [ $((i % 2)) -eq 0 ]; then
        continue
    fi
    echo "å¥‡æ•°ï¼š$i"
done

# è·³è¿‡ç‰¹å®šæ–‡ä»¶
for file in *; do
    if [ -d "$file" ]; then
        echo "è·³è¿‡ç›®å½•ï¼š$file"
        continue
    fi
    
    if [[ "$file" == *.tmp ]]; then
        echo "è·³è¿‡ä¸´æ—¶æ–‡ä»¶ï¼š$file"
        continue
    fi
    
    echo "å¤„ç†æ–‡ä»¶ï¼š$file"
done
```

## 5 åµŒå¥—å¾ªç¯

### 5.1 äºŒç»´æ•°ç»„å¤„ç†

```bash
#!/bin/bash
# äºŒç»´æ•°ç»„å¤„ç†ç¤ºä¾‹

# å®šä¹‰äºŒç»´æ•°ç»„ï¼ˆä½¿ç”¨å­—ç¬¦ä¸²æ¨¡æ‹Ÿï¼‰
matrix=(
    "1 2 3 4 5"
    "6 7 8 9 10"
    "11 12 13 14 15"
    "16 17 18 19 20"
    "21 22 23 24 25"
)

echo "åŸå§‹çŸ©é˜µï¼š"
for row in "${matrix[@]}"; do
    echo "$row"
done

echo "çŸ©é˜µè½¬ç½®ï¼š"
# è·å–çŸ©é˜µç»´åº¦
rows=${#matrix[@]}
cols=$(echo "${matrix[0]}" | wc -w)

for ((j=0; j<cols; j++)); do
    for ((i=0; i<rows; i++)); do
        row=(${matrix[$i]})
        echo -n "${row[$j]} "
    done
    echo
done

# è®¡ç®—çŸ©é˜µå¯¹è§’çº¿ä¹‹å’Œ
diagonal_sum=0
for ((i=0; i<rows; i++)); do
    row=(${matrix[$i]})
    diagonal_sum=$((diagonal_sum + row[i]))
done

echo "å¯¹è§’çº¿ä¹‹å’Œï¼š$diagonal_sum"
```

### 5.2 æ–‡ä»¶ç›®å½•éå†

```bash
#!/bin/bash
# æ–‡ä»¶ç›®å½•éå†ç¤ºä¾‹

# é€’å½’éå†ç›®å½•
list_files_recursive() {
    local dir="$1"
    local indent="$2"
    
    if [ ! -d "$dir" ]; then
        return
    fi
    
    for item in "$dir"/*; do
        if [ -d "$item" ]; then
            echo "${indent}ğŸ“ $(basename "$item")"
            list_files_recursive "$item" "  $indent"
        elif [ -f "$item" ]; then
            echo "${indent}ğŸ“„ $(basename "$item")"
        fi
    done
}

# è®¡ç®—ç›®å½•å¤§å°
calculate_dir_size() {
    local dir="$1"
    local total_size=0
    
    for file in $(find "$dir" -type f 2>/dev/null); do
        if [ -f "$file" ]; then
            size=$(stat -c%s "$file" 2>/dev/null || echo 0)
            total_size=$((total_size + size))
        fi
    done
    
    echo "ç›®å½• $dir çš„æ€»å¤§å°ï¼š$total_size å­—èŠ‚"
}

# ä½¿ç”¨å‡½æ•°
echo "ç›®å½•ç»“æ„ï¼š"
list_files_recursive "." ""

echo
calculate_dir_size "."
```

## 6 å¾ªç¯æ€§èƒ½ä¼˜åŒ–

### 6.1 æ‰¹é‡å¤„ç†

```bash
#!/bin/bash
# æ‰¹é‡å¤„ç†ä¼˜åŒ–ç¤ºä¾‹

# ä½æ•ˆï¼šé€ä¸ªå¤„ç†æ–‡ä»¶
process_files_slow() {
    for file in *.log; do
        if [ -f "$file" ]; then
            # å¤„ç†æ¯ä¸ªæ–‡ä»¶
            grep "ERROR" "$file" > "${file}.errors"
        fi
    done
}

# é«˜æ•ˆï¼šä½¿ç”¨findå’Œxargs
process_files_fast() {
    find . -name "*.log" -type f -print0 | xargs -0 grep -l "ERROR" | while read -r file; do
        grep "ERROR" "$file" > "${file}.errors"
    done
}

# ä½¿ç”¨å¹¶è¡Œå¤„ç†
process_files_parallel() {
    find . -name "*.log" -type f | parallel 'grep "ERROR" {} > {}.errors'
}
```

### 6.2 ç¼“å­˜ç»“æœ

```bash
#!/bin/bash
# ç¼“å­˜ç»“æœä¼˜åŒ–

# ç¼“å­˜å‘½ä»¤è¾“å‡º
cache_command_output() {
    local cache_file="/tmp/system_info.cache"
    local cache_timeout=300  # 5åˆ†é’Ÿ
    
    if [ -f "$cache_file" ]; then
        local file_age=$(($(date +%s) - $(stat -c%Y "$cache_file")))
        if [ $file_age -lt $cache_timeout ]; then
            cat "$cache_file"
            return
        fi
    fi
    
    # é‡æ–°è·å–æ•°æ®å¹¶ç¼“å­˜
    {
        echo "=== ç³»ç»Ÿä¿¡æ¯ ==="
        echo "æ—¶é—´ï¼š$(date)"
        echo "ç”¨æˆ·ï¼š$(whoami)"
        echo "ä¸»æœºï¼š$(hostname)"
        echo "è´Ÿè½½ï¼š$(uptime | awk -F'load average:' '{print $2}')"
    } > "$cache_file"
    
    cat "$cache_file"
}

cache_command_output
```

## 7 å®æˆ˜æ¡ˆä¾‹ï¼šæ—¥å¿—åˆ†æè„šæœ¬

```bash
#!/bin/bash
# æ—¥å¿—åˆ†æå¾ªç¯è„šæœ¬

# é…ç½®
LOG_FILE="/var/log/syslog"
REPORT_DIR="./reports"
DATE=$(date +%Y%m%d)

# åˆ›å»ºæŠ¥å‘Šç›®å½•
mkdir -p "$REPORT_DIR"

# åˆ†æå‡½æ•°
analyze_logs() {
    local logfile="$1"
    local report="$2"
    
    echo "=== æ—¥å¿—åˆ†ææŠ¥å‘Š ===" > "$report"
    echo "æ–‡ä»¶ï¼š$logfile" >> "$report"
    echo "æ—¶é—´ï¼š$(date)" >> "$report"
    echo "" >> "$report"
    
    # ç»Ÿè®¡é”™è¯¯çº§åˆ«
    echo "é”™è¯¯çº§åˆ«ç»Ÿè®¡ï¼š" >> "$report"
    grep -E "(ERROR|CRITICAL|FATAL)" "$logfile" | awk '{print $5}' | sort | uniq -c | sort -nr | while read count level; do
        echo "  $level: $count æ¬¡" >> "$report"
    done
    
    # ç»Ÿè®¡IPåœ°å€
    echo "" >> "$report"
    echo "IPåœ°å€ç»Ÿè®¡ï¼š" >> "$report"
    grep -oE '\b([0-9]{1,3}\.){3}[0-9]{1,3}\b' "$logfile" | sort | uniq -c | sort -nr | head -10 | while read count ip; do
        echo "  $ip: $count æ¬¡" >> "$report"
    done
    
    # ç»Ÿè®¡æ—¶é—´æ®µ
    echo "" >> "$report"
    echo "æ—¶é—´æ®µç»Ÿè®¡ï¼š" >> "$report"
    awk '{print $1, $2}' "$logfile" | cut -d: -f1,2 | sort | uniq -c | sort -nr | head -10 | while read count time; do
        echo "  $time: $count æ¡æ—¥å¿—" >> "$report"
    done
}

# ä¸»ç¨‹åº
if [ -f "$LOG_FILE" ]; then
    report_file="$REPORT_DIR/log_analysis_$DATE.txt"
    analyze_logs "$LOG_FILE" "$report_file"
    echo "æŠ¥å‘Šå·²ç”Ÿæˆï¼š$report_file"
else
    echo "æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨ï¼š$LOG_FILE"
fi