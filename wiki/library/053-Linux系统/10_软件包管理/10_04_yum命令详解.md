# 10.4 yum命令详解

## 1. 命令概述

yum（Yellowdog Updater Modified）是Red Hat Enterprise Linux、CentOS、Fedora等基于RPM的Linux发行版中的包管理工具。它基于RPM包管理系统，提供了一套完整的命令行接口，用于软件包的安装、更新、升级和删除等操作，并能够自动处理依赖关系。

### 1.1 功能特点
- 提供统一的命令行接口，简化软件包管理操作
- 自动处理软件包的依赖关系
- 支持从多个软件源获取软件包
- 提供软件包搜索和信息查询功能
- 支持软件组的管理
- 支持事务处理，可以回滚操作
- 提供缓存管理功能

### 1.2 应用场景
- 安装新的软件包及其依赖
- 更新系统中的软件包
- 升级系统中的所有软件包
- 删除不需要的软件包
- 搜索软件包和查询软件包信息
- 管理软件源和仓库配置
- 系统维护和软件管理

## 2. 语法格式

yum命令的基本语法格式如下：

```bash
# 基本语法
$ sudo yum [选项] 命令 [软件包...]
```

### 2.1 语法说明
- **sudo**：大多数yum命令需要管理员权限，因此通常需要使用sudo
- **yum**：命令名称
- **选项**：可选参数，用于定制命令行为
- **命令**：指定要执行的操作，如install、update、remove等
- **软件包**：可选参数，指定要操作的软件包名称

## 3. 常用选项

yum命令提供了多个选项来定制其行为。以下是一些常用的选项：

### 3.1 选项列表

| 选项 | 功能说明 |
|------|----------|
| `-h`, `--help` | 显示帮助信息 |
| `-y`, `--assumeyes` | 自动回答"yes"，用于非交互式操作 |
| `-q`, `--quiet` | 减少输出信息 |
| `-v`, `--verbose` | 增加输出信息的详细程度 |
| `-C`, `--cacheonly` | 只使用缓存，不更新缓存 |
| `--disablerepo=REPO` | 禁用指定的软件源 |
| `--enablerepo=REPO` | 启用指定的软件源 |
| `--nogpgcheck` | 跳过GPG签名检查 |
| `--skip-broken` | 跳过有依赖问题的软件包 |
| `--showduplicates` | 显示重复的软件包 |

## 4. 常用命令

yum命令提供了多个子命令来执行不同的操作。以下是一些常用的子命令：

### 4.1 软件包安装

**install命令**：安装新的软件包及其依赖

```bash
# 安装单个软件包
$ sudo yum install package_name

# 安装多个软件包
$ sudo yum install package1 package2 package3

# 自动回答yes进行安装
$ sudo yum install -y package_name

# 安装特定版本的软件包
$ sudo yum install package_name-version
```

### 4.2 软件包更新

**update命令**：更新软件包或升级系统

```bash
# 更新特定的软件包
$ sudo yum update package_name

# 升级所有软件包
$ sudo yum update

# 自动回答yes进行升级
$ sudo yum update -y
```

**upgrade命令**：与update类似，但会删除过时的软件包

```bash
# 升级系统
$ sudo yum upgrade
```

### 4.3 软件包删除

**remove命令**：删除软件包，但保留配置文件

```bash
# 删除软件包
$ sudo yum remove package_name

# 删除多个软件包
$ sudo yum remove package1 package2
```

**erase命令**：与remove相同，删除软件包

```bash
# 删除软件包
$ sudo yum erase package_name
```

### 4.4 软件包查询

**search命令**：搜索软件包

```bash
# 搜索软件包
$ yum search keyword
```

**info命令**：显示软件包的详细信息

```bash
# 显示软件包信息
$ yum info package_name
```

**list命令**：列出软件包

```bash
# 列出所有已安装和可用的软件包
$ yum list

# 列出已安装的软件包
$ yum list installed

# 列出可用的软件包
$ yum list available

# 列出匹配特定模式的软件包
$ yum list "*pattern*"
```

### 4.5 依赖关系处理

**provides命令**：查找提供特定文件或功能的软件包

```bash
# 查找提供特定命令的软件包
$ yum provides /usr/bin/command_name

# 查找提供特定文件的软件包
$ yum provides filename
```

**clean命令**：清理yum缓存

```bash
# 清理所有缓存
$ sudo yum clean all

# 清理过期的缓存
$ sudo yum clean expire-cache

# 清理软件包缓存
$ sudo yum clean packages
```

### 4.6 软件组管理

**groupinstall命令**：安装软件组

```bash
# 安装软件组
$ sudo yum groupinstall "Group Name"
```

**groupupdate命令**：更新软件组

```bash
# 更新软件组
$ sudo yum groupupdate "Group Name"
```

**grouplist命令**：列出所有可用的软件组

```bash
# 列出所有软件组
$ yum grouplist

# 列出已安装的软件组
$ yum grouplist installed

# 列出可用的软件组
$ yum grouplist available
```

## 5. 常用示例

### 5.1 系统更新和升级

更新软件包并升级系统：

```bash
# 清理yum缓存
$ sudo yum clean all

# 更新软件包列表
$ sudo yum check-update

# 升级所有软件包
$ sudo yum update -y

# 升级系统，删除过时的软件包
$ sudo yum upgrade -y
```

### 5.2 安装常用软件包

安装Web服务器、数据库和开发工具：

```bash
# 安装Apache Web服务器
$ sudo yum install -y httpd

# 安装MySQL数据库
$ sudo yum install -y mysql-server

# 安装PHP
$ sudo yum install -y php php-mysql

# 安装开发工具组
$ sudo yum groupinstall -y "Development Tools"

# 安装编译器
$ sudo yum install -y gcc gcc-c++
```

### 5.3 搜索和安装特定软件

搜索并安装特定的软件包：

```bash
# 搜索文本编辑器
$ yum search editor

# 查看vim软件包的详细信息
$ yum info vim-enhanced

# 安装vim编辑器
$ sudo yum install -y vim-enhanced
```

### 5.4 解决依赖问题

修复系统中的依赖问题：

```bash
# 检查系统中的依赖问题
$ sudo yum check

# 尝试解决依赖问题
$ sudo yum install -y --skip-broken

# 查找并安装提供特定功能的软件包
$ yum provides "*/bin/make"
$ sudo yum install -y make
```

### 5.5 使用特定的软件源

启用或禁用特定的软件源来安装软件包：

```bash
# 列出所有可用的软件源
$ yum repolist all

# 启用特定的软件源
$ sudo yum --enablerepo=epel install package_name

# 禁用特定的软件源
$ sudo yum --disablerepo=base,updates install package_name

# 同时启用和禁用多个软件源
$ sudo yum --enablerepo=epel --disablerepo=base install package_name
```

### 5.6 使用yum历史记录

查看和管理yum操作历史记录：

```bash
# 查看yum操作历史记录
$ sudo yum history

# 查看特定历史事务的详细信息
$ sudo yum history info 10

# 撤销特定的历史事务
$ sudo yum history undo 10

# 重做特定的历史事务
$ sudo yum history redo 10
```

## 6. 高级用法

### 6.1 配置yum源

yum的软件源配置文件位于`/etc/yum.repos.d/`目录下，可以通过编辑这些文件来配置软件源。

```bash
# 查看当前的软件源配置
$ ls /etc/yum.repos.d/

# 编辑软件源配置文件
$ sudo vim /etc/yum.repos.d/centos-base.repo

# 添加第三方软件源（以EPEL为例）
$ sudo yum install -y epel-release
```

### 6.2 创建本地yum仓库

在局域网环境中，可以创建本地yum仓库，方便多台机器共享软件包。

```bash
# 安装createrepo工具
$ sudo yum install -y createrepo

# 创建仓库目录
$ sudo mkdir -p /var/www/html/repo

# 复制RPM包到仓库目录
$ sudo cp /path/to/rpms/*.rpm /var/www/html/repo/

# 初始化仓库
$ sudo createrepo /var/www/html/repo/

# 创建仓库配置文件
$ sudo vim /etc/yum.repos.d/local.repo
[local]
name=Local Repository
baseurl=http://localhost/repo
enabled=1
gpgcheck=0

# 清理yum缓存并更新
$ sudo yum clean all
$ sudo yum makecache
```

### 6.3 使用yum插件

yum支持插件机制，可以通过安装和配置插件来增强其功能。

```bash
# 查看已安装的yum插件
$ yum pluginlist

# 安装yum插件
$ sudo yum install -y yum-plugin-fastestmirror yum-plugin-security

# 配置yum插件
$ sudo vim /etc/yum/pluginconf.d/fastestmirror.conf
```

### 6.4 配置yum缓存和日志

可以配置yum的缓存行为和日志记录方式：

```bash
# 查看当前的yum配置
$ cat /etc/yum.conf

# 编辑yum主配置文件
$ sudo vim /etc/yum.conf

# 示例配置：增加缓存目录大小和保留时间
[main]
cachedir=/var/cache/yum/$basearch/$releasever
keepcache=1
debuglevel=2
logfile=/var/log/yum.log
exactarch=1
obsoletes=1
gpgcheck=1
plugins=1
device=cdrom
```

### 6.5 使用yum进行系统备份

结合其他工具，可以使用yum进行系统软件包的备份和恢复：

```bash
# 备份已安装的软件包列表
$ sudo yum list installed > installed_packages.txt

# 在新系统上恢复软件包
$ cat installed_packages.txt | grep -v "^\+" | awk '{print $1}' | sudo xargs yum install -y
```

## 7. 常见问题与解决方案

### 7.1 依赖关系问题

**问题**：安装软件包时出现依赖错误，无法继续安装。

**解决方案**：
1. 尝试使用`--skip-broken`选项跳过有依赖问题的软件包：`sudo yum install -y --skip-broken package_name`
2. 清理yum缓存：`sudo yum clean all`
3. 检查软件源是否正常：`sudo yum repolist`
4. 尝试启用额外的软件源：`sudo yum --enablerepo=epel install package_name`

### 7.2 软件源错误

**问题**：更新或安装软件包时出现软件源错误。

**解决方案**：
1. 检查网络连接是否正常
2. 检查软件源配置文件是否正确：`sudo vim /etc/yum.repos.d/*.repo`
3. 尝试禁用有问题的软件源：`sudo yum --disablerepo=problematic-repo update`
4. 清理并重建yum缓存：`sudo yum clean all && sudo yum makecache`

### 7.3 GPG签名验证失败

**问题**：安装软件包时出现GPG签名验证失败的错误。

**解决方案**：
1. 安装软件包的GPG密钥：`sudo rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7`
2. 暂时跳过GPG检查（不推荐）：`sudo yum install -y --nogpgcheck package_name`
3. 检查软件源的GPG配置是否正确

### 7.4 事务锁定

**问题**：执行yum命令时出现"Another app is currently holding the yum lock"错误。

**解决方案**：
1. 检查是否有其他yum进程正在运行：`ps aux | grep -i yum`
2. 如果有，可以等待其完成或使用kill命令终止：`sudo kill -9 PID`
3. 强制释放yum锁：`sudo rm -f /var/run/yum.pid`

### 7.5 无法找到软件包

**问题**：执行`yum install`命令时无法找到指定的软件包。

**解决方案**：
1. 确保软件包名称正确
2. 检查是否启用了包含该软件包的软件源：`sudo yum repolist`
3. 尝试搜索软件包的准确名称：`yum search keyword`
4. 添加包含该软件包的第三方软件源

## 8. 总结与注意事项

### 8.1 总结

yum命令是Red Hat、CentOS、Fedora等Linux发行版中强大的软件包管理工具，它基于RPM包管理系统，提供了一套完整的命令行接口，用于软件包的安装、更新、升级和删除等操作。yum能够自动处理依赖关系，支持软件组管理和事务处理，是系统维护和软件管理的重要工具。

### 8.2 注意事项

- 大多数yum命令需要管理员权限，因此通常需要使用sudo
- 在执行系统升级前，建议先备份重要数据
- 定期清理yum缓存可以释放磁盘空间：`sudo yum clean all`
- 使用`yum history`命令可以查看和管理yum操作历史，方便回滚操作
- 修改软件源配置后，需要执行`yum makecache`命令重建缓存
- 对于重要的系统软件包，删除前请确认其功能和依赖关系，避免影响系统正常运行
- 在CentOS 8及更高版本中，dnf命令已经取代了yum命令，成为默认的包管理工具，但yum命令仍然作为dnf的别名存在