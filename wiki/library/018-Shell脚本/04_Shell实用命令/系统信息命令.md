# 系统信息命令

## 系统信息概述

了解系统信息对于系统管理、故障排查和性能优化至关重要。Linux/Unix系统提供了丰富的命令来获取各种系统信息，包括硬件信息、操作系统信息、网络配置、用户信息等。掌握这些命令可以帮助你更好地理解和管理系统。

## 系统基本信息

### uname命令

uname命令用于显示系统信息。

```bash
#!/bin/bash

echo "=== uname命令示例 ==="

echo "显示所有系统信息:"
uname -a

echo -e "\n显示内核名称:"
uname -s

echo -e "\n显示网络节点主机名:"
uname -n

echo -e "\n显示内核版本:"
uname -r

echo -e "\n显示机器硬件名称:"
uname -m

echo -e "\n显示处理器类型:"
uname -p

echo -e "\n显示硬件平台:"
uname -i

echo -e "\n显示操作系统:"
uname -o
```

### hostname命令

hostname命令用于显示或设置系统的主机名。

```bash
#!/bin/bash

echo "=== hostname命令示例 ==="

echo "显示当前主机名:"
hostname

echo -e "\n显示完整主机名:"
hostname -f

echo -e "\n显示域名:"
hostname -d

echo -e "\n显示IP地址:"
hostname -i

echo -e "\n显示别名:"
hostname -a
```

### whoami和id命令

whoami和id命令用于显示用户身份信息。

```bash
#!/bin/bash

echo "=== whoami和id命令示例 ==="

echo "显示当前用户名:"
whoami

echo -e "\n显示用户和组信息:"
id

echo -e "\n显示特定用户信息:"
id $USER

echo -e "\n只显示用户ID:"
id -u

echo -e "\n只显示组ID:"
id -g

echo -e "\n显示所有组ID:"
id -G

echo -e "\n显示用户名:"
id -un
```

## 硬件信息

### lscpu命令

lscpu命令显示CPU架构信息。

```bash
#!/bin/bash

echo "=== lscpu命令示例 ==="

echo "显示CPU架构信息:"
lscpu

echo -e "\n以易读格式显示:"
lscpu --pretty

echo -e "\n以JSON格式显示:"
lscpu --json
```

### lsmem命令

lsmem命令显示内存布局信息。

```bash
#!/bin/bash

echo "=== lsmem命令示例 ==="

echo "显示内存布局:"
lsmem

echo -e "\n以易读格式显示:"
lsmem -h

echo -e "\n显示在线内存块:"
lsmem --online
```

### lsblk命令

lsblk命令列出块设备信息。

```bash
#!/bin/bash

echo "=== lsblk命令示例 ==="

echo "列出块设备:"
lsblk

echo -e "\n显示所有设备:"
lsblk -a

echo -e "\n显示文件系统信息:"
lsblk -f

echo -e "\n以树状结构显示:"
lsblk -t

echo -e "\n显示设备大小:"
lsblk -s

echo -e "\n显示设备所有者:"
lsblk -m
```

### lspci命令

lspci命令列出PCI设备信息。

```bash
#!/bin/bash

echo "=== lspci命令示例 ==="

echo "列出PCI设备:"
lspci

echo -e "\n显示详细信息:"
lspci -v

echo -e "\n显示更详细信息:"
lspci -vv

echo -e "\n以树状结构显示:"
lspci -t

echo -e "\n显示数字形式的ID:"
lspci -n
```

### lsusb命令

lsusb命令列出USB设备信息。

```bash
#!/bin/bash

echo "=== lsusb命令示例 ==="

echo "列出USB设备:"
lsusb

echo -e "\n显示详细信息:"
lsusb -v

echo -e "\n显示特定设备详细信息:"
# lsusb -d vendor:product

echo -e "\n以树状结构显示:"
lsusb -t
```

## 操作系统信息

### cat /etc/*-release

查看操作系统的发行版信息。

```bash
#!/bin/bash

echo "=== 操作系统信息示例 ==="

echo "查看发行版信息:"
if [ -f /etc/os-release ]
then
    cat /etc/os-release
elif [ -f /etc/redhat-release ]
then
    cat /etc/redhat-release
elif [ -f /etc/debian_version ]
then
    echo "Debian version: $(cat /etc/debian_version)"
elif [ -f /etc/lsb-release ]
then
    cat /etc/lsb-release
fi
```

### uptime命令

uptime命令显示系统运行时间和负载信息。

```bash
#!/bin/bash

echo "=== uptime命令示例 ==="

echo "显示系统运行时间:"
uptime

echo -e "\n显示详细信息:"
uptime -p

echo -e "\n显示统计信息:"
uptime -s
```

## 内存信息

### free命令

free命令显示内存使用情况。

```bash
#!/bin/bash

echo "=== free命令示例 ==="

echo "显示内存使用情况:"
free

echo -e "\n以人类可读格式显示:"
free -h

echo -e "\n显示总计行:"
free -t

echo -e "\n持续监控:"
echo "free -s 3  # 每3秒更新一次"

echo -e "\n显示低层级和高层级内存统计:"
free -l
```

### vmstat命令

vmstat命令报告虚拟内存统计信息。

```bash
#!/bin/bash

echo "=== vmstat命令示例 ==="

echo "显示虚拟内存统计:"
vmstat

echo -e "\n指定间隔和次数:"
echo "vmstat 2 5  # 每2秒显示一次，共5次"

echo -e "\n显示详细统计:"
vmstat -s

echo -e "\n显示磁盘统计:"
vmstat -d

echo -e "\n显示分区统计:"
vmstat -p device
```

## 磁盘信息

### df命令

df命令显示文件系统磁盘空间使用情况。

```bash
#!/bin/bash

echo "=== df命令示例 ==="

echo "显示磁盘空间使用情况:"
df

echo -e "\n以人类可读格式显示:"
df -h

echo -e "\n显示inode使用情况:"
df -i

echo -e "\n显示特定文件系统:"
df -h /

echo -e "\n显示所有文件系统:"
df -a

echo -e "\n显示文件系统类型:"
df -T
```

### du命令

du命令显示目录或文件的磁盘使用情况。

```bash
#!/bin/bash

echo "=== du命令示例 ==="

echo "显示当前目录磁盘使用情况:"
du

echo -e "\n以人类可读格式显示:"
du -h

echo -e "\n显示总计:"
du -h --total

echo -e "\n显示指定目录:"
du -h /etc

echo -e "\n显示前10个最大的目录:"
du -h /var | sort -hr | head -10

echo -e "\n显示目录深度:"
du -h --max-depth=1

echo -e "\n排除特定文件类型:"
du -h --exclude="*.log" .
```

## 网络信息

### ip命令

ip命令用于显示和操作路由、网络设备、接口和隧道。

```bash
#!/bin/bash

echo "=== ip命令示例 ==="

echo "显示网络接口:"
ip addr show

echo -e "\n显示路由表:"
ip route show

echo -e "\n显示网络统计:"
ip -s link

echo -e "\n显示邻居表:"
ip neigh show

echo -e "\n显示网络规则:"
ip rule show
```

### ifconfig命令

ifconfig命令配置和显示网络接口参数（在一些新系统中已被ip命令取代）。

```bash
#!/bin/bash

echo "=== ifconfig命令示例 ==="

echo "显示所有网络接口:"
ifconfig

echo -e "\n显示特定接口:"
ifconfig eth0

echo -e "\n启用网络接口:"
# ifconfig eth0 up

echo -e "\n禁用网络接口:"
# ifconfig eth0 down
```

### netstat命令

netstat命令显示网络连接、监听端口、路由表等信息。

```bash
#!/bin/bash

echo "=== netstat命令示例 ==="

echo "显示所有连接:"
netstat -a

echo -e "\n显示TCP连接:"
netstat -t

echo -e "\n显示UDP连接:"
netstat -u

echo -e "\n显示监听端口:"
netstat -l

echo -e "\n显示进程ID:"
netstat -p

echo -e "\n显示统计信息:"
netstat -s

echo -e "\n显示路由表:"
netstat -r
```

### ss命令

ss命令是netstat的现代替代品，用于调查套接字。

```bash
#!/bin/bash

echo "=== ss命令示例 ==="

echo "显示所有套接字:"
ss

echo -e "\n显示TCP套接字:"
ss -t

echo -e "\n显示UDP套接字:"
ss -u

echo -e "\n显示监听套接字:"
ss -l

echo -e "\n显示进程信息:"
ss -p

echo -e "\n显示所有TCP监听端口:"
ss -t -l

echo -e "\n显示所有UDP监听端口:"
ss -u -l
```

## 用户和组信息

### who命令

who命令显示当前登录的用户。

```bash
#!/bin/bash

echo "=== who命令示例 ==="

echo "显示当前登录用户:"
who

echo -e "\n显示详细信息:"
who -a

echo -e "\n显示运行级别:"
who -r

echo -e "\n显示上次系统启动时间:"
who -b
```

### w命令

w命令显示当前登录用户及其正在执行的命令。

```bash
#!/bin/bash

echo "=== w命令示例 ==="

echo "显示登录用户和进程:"
w

echo -e "\n不显示头部信息:"
w -h

echo -e "\n显示空闲时间和JCPU时间:"
w -s
```

### last命令

last命令显示最近登录的用户列表。

```bash
#!/bin/bash

echo "=== last命令示例 ==="

echo "显示最近登录用户:"
last

echo -e "\n显示最近10条记录:"
last -n 10

echo -e "\n显示特定用户的登录记录:"
# last username

echo -e "\n显示系统关机和重启记录:"
last reboot shutdown
```

## 环境变量

### env和printenv命令

env和printenv命令用于显示环境变量。

```bash
#!/bin/bash

echo "=== env和printenv命令示例 ==="

echo "显示所有环境变量:"
env

echo -e "\n显示特定环境变量:"
printenv PATH

echo -e "\n显示多个环境变量:"
printenv HOME USER SHELL

echo -e "\n在修改环境的情况下运行命令:"
env TEST_VAR="test" bash -c 'echo $TEST_VAR'
```

## 实际应用示例

### 系统信息收集脚本

```bash
#!/bin/bash

# 系统信息收集脚本
collect_system_info() {
    local output_file=${1:-"system_info_$(date +%Y%m%d_%H%M%S).txt"}
    
    echo "=== 系统信息报告 ===" > "$output_file"
    echo "生成时间: $(date)" >> "$output_file"
    echo "================================" >> "$output_file"
    
    # 基本系统信息
    {
        echo "1. 基本系统信息"
        echo "----------------"
        echo "主机名: $(hostname)"
        echo "内核版本: $(uname -r)"
        echo "操作系统: $(uname -o)"
        echo "架构: $(uname -m)"
        if [ -f /etc/os-release ]
        then
            echo "发行版: $(grep PRETTY_NAME /etc/os-release | cut -d'"' -f2)"
        fi
        echo "运行时间: $(uptime -p)"
        echo "系统启动时间: $(uptime -s)"
        echo ""
    } >> "$output_file"
    
    # CPU信息
    {
        echo "2. CPU信息"
        echo "-----------"
        lscpu | grep -E "(Architecture|CPU\(s\)|Model name|CPU MHz|Load average)"
        echo ""
    } >> "$output_file"
    
    # 内存信息
    {
        echo "3. 内存信息"
        echo "------------"
        free -h
        echo ""
    } >> "$output_file"
    
    # 磁盘信息
    {
        echo "4. 磁盘信息"
        echo "------------"
        df -h
        echo ""
    } >> "$output_file"
    
    # 网络信息
    {
        echo "5. 网络信息"
        echo "------------"
        echo "网络接口:"
        ip addr show | grep -E "(^[0-9]|inet )"
        echo ""
        echo "默认路由:"
        ip route show default
        echo ""
    } >> "$output_file"
    
    # 用户信息
    {
        echo "6. 当前登录用户"
        echo "----------------"
        who
        echo ""
    } >> "$output_file"
    
    # 顶级进程
    {
        echo "7. CPU使用率最高的进程"
        echo "------------------------"
        ps aux --sort=-%cpu | head -11
        echo ""
    } >> "$output_file"
    
    echo "系统信息已保存到: $output_file"
}

# 运行系统信息收集
# collect_system_info
```

### 系统健康检查脚本

```bash
#!/bin/bash

# 系统健康检查脚本
system_health_check() {
    echo "=== 系统健康检查报告 ==="
    echo "检查时间: $(date)"
    echo "========================"
    
    # CPU使用率检查
    echo "1. CPU使用率检查"
    echo "----------------"
    local cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
    echo "当前CPU使用率: ${cpu_usage}%"
    if (( $(echo "$cpu_usage > 80" | bc -l) ))
    then
        echo "⚠️  警告: CPU使用率过高"
    else
        echo "✅ CPU使用率正常"
    fi
    echo ""
    
    # 内存使用率检查
    echo "2. 内存使用率检查"
    echo "------------------"
    local memory_usage=$(free | grep Mem | awk '{printf("%.0f", $3/$2 * 100.0)}')
    echo "当前内存使用率: ${memory_usage}%"
    free -h
    if [ $memory_usage -gt 80 ]
    then
        echo "⚠️  警告: 内存使用率过高"
    else
        echo "✅ 内存使用率正常"
    fi
    echo ""
    
    # 磁盘使用率检查
    echo "3. 磁盘使用率检查"
    echo "------------------"
    df -h | head -1
    df -h | tail -n +2 | while read line
    do
        echo "$line"
        local usage=$(echo "$line" | awk '{print $5}' | sed 's/%//')
        local filesystem=$(echo "$line" | awk '{print $1}')
        if [ $usage -gt 80 ]
        then
            echo "⚠️  警告: 文件系统 $filesystem 使用率过高 (${usage}%)"
        fi
    done
    echo ""
    
    # 系统负载检查
    echo "4. 系统负载检查"
    echo "----------------"
    local load_avg=$(uptime | awk -F'load average:' '{print $2}')
    echo "系统负载: $load_avg"
    local one_min_load=$(echo $load_avg | awk '{print $1}' | sed 's/,//')
    local cpu_cores=$(nproc)
    if (( $(echo "$one_min_load > $cpu_cores" | bc -l) ))
    then
        echo "⚠️  警告: 系统负载过高"
    else
        echo "✅ 系统负载正常"
    fi
    echo ""
    
    # 检查关键服务
    echo "5. 关键服务检查"
    echo "----------------"
    local services=("sshd" "cron")
    for service in "${services[@]}"
    do
        if pgrep "$service" > /dev/null
        then
            echo "✅ $service 服务运行正常"
        else
            echo "❌ $service 服务未运行"
        fi
    done
    echo ""
    
    echo "系统健康检查完成"
}

# 运行健康检查
# system_health_check
```

### 硬件信息详细报告脚本

```bash
#!/bin/bash

# 硬件信息详细报告脚本
hardware_report() {
    local report_file="hardware_report_$(date +%Y%m%d_%H%M%S).txt"
    
    echo "=== 硬件信息详细报告 ===" > "$report_file"
    echo "生成时间: $(date)" >> "$report_file"
    echo "========================" >> "$report_file"
    
    # CPU详细信息
    {
        echo "CPU详细信息"
        echo "============"
        if command -v lscpu &> /dev/null
        then
            lscpu
        else
            echo "lscpu 命令不可用"
        fi
        echo ""
    } >> "$report_file"
    
    # 内存详细信息
    {
        echo "内存详细信息"
        echo "============"
        if command -v lsmem &> /dev/null
        then
            lsmem
        else
            echo "lsmem 命令不可用"
        fi
        echo ""
    } >> "$report_file"
    
    # 存储设备信息
    {
        echo "存储设备信息"
        echo "============"
        if command -v lsblk &> /dev/null
        then
            lsblk -f
        else
            echo "lsblk 命令不可用"
        fi
        echo ""
    } >> "$report_file"
    
    # PCI设备信息
    {
        echo "PCI设备信息"
        echo "==========="
        if command -v lspci &> /dev/null
        then
            lspci -v | head -50  # 限制输出长度
        else
            echo "lspci 命令不可用"
        fi
        echo ""
    } >> "$report_file"
    
    # USB设备信息
    {
        echo "USB设备信息"
        echo "==========="
        if command -v lsusb &> /dev/null
        then
            lsusb
        else
            echo "lsusb 命令不可用"
        fi
        echo ""
    } >> "$report_file"
    
    echo "硬件信息报告已保存到: $report_file"
}

# 生成硬件报告
# hardware_report
```

## 最佳实践

1. **定期收集系统信息**：建立定期收集系统信息的机制
2. **监控关键指标**：重点关注CPU、内存、磁盘和网络使用情况
3. **使用适当的工具**：根据需要选择合适的命令和选项
4. **自动化报告生成**：编写脚本自动生成系统报告
5. **安全考虑**：在共享系统信息时注意敏感信息的保护
6. **版本兼容性**：注意不同Linux发行版命令的差异
7. **性能影响**：避免频繁执行资源密集型命令

## 总结

系统信息命令是系统管理和故障排查的基础工具。通过本章的学习，你应该掌握了：

1. 系统基本信息命令（uname、hostname、whoami、id）
2. 硬件信息命令（lscpu、lsmem、lsblk、lspci、lsusb）
3. 操作系统信息获取方法
4. 内存和磁盘信息命令（free、vmstat、df、du）
5. 网络信息命令（ip、ifconfig、netstat、ss）
6. 用户和组信息命令（who、w、last）
7. 环境变量查看命令（env、printenv）
8. 实际应用场景和最佳实践

熟练掌握这些系统信息命令，将帮助你更好地了解和管理系统状态。在下一章中，我们将学习网络相关命令，进一步增强网络管理能力。