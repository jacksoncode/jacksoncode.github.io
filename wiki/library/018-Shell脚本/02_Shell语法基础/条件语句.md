# 条件语句

## 什么是条件语句

条件语句是编程中的基本控制结构，它允许程序根据不同的条件执行不同的代码块。在Shell脚本中，条件语句使脚本能够根据运行时的各种条件（如变量值、文件状态、命令执行结果等）做出决策。

## test命令和[ ]条件判断

在Shell中，条件判断主要通过[test](file:///d:/BaiduSyncdisk/Creator/Shell_wiki/02_Shell%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E8%BF%90%E7%AE%97%E7%AC%A6.md#L367-L371)命令或方括号`[ ]`来实现。

### 基本语法

```bash
test expression
# 或者
[ expression ]
```

### 数值比较

```bash
#!/bin/bash

a=10
b=20

# 使用test命令
if test $a -lt $b
then
    echo "a 小于 b"
fi

# 使用方括号（更常用）
if [ $a -gt $b ]
then
    echo "a 大于 b"
else
    echo "a 不大于 b"
fi

# 检查是否相等
if [ $a -eq $b ]
then
    echo "a 等于 b"
else
    echo "a 不等于 b"
fi
```

### 字符串比较

```bash
#!/bin/bash

str1="hello"
str2="world"
str3=""

# 字符串相等比较
if [ "$str1" = "$str2" ]
then
    echo "str1 等于 str2"
else
    echo "str1 不等于 str2"
fi

# 字符串不等比较
if [ "$str1" != "$str2" ]
then
    echo "str1 不等于 str2"
fi

# 检查字符串是否为空
if [ -z "$str3" ]
then
    echo "str3 为空"
fi

# 检查字符串是否非空
if [ -n "$str1" ]
then
    echo "str1 非空"
fi

# 检查字符串是否存在（不为空）
if [ "$str1" ]
then
    echo "str1 存在"
fi
```

### 文件测试

```bash
#!/bin/bash

file="/etc/passwd"

# 检查文件是否存在
if [ -e "$file" ]
then
    echo "文件 $file 存在"
fi

# 检查是否为普通文件
if [ -f "$file" ]
then
    echo "$file 是普通文件"
fi

# 检查是否为目录
if [ -d "/etc" ]
then
    echo "/etc 是目录"
fi

# 检查文件权限
if [ -r "$file" ]
then
    echo "$file 可读"
fi

if [ -w "$file" ]
then
    echo "$file 可写"
fi

if [ -x "$file" ]
then
    echo "$file 可执行"
fi

# 检查文件是否为空
if [ -s "$file" ]
then
    echo "$file 非空"
else
    echo "$file 为空"
fi
```

## [[ ]] 条件判断（推荐）

`[[ ]]`是Bash提供的增强版条件判断语法，比`[ ]`更强大和安全：

```bash
#!/bin/bash

str="hello world"

# 字符串模式匹配
if [[ $str == *world* ]]
then
    echo "字符串包含 'world'"
fi

# 正则表达式匹配
if [[ $str =~ ^[a-z]+[[:space:]]+[a-z]+$ ]]
then
    echo "字符串符合正则表达式"
fi

# 逻辑运算（不需要转义）
if [[ $str == "hello world" && -n "$str" ]]
then
    echo "字符串等于 'hello world' 且非空"
fi
```

## if语句的基本结构

### 简单if语句

```bash
if condition
then
    # 条件为真时执行的命令
    commands
fi
```

### if-else语句

```bash
if condition
then
    # 条件为真时执行的命令
    commands
else
    # 条件为假时执行的命令
    commands
fi
```

### if-elif-else语句

```bash
if condition1
then
    # condition1为真时执行的命令
    commands
elif condition2
then
    # condition2为真时执行的命令
    commands
elif condition3
then
    # condition3为真时执行的命令
    commands
else
    # 所有条件都为假时执行的命令
    commands
fi
```

## 实际应用示例

### 用户输入验证

```bash
#!/bin/bash

# 用户输入验证示例
read -p "请输入您的年龄: " age

# 检查输入是否为数字
if ! [[ $age =~ ^[0-9]+$ ]]
then
    echo "错误: 请输入有效的数字"
    exit 1
fi

# 根据年龄判断
if [ $age -lt 18 ]
then
    echo "您是未成年人"
elif [ $age -lt 60 ]
then
    echo "您是成年人"
else
    echo "您是老年人"
fi
```

### 文件操作检查

```bash
#!/bin/bash

# 文件操作检查示例
read -p "请输入文件名: " filename

if [ -z "$filename" ]
then
    echo "错误: 文件名不能为空"
    exit 1
elif [ ! -e "$filename" ]
then
    echo "错误: 文件 '$filename' 不存在"
    exit 1
elif [ ! -r "$filename" ]
then
    echo "错误: 文件 '$filename' 不可读"
    exit 1
elif [ ! -f "$filename" ]
then
    echo "错误: '$filename' 不是一个普通文件"
    exit 1
else
    echo "文件 '$filename' 检查通过"
    echo "文件大小: $(wc -c < "$filename") 字节"
    echo "行数: $(wc -l < "$filename")"
fi
```

### 系统状态检查

```bash
#!/bin/bash

# 系统状态检查示例
check_disk_usage() {
    # 获取磁盘使用率（百分比）
    usage=$(df / | tail -1 | awk '{print $5}' | sed 's/%//')
    
    if [ $usage -gt 90 ]
    then
        echo "警告: 磁盘使用率过高 (${usage}%)"
        return 1
    elif [ $usage -gt 75 ]
    then
        echo "注意: 磁盘使用率较高 (${usage}%)"
        return 0
    else
        echo "信息: 磁盘使用率正常 (${usage}%)"
        return 0
    fi
}

check_memory_usage() {
    # 获取内存使用率
    memory_usage=$(free | grep Mem | awk '{printf("%.0f", $3/$2 * 100.0)}')
    
    if [ $memory_usage -gt 90 ]
    then
        echo "警告: 内存使用率过高 (${memory_usage}%)"
        return 1
    elif [ $memory_usage -gt 75 ]
    then
        echo "注意: 内存使用率较高 (${memory_usage}%)"
        return 0
    else
        echo "信息: 内存使用率正常 (${memory_usage}%)"
        return 0
    fi
}

# 执行检查
echo "=== 系统状态检查 ==="
check_disk_usage
check_memory_usage
```

## case语句

case语句是另一种条件判断结构，适用于多个固定值的判断：

### 基本语法

```bash
case value in
    pattern1)
        # 匹配pattern1时执行的命令
        commands
        ;;
    pattern2)
        # 匹配pattern2时执行的命令
        commands
        ;;
    *)
        # 默认情况（可选）
        commands
        ;;
esac
```

### 实际应用示例

```bash
#!/bin/bash

# 菜单选择示例
show_menu() {
    echo "请选择操作:"
    echo "1) 查看系统信息"
    echo "2) 查看网络状态"
    echo "3) 查看磁盘使用情况"
    echo "q) 退出"
    read -p "请输入选择: " choice
}

while true; do
    show_menu
    
    case $choice in
        1)
            echo "=== 系统信息 ==="
            uname -a
            ;;
        2)
            echo "=== 网络状态 ==="
            ip addr show | head -10
            ;;
        3)
            echo "=== 磁盘使用情况 ==="
            df -h
            ;;
        q|Q)
            echo "再见！"
            exit 0
            ;;
        *)
            echo "无效选择，请重新输入"
            ;;
    esac
    
    echo  # 空行
    read -p "按回车键继续..."
done
```

### 模式匹配示例

```bash
#!/bin/bash

read -p "请输入文件扩展名: " ext

case $ext in
    txt|log)
        echo "文本文件"
        ;;
    jpg|png|gif)
        echo "图片文件"
        ;;
    mp3|wav|flac)
        echo "音频文件"
        ;;
    mp4|avi|mkv)
        echo "视频文件"
        ;;
    *)
        echo "未知文件类型"
        ;;
esac
```

## 三元运算符

虽然Shell没有传统意义上的三元运算符，但可以通过条件判断实现类似功能：

```bash
#!/bin/bash

a=10
b=20

# 类似三元运算符的写法
[ $a -gt $b ] && max=$a || max=$b
echo "最大值是: $max"

# 另一种写法
if [ $a -gt $b ]; then max=$a; else max=$b; fi
echo "最大值是: $max"
```

## 命令执行状态检查

Shell中的条件判断经常用于检查命令的执行状态：

```bash
#!/bin/bash

# 检查命令是否成功执行
if ls /nonexistent > /dev/null 2>&1
then
    echo "命令执行成功"
else
    echo "命令执行失败，退出码: $?"
fi

# 检查网络连接
if ping -c 1 google.com > /dev/null 2>&1
then
    echo "网络连接正常"
else
    echo "网络连接异常"
fi

# 检查软件是否安装
if command -v curl > /dev/null 2>&1
then
    echo "curl 已安装"
else
    echo "curl 未安装"
fi
```

## 复杂条件组合

使用逻辑运算符组合多个条件：

```bash
#!/bin/bash

user="admin"
password="123456"
attempts=3

# 使用 && (与) 运算符
if [ "$user" = "admin" ] && [ "$password" = "123456" ] && [ $attempts -gt 0 ]
then
    echo "登录成功"
else
    echo "登录失败"
fi

# 使用 || (或) 运算符
if [ "$user" = "admin" ] || [ "$user" = "root" ]
then
    echo "用户具有管理员权限"
fi

# 复杂条件组合
if [[ ($user = "admin" || $user = "root") && $attempts -gt 0 ]]
then
    echo "具有管理员权限且尝试次数未用完"
fi
```

## 最佳实践

1. **使用双方括号**：在Bash中优先使用`[[ ]]`而不是`[ ]`
2. **变量加引号**：在条件判断中始终给变量加上引号，防止空值错误
3. **检查命令执行结果**：使用`$?`或直接在if语句中检查命令执行状态
4. **合理使用case语句**：当有多个固定值判断时，使用case比多个if-elif更清晰
5. **避免深层嵌套**：如果条件判断过于复杂，考虑重构代码逻辑
6. **提前退出**：使用否定条件提前退出，减少嵌套层级

## 总结

条件语句是Shell脚本中实现逻辑控制的核心工具。通过本章的学习，你应该掌握了：

1. 基本的条件判断语法（test、[ ]、[[ ]]）
2. if语句的各种形式（if、if-else、if-elif-else）
3. case语句的使用方法
4. 文件、字符串、数值的条件判断
5. 命令执行状态检查
6. 复杂条件组合

这些技能将帮助你编写能够根据各种条件做出决策的Shell脚本。在下一章中，我们将学习循环结构，让脚本能够重复执行某些操作。